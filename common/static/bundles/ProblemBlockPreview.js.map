{"version":3,"sources":["webpack:///./common/static/xmodule/modules/js/001-3918b2d4f383c04fed8227cc9f523d6e.js","webpack:///./common/static/xmodule/modules/js/002-37ce0eea8f9a85c26819ef3b8b3a37d4.js","webpack:///./common/static/xmodule/modules/js/003-d47e678753905042c21bbc110fb3f8d8.js?1b6e***","webpack:///./common/static/xmodule/modules/js/004-b0c34afa95eaa6b45d843d92ca523a94.js","webpack:///./common/static/xmodule/modules/js/005-fc8bd2dc5b96b86d1abefdd417dd8ba5.js"],"names":["JavascriptLoader","executeModuleScripts","el","callback","callbackCalled","completed","completionHandlerGenerator","loaded","placeholders","find","length","i","ref","results","push","index","allComplete","flag","len","undefined","each","placeholder","s","src","$","attr","document","createElement","setAttribute","onload","appendChild","remove","call","window","indexOfHelper","indexOf","item","Problem","element","that","hint_button","prototype","apply","arguments","enableSubmitButtonAfterTimeout","enableSubmitButtonAfterResponse","enableSubmitButton","enable","changeText","disableAllButtonsWhileRunning","operationCallback","isFromCheckOperation","submitAnswersAndSubmitButton","bind","refreshAnswers","updateMathML","jax","refreshMath","event","save_internal","save","gentle_alert","msg","clear_all_notifications","show","reset_internal","reset","get_sr_status","contents","submit_internal","submit","submit_fd","focus_on_save_notification","focus_on_hint_notification","focus_on_submit_notification","focus_on_notification","type","scroll_to_problem_meta","submit_save_waitfor","setupInputTypes","poll","prevTimeout","focusCallback","queueing","forceUpdate","response","updateProgress","renderProgressState","id","data","element_id","url","content","has_timed_out","has_response","render","selector","problemPrefix","MathJax","Hub","Queue","hasOwnProperty","update_schematics","replace","inputs","click","reviewButton","submitButton","submitButtonLabel","submitButtonSubmitText","text","submitButtonSubmittingText","hintButton","resetButton","showButton","saveButton","saveNotification","showAnswerNotification","gentleAlertNotification","submitNotification","focus","ev","icon","target","children","globalTooltipManager","openTooltip","blur","hide","removeClass","addClass","bindResetCorrectness","Collapsible","setCollapsibles","keyup","graded","progress","progressTemplate","curScore","totalScore","attemptsUsed","ngettext","edx","StringUtils","interpolate","earned","num_points","possible","progress_changed","current_score","total_possible","attempts_used","trigger","queued_items","num_queued_items","queuePollerID","clearTimeout","setTimeout","previousTimeout","postWithPrefix","newTimeout","new_queued_items","html","setHtml","HTML","promise","done","gettext","inputAjax","inputId","dispatch","input_id","inputtypeDisplays","inputtype","classes","cls","setupMethod","split","inputtypeSetupMethods","inp","is","e","name","alert","message","questionTitle","animate","scrollTop","offset","top","notification","hintIndex","abortSubmission","error","errorHtml","errors","fd","fileNotSelected","fileTooLarge","maxFileSize","requiredFilesNotSubmitted","settings","timeoutId","unallowedFileSubmitted","FormData","allowedFiles","file","maxSize","requiredFiles","loopI","loopLen","files","filename","splice","size","append","value","joinHtml","interpolateHtml","toString","processData","contentType","complete","success","Logger","log","answers","responseJSON","ajaxWithPrefix","SR","readTexts","addedStatus","ariaLabel","labeledStatus","parentSection","statusElement","template","closest","label","status","readText","problem","key","safeKey","answer","isArray","display","showMethod","inputtypeShowAnswerMethods","correct_status_html","saveMessage","elid","eqn","mathjaxPreprocessor","preprocessorTag","getAllJax","val","root","toMathML","exception","restart","Callback","After","schematic","update_value","CodeMirror","serialize","answered","atLeastOneTextInputFound","oneTextInputFilled","textField","on","choicegroupBlock","checked","j","checkboxOrRadio","removeAttr","selectField","selectedOption","trim","$inputtypes","add","bindMethod","bindResetCorrectnessByInputtype","formulaequationinput","$p","parent","choicegroup","$element","match","$status","class","style","$select","textline","preprocessor","preprocessorClass","preprocessorClassName","fn","cminput","container","CodeMirrorEditor","CodeMirrorTextArea","linenumbers","mode","spaces","tabsize","Array","parseInt","join","fromTextArea","lineNumbers","indentUnit","tabSize","matchBrackets","lineWrapping","indentWithTabs","smartIndent","extraKeys","Esc","Tab","cm","replaceSelection","getInputField","correctStatusHtml","choice","$inputLabel","$inputStatus","hasClass","choicetextgroup","imageinput","canvas","types","context","rectangle","ctx","coords","rects","reg","rect","abs","height","points","width","Math","exec","stroke","fill","regions","parseCoords","coordinates","JSON","parse","region","beginPath","idx","point","moveTo","lineTo","closePath","getContext","console","fillStyle","strokeStyle","lineWidth","allButtons","initiallyEnabledButtons","filter","button","enableButtons","always","buttons","changeSubmitButtonText","forEach","disabled","submitCanBeEnabled","hintContainer","nextIndex","hint_index","hintMsgContainer","should_enable_next_hint","toggleFull","toggleHint","linkBottom","linkTop","short_custom","elt","close_text","open_text","$el","new_text","preventDefault","siblings","slideToggle","toggleClass","ImageInput","ImageInputConstructor","constructor","clickHandler","elementId","crossEl","inputEl","posX","offsetX","pageX","left","posY","offsetY","pageY","result","round","css","visibility","cktsim","T_VOLTAGE","T_CURRENT","v_newt_lim","v_abstol","i_abstol","eps","dc_max_iters","max_tran_iters","time_step_increase_factor","lte_step_decrease_factor","nr_step_decrease_factor","reltol","lterel","res_check_abs","sqrt","res_check_rel","Circuit","node_map","ntypes","initial_conditions","devices","device_map","voltage_sources","current_sources","finalized","diddc","node_index","periods","gnd_node","node","ntype","ic","finalize","N","matrix","mat_make","Gl","G","C","soln_max","abstol","solution","rhs","load_linear","n_vsrc","GV","branch","rGV","mat_rank","load_netlist","netlist","component","connections","found_ground","properties","r","d","c","l","v","opamp","n","p","find_solution","load","maxiters","soln","d_sol","abssum_compare","converged","abssum_old","abssum_rhs","use_limiting","down_count","thresh","iter","mat_solve_rq","problem_node","dc","load_dc","ckt","mat_v_mult","mat_copy","iterations","tran","ntpts","tstart","tstop","probenames","no_dc","load_tran","time","q","dqdt","alpha0","alpha1","oldq","alpha2","old2q","beta0","beta1","oldc","mat_scale_add","interp_coeffs","t","t0","t1","t2","dtt0","dtt1","dtt2","dt0dt1","dt0dt2","dt1dt2","pick_step","step_index","min_shrink_factor","max_growth_factor","oldt","old2t","old3t","trapcoeff","maxlteratio","ltecheck","pred","oldsol","old2sol","old3sol","lte","lteratio","max","new_step","lte_step_ratio","pow","min_step","min","max_step","old3q","ar","algebraic","period","per","ceil","max_nsteps","ac","npts","fstart","fstop","source_name","matrixac","load_ac","delta_f","exp","LN10","phase_offset","f","omega","PI","solac","mat_solve","mag","phase","atan2","phasei","L","phase_jump","add_device","n1","n2","parse_number","Resistor","area","Diode","Capacitor","Inductor","VSource","ISource","np","nn","no","ng","A","ratio","Opamp","g","Fet","add_two_terminal","M","get_two_terminal","x","xi_minus_xj","add_conductance_l","add_conductance","add_capacitance","add_to_Gl","add_to_G","add_to_C","add_to_rhs","mat","b","scale","m","temp","B","scalea","scaleb","Nr","Mc","R","one_if_alg","row","col","dest","mat_copy_transposed","Mo","Nc","max_abs_entry","the_rank","start_col","max_v","max_row","mat_scale","max_nonzero_row","maxsumsq","rowp","Mr","sumsq","row_norm","Mrp","inner","max_col","Device","breakpoint","ord","ch","charCodeAt","default_v","slen","multiplier","charAt","start","exponent","parse_source","inflection_point","fun","slice","args","end","arg_end","arg_value","h","w","pwl_source","v1","v2","td","tr","freq","duty_cycle","Infinity","t_change","t_pw","tf","pw","t3","t4","voffset","va","sin","tv_pairs","repeat","nvals","fmod","last_t","last_v","next_t","next_v","numerator","denominator","quotient","floor","npos","nneg","anode","cathode","ais","vt","exp_arg_max","exp_max","vd","exp_arg","temp1","temp2","abs_exp_arg","d_arg","quad","gd","gain","invA","type_sign","kp","beta","lambda","vds","vgs","vgst","gmgs","ids","gds","module","schematics","getAttribute","Schematic","err","msgdiv","border","margins","padding","createTextNode","parentNode","insertBefore","background_style","element_style","thumb_style","normal_style","component_style","selected_style","grid_style","annotation_style","property_size","annotation_size","parts_map","Ground","Label","OpAmp","NFet","PFet","Probe","Ammeter","sch_clipboard","input","show_grid","grid","origin_x","origin_y","cursor_x","cursor_y","window_list","edits_allowed","parts","parts_bin","part","Part","pm","set_component","analyses","diagram_only","submit_analyses","tools","toolbar","add_tool","grid_icon","toggle_grid","enable_tool","cut_icon","cut","copy_icon","copy","paste_icon","paste","dc_analysis","setup_ac_analysis","ac_npts","ac_fstart","ac_fstop","ac_source_name","transient_analysis","tran_npts","tran_tstop","sctl_r","sctl_x","sctl_y","zctl_left","zctl_top","bg_image","tabIndex","borderStyle","borderWidth","borderColor","outline","addEventListener","schematic_mouse_move","schematic_mouse_enter","schematic_mouse_leave","schematic_mouse_down","schematic_mouse_up","schematic_mouse_wheel","schematic_double_click","schematic_key_down","schematic_key_up","status_div","status_height","connection_points","components","dragging","select_rect","wire","operating_point","dc_results","ac_results","transient_results","ctrlKey","shiftKey","altKey","cmdKey","table","rules","frame","backgroundColor","verticalAlign","colSpan","tool","wrapper","position","parts_table","cellPadding","cellSpacing","parts_per_column","part_h","toplevel","onselectstart","nextSibling","load_schematic","zoomall","part_w","add_component","new_c","remove_component","find_connections","cp","location","add_connection_point","cplist","remove_connection_point","old_location","update_connection_point","add_wire","x1","y1","x2","y2","new_wire","Wire","move_end","split_wire","y","dx","dy","check_wires","cc","bisect","redraw_background","check_connection_points","locn","bisect_cp","clean_up_wires","c1","c2","e1","other_end","e2","e3","collinear","unselect_all","which","set_select","drag_begin","selected","move_begin","drag_x","drag_y","drag_end","help","open","rescale","nscale","cx","cy","zoom_factor","zoom_min","zoom_max","origin_min","origin_max","zoomin","zoomout","sch_w","bbox","sch_h","scale_x","scale_y","redraw","clone","initial_value","json","label_connection_points","clear_labels","add_default_labels","next_label","label_connections","get_next_label","propagate_label","stringify","json_with_analyses","extract_circuit","find_probes","info","probe_info","npts_lbl","fstart_lbl","fstop_lbl","source_name_lbl","fields","build_input","build_table","sch","dialog","ac_analysis","x_values","flist","values","fvlist","k","y_values","z_values","probes","probe_maxv","probe_color","array_max","all_max","color","v_max","graph2","graph","graph1","tstop_lbl","probe_list","probe_names","times","tlist","tvlist","x_legend","v_values","i_values","set_property","component_name","property","lineCap","fillRect","first_x","last_x","first_y","last_y","draw_line","min_x","max_x","min_y","max_y","draw","unsel_bbox","drawImage","selections","display_voltage","display_current","arc","strokeRect","cross_cursor","draw_arc","radius","start_radians","end_radians","anticlockwise","filled","draw_text","font","fillText","HTMLCanvasElement","relMouseCoords","totalOffsetX","totalOffsetY","currentElement","offsetLeft","offsetTop","offsetParent","mouse_x","mouse_y","page_x","page_y","srcElement","code","keyCode","rotate","new_part","select","drawCursor","mx","my","sx","sy","zx","zy","delta","reselect","was_previously_selected","move","canonicalize","wheelDelta","detail","edit_properties","nodeValue","append_message","title","plist","getElementsByClassName","field","dialog_check_for_ENTER","body","marginBotton","ok_button","dialog_okay","margin","cancel_button","dialog_cancel","textAlign","window_close","win","a","tbl","col1","col2","className","build_select","options","option","selectedIndex","draw_y","head","close_button","Image","close_icon","cssFloat","window_close_button","window_mouse_down","background","bring_to_front","insert","wlist","zIndex","removeChild","window_mouse_move","window_mouse_up","tracking_window","removeEventListener","tip","child","hidden","backgroundImage","innerHTML","classList","search","tool_enter","tool_leave","tool_click","enabled","tname","removeAttribute","tagName","toLowerCase","stopPropagation","help_icon","CanvasRenderingContext2D","dashedLineTo","fromX","fromY","toX","toY","pattern","lt","gt","capmin","capmax","checkX","thereYet","cap","checkY","dash","ang","cos","view_limits","vmin","vmax","log_range","engineering_notation","nplaces","sign","log10","mantissa","mstring","mlen","endindex","substring","grid_pattern","cursor_pattern","y_legend","z_legend","pwidth","pheight","left_margin","top_margin","right_margin","bottom_margin","tick_length","x_min","array_min","x_max","x_limits","x_scale","plot_x","textBaseline","plot_y","y_max","y_scale","y_min","plot","y_limits","nx","ny","probe_colors_rgb","plot_z","z","z_max","z_scale","z_min","z_limits","tick_length_half","tick_delta","nz","translate","restore","cursor1_x","cursor2_x","graph_mouse_move","redraw_plot","plot_cursor","end_y","graph_x","tx","ty","z1","z2","gx","gy","cursor","xpart","part_enter","part_leave","part_mouse_down","part_mouse_up","set_location","right","offsetWidth","bottom","offsetHeight","bounding_box","between","inside","intersect","r1","r2","Component","rotation","props","conns","add_connection","offset_x","offset_y","ConnectionPoint","update_coords","transform_x","transform_y","update_location","amount","old_rotation","move_x","move_y","rot","nx1","ny1","nx2","ny2","draw_circle","rot_angle","aOrient","alignment","near","clear_label","vmap","connection_point_radius","ensureHTML","coincident","draw_x","toFixed","globalAlpha","p1","p2","p3","near_distance","x_plus_dx","y_plus_dy","D","probe_colors","color_choice","c_e1","c_e2","diode_types","w_over_l","W_L","dim","Source","params","source_functions","build_content","src_types","type_select","source_type_changed","run","first","labels","div","hasChildNodes","firstChild","component_slider","ui","sname","slider","cname","pname","suffix","choices","analysis"],"mappings":"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","file":"ProblemBlockPreview.js","sourcesContent":["/*** IMPORTS FROM imports-loader ***/\n(function() {\n\n(function() {\n    'use strict';\n    this.JavascriptLoader = (function() {\n        function JavascriptLoader() {\n        }\n\n        /**\n         * Set of library functions that provide common interface for javascript loading\n         * for all module types. All functionality provided by JavascriptLoader should take\n         * place at module scope, i.e. don't run jQuery over entire page.\n         *\n         * executeModuleScripts:\n         *     Scan the module ('el') for \"script_placeholder\"s, then:\n         *\n         *     1) Fetch each script from server\n         *     2) Explicitly attach the script to the <head> of document\n         *     3) Explicitly wait for each script to be loaded\n         *     4) Return to callback function when all scripts loaded\n         */\n        JavascriptLoader.executeModuleScripts = function(el, callback) {\n            var callbackCalled, completed, completionHandlerGenerator, loaded, placeholders;\n            if (!callback) {\n                callback = null; // eslint-disable-line no-param-reassign\n            }\n            placeholders = el.find('.script_placeholder');\n            if (placeholders.length === 0) {\n                if (callback !== null) {\n                    callback();\n                }\n                return [];\n            }\n            // TODO: Verify the execution order of multiple placeholders\n            completed = (function() {\n                var i, ref, results;\n                results = [];\n                for (i = 1, ref = placeholders.length; ref >= 1 ? i <= ref : i >= ref; ref >= 1 ? ++i : --i) {\n                    results.push(false);\n                }\n                return results;\n            }());\n            callbackCalled = false;\n            completionHandlerGenerator = function(index) {\n                return function() {\n                    var allComplete, flag, i, len;\n                    allComplete = true;\n                    completed[index] = true;\n                    for (i = 0, len = completed.length; i < len; i++) {\n                        flag = completed[i];\n                        if (!flag) {\n                            allComplete = false;\n                            break;\n                        }\n                    }\n                    if (allComplete && !callbackCalled) {\n                        callbackCalled = true;\n                        if (callback !== null) {\n                            return callback();\n                        }\n                    }\n                    return undefined;\n                };\n            };\n            // Keep a map of what sources we're loaded from, and don't do it twice.\n            loaded = {};\n            return placeholders.each(function(index, placeholder) {\n                var s, src;\n                // TODO: Check if the script already exists in DOM. If so, (1) copy it\n                // into memory; (2) delete the DOM script element; (3) reappend it.\n                // This would prevent memory bloat and save a network request.\n                src = $(placeholder).attr('data-src');\n                if (!(src in loaded)) {\n                    loaded[src] = true;\n                    s = document.createElement('script');\n                    s.setAttribute('src', src);\n                    s.setAttribute('type', 'text/javascript');\n                    s.onload = completionHandlerGenerator(index);\n                    // Need to use the DOM elements directly or the scripts won't execute properly.\n                    $('head')[0].appendChild(s);\n                } else {\n                    // just call the completion callback directly, without reloading the file\n                    completionHandlerGenerator(index)();\n                }\n                return $(placeholder).remove();\n            });\n        };\n\n        return JavascriptLoader;\n    }());\n}).call(this);\n\n}.call(window));\n\n\n// WEBPACK FOOTER //\n// ./common/static/xmodule/modules/js/001-3918b2d4f383c04fed8227cc9f523d6e.js","/*** IMPORTS FROM imports-loader ***/\n(function() {\n\n/* global MathJax, Collapsible, interpolate, JavascriptLoader, Logger, CodeMirror */\n// Note: this code was originally converted from CoffeeScript, and thus follows some\n// coding conventions that are discouraged by eslint. Some warnings have been suppressed\n// to avoid substantial rewriting of the code. Allow the eslint suppressions to exceed\n// the max line length of 120.\n/* eslint max-len: [\"error\", 120, { \"ignoreComments\": true }] */\n\n(function() {\n    'use strict';\n    var indexOfHelper = [].indexOf ||\n        function(item) {\n            var i, len;\n            for (i = 0, len = this.length; i < len; i++) {\n                if (i in this && this[i] === item) {\n                    return i;\n                }\n            }\n            return -1;\n        };\n\n    this.Problem = (function() {\n        function Problem(element) {\n            var that = this;\n            this.hint_button = function() {\n                return Problem.prototype.hint_button.apply(that, arguments);\n            };\n            this.enableSubmitButtonAfterTimeout = function() {\n                return Problem.prototype.enableSubmitButtonAfterTimeout.apply(that, arguments);\n            };\n            this.enableSubmitButtonAfterResponse = function() {\n                return Problem.prototype.enableSubmitButtonAfterResponse.apply(that, arguments);\n            };\n            this.enableSubmitButton = function(enable, changeText) {\n                if (changeText === null || changeText === undefined) {\n                    changeText = true; // eslint-disable-line no-param-reassign\n                }\n                return Problem.prototype.enableSubmitButton.apply(that, arguments);\n            };\n            this.disableAllButtonsWhileRunning = function(\n                operationCallback, isFromCheckOperation // eslint-disable-line no-unused-vars\n            ) {\n                return Problem.prototype.disableAllButtonsWhileRunning.apply(that, arguments);\n            };\n            this.submitAnswersAndSubmitButton = function(bind) {\n                if (bind === null || bind === undefined) {\n                    bind = false;  // eslint-disable-line no-param-reassign\n                }\n                return Problem.prototype.submitAnswersAndSubmitButton.apply(that, arguments);\n            };\n            this.refreshAnswers = function() {\n                return Problem.prototype.refreshAnswers.apply(that, arguments);\n            };\n            this.updateMathML = function(jax, el) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.updateMathML.apply(that, arguments);\n            };\n            this.refreshMath = function(event, el) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.refreshMath.apply(that, arguments);\n            };\n            this.save_internal = function() {\n                return Problem.prototype.save_internal.apply(that, arguments);\n            };\n            this.save = function() {\n                return Problem.prototype.save.apply(that, arguments);\n            };\n            this.gentle_alert = function(msg) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.gentle_alert.apply(that, arguments);\n            };\n            this.clear_all_notifications = function() {\n                return Problem.prototype.clear_all_notifications.apply(that, arguments);\n            };\n            this.show = function() {\n                return Problem.prototype.show.apply(that, arguments);\n            };\n            this.reset_internal = function() {\n                return Problem.prototype.reset_internal.apply(that, arguments);\n            };\n            this.reset = function() {\n                return Problem.prototype.reset.apply(that, arguments);\n            };\n            this.get_sr_status = function(contents) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.get_sr_status.apply(that, arguments);\n            };\n            this.submit_internal = function() {\n                return Problem.prototype.submit_internal.apply(that, arguments);\n            };\n            this.submit = function() {\n                return Problem.prototype.submit.apply(that, arguments);\n            };\n            this.submit_fd = function() {\n                return Problem.prototype.submit_fd.apply(that, arguments);\n            };\n            this.focus_on_save_notification = function() {\n                return Problem.prototype.focus_on_save_notification.apply(that, arguments);\n            };\n            this.focus_on_hint_notification = function() {\n                return Problem.prototype.focus_on_hint_notification.apply(that, arguments);\n            };\n            this.focus_on_submit_notification = function() {\n                return Problem.prototype.focus_on_submit_notification.apply(that, arguments);\n            };\n            this.focus_on_notification = function(type) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.focus_on_notification.apply(that, arguments);\n            };\n            this.scroll_to_problem_meta = function() {\n                return Problem.prototype.scroll_to_problem_meta.apply(that, arguments);\n            };\n            this.submit_save_waitfor = function(callback) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.submit_save_waitfor.apply(that, arguments);\n            };\n            this.setupInputTypes = function() {\n                return Problem.prototype.setupInputTypes.apply(that, arguments);\n            };\n            this.poll = function(prevTimeout, focusCallback // eslint-disable-line no-unused-vars\n            ) {\n                return Problem.prototype.poll.apply(that, arguments);\n            };\n            this.queueing = function(focusCallback) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.queueing.apply(that, arguments);\n            };\n            this.forceUpdate = function(response) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.forceUpdate.apply(that, arguments);\n            };\n            this.updateProgress = function(response) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.updateProgress.apply(that, arguments);\n            };\n            this.renderProgressState = function() {\n                return Problem.prototype.renderProgressState.apply(that, arguments);\n            };\n            this.bind = function() {\n                return Problem.prototype.bind.apply(that, arguments);\n            };\n            this.el = $(element).find('.problems-wrapper');\n            this.id = this.el.data('problem-id');\n            this.element_id = this.el.attr('id');\n            this.url = this.el.data('url');\n            this.content = this.el.data('content');\n\n            // has_timed_out and has_response are used to ensure that\n            // we wait a minimum of ~ 1s before transitioning the submit\n            // button from disabled to enabled\n            this.has_timed_out = false;\n            this.has_response = false;\n            this.render(this.content);\n        }\n\n        Problem.prototype.$ = function(selector) {\n            return $(selector, this.el);\n        };\n\n        Problem.prototype.bind = function() {\n            var problemPrefix,\n                that = this;\n            if (typeof MathJax !== 'undefined' && MathJax !== null) {\n                this.el.find('.problem > div').each(function(index, element) {\n                    return MathJax.Hub.Queue(['Typeset', MathJax.Hub, element]);\n                });\n            }\n            if (window.hasOwnProperty('update_schematics')) {\n                window.update_schematics();\n            }\n            problemPrefix = this.element_id.replace(/problem_/, '');\n            this.inputs = this.$('[id^=\"input_' + problemPrefix + '_\"]');\n            this.$('div.action button').click(this.refreshAnswers);\n            this.reviewButton = this.$('.notification-btn.review-btn');\n            this.reviewButton.click(this.scroll_to_problem_meta);\n            this.submitButton = this.$('.action .submit');\n            this.submitButtonLabel = this.$('.action .submit .submit-label');\n            this.submitButtonSubmitText = this.submitButtonLabel.text();\n            this.submitButtonSubmittingText = this.submitButton.data('submitting');\n            this.submitButton.click(this.submit_fd);\n            this.hintButton = this.$('.action .hint-button');\n            this.hintButton.click(this.hint_button);\n            this.resetButton = this.$('.action .reset');\n            this.resetButton.click(this.reset);\n            this.showButton = this.$('.action .show');\n            this.showButton.click(this.show);\n            this.saveButton = this.$('.action .save');\n            this.saveNotification = this.$('.notification-save');\n            this.showAnswerNotification = this.$('.notification-show-answer');\n            this.saveButton.click(this.save);\n            this.gentleAlertNotification = this.$('.notification-gentle-alert');\n            this.submitNotification = this.$('.notification-submit');\n\n            // Accessibility helper for sighted keyboard users to show <clarification> tooltips on focus:\n            this.$('.clarification').focus(function(ev) {\n                var icon;\n                icon = $(ev.target).children('i');\n                return window.globalTooltipManager.openTooltip(icon);\n            });\n            this.$('.clarification').blur(function() {\n                return window.globalTooltipManager.hide();\n            });\n            this.$('.review-btn').focus(function(ev) {\n                return $(ev.target).removeClass('sr');\n            });\n            this.$('.review-btn').blur(function(ev) {\n                return $(ev.target).addClass('sr');\n            });\n            this.bindResetCorrectness();\n            if (this.submitButton.length) {\n                this.submitAnswersAndSubmitButton(true);\n            }\n            Collapsible.setCollapsibles(this.el);\n            this.$('input.math').keyup(this.refreshMath);\n            if (typeof MathJax !== 'undefined' && MathJax !== null) {\n                this.$('input.math').each(function(index, element) {\n                    return MathJax.Hub.Queue([that.refreshMath, null, element]);\n                });\n            }\n        };\n\n        Problem.prototype.renderProgressState = function() {\n            var graded, progress, progressTemplate, curScore, totalScore, attemptsUsed;\n            curScore = this.el.data('problem-score');\n            totalScore = this.el.data('problem-total-possible');\n            attemptsUsed = this.el.data('attempts-used');\n            graded = this.el.data('graded');\n\n            // The problem is ungraded if it's explicitly marked as such, or if the total possible score is 0\n            if (graded === 'True' && totalScore !== 0) {\n                graded = true;\n            } else {\n                graded = false;\n            }\n\n            if (curScore === undefined || totalScore === undefined) {\n                // Render an empty string.\n                progressTemplate = '';\n            } else if (curScore === null || curScore === 'None') {\n                // Render 'x point(s) possible (un/graded, results hidden)' if no current score provided.\n                if (graded) {\n                    progressTemplate = ngettext(\n                        // Translators: {num_points} is the number of points possible (examples: 1, 3, 10).;\n                        '{num_points} point possible (graded, results hidden)',\n                        '{num_points} points possible (graded, results hidden)',\n                        totalScore\n                    );\n                } else {\n                    progressTemplate = ngettext(\n                        // Translators: {num_points} is the number of points possible (examples: 1, 3, 10).;\n                        '{num_points} point possible (ungraded, results hidden)',\n                        '{num_points} points possible (ungraded, results hidden)',\n                        totalScore\n                    );\n                }\n            } else if ((attemptsUsed === 0 || totalScore === 0) && curScore === 0) {\n                // Render 'x point(s) possible' if student has not yet attempted question\n                // But if staff has overridden score to a non-zero number, show it\n                if (graded) {\n                    progressTemplate = ngettext(\n                        // Translators: {num_points} is the number of points possible (examples: 1, 3, 10).;\n                        '{num_points} point possible (graded)', '{num_points} points possible (graded)',\n                        totalScore\n                    );\n                } else {\n                    progressTemplate = ngettext(\n                        // Translators: {num_points} is the number of points possible (examples: 1, 3, 10).;\n                        '{num_points} point possible (ungraded)', '{num_points} points possible (ungraded)',\n                        totalScore\n                    );\n                }\n            } else {\n                // Render 'x/y point(s)' if student has attempted question\n                if (graded) {\n                    progressTemplate = ngettext(\n                        // This comment needs to be on one line to be properly scraped for the translators.\n                        // Translators: {earned} is the number of points earned. {possible} is the total number of points (examples: 0/1, 1/1, 2/3, 5/10). The total number of points will always be at least 1. We pluralize based on the total number of points (example: 0/1 point; 1/2 points);\n                        '{earned}/{possible} point (graded)', '{earned}/{possible} points (graded)',\n                        totalScore\n                    );\n                } else {\n                    progressTemplate = ngettext(\n                        // This comment needs to be on one line to be properly scraped for the translators.\n                        // Translators: {earned} is the number of points earned. {possible} is the total number of points (examples: 0/1, 1/1, 2/3, 5/10). The total number of points will always be at least 1. We pluralize based on the total number of points (example: 0/1 point; 1/2 points);\n                        '{earned}/{possible} point (ungraded)', '{earned}/{possible} points (ungraded)',\n                        totalScore\n                    );\n                }\n            }\n            progress = edx.StringUtils.interpolate(\n                progressTemplate, {\n                    earned: curScore,\n                    num_points: totalScore,\n                    possible: totalScore\n                }\n            );\n            return this.$('.problem-progress').text(progress);\n        };\n\n        Problem.prototype.updateProgress = function(response) {\n            if (response.progress_changed) {\n                this.el.data('problem-score', response.current_score);\n                this.el.data('problem-total-possible', response.total_possible);\n                this.el.data('attempts-used', response.attempts_used);\n                this.el.trigger('progressChanged');\n            }\n            return this.renderProgressState();\n        };\n\n        Problem.prototype.forceUpdate = function(response) {\n            this.el.data('problem-score', response.current_score);\n            this.el.data('problem-total-possible', response.total_possible);\n            this.el.data('attempts-used', response.attempts_used);\n            this.el.trigger('progressChanged');\n            return this.renderProgressState();\n        };\n\n        Problem.prototype.queueing = function(focusCallback) {\n            var that = this;\n            this.queued_items = this.$('.xqueue');\n            this.num_queued_items = this.queued_items.length;\n            if (this.num_queued_items > 0) {\n                if (window.queuePollerID) { // Only one poller 'thread' per Problem\n                    window.clearTimeout(window.queuePollerID);\n                }\n                window.queuePollerID = window.setTimeout(function() {\n                    return that.poll(1000, focusCallback);\n                }, 1000);\n            }\n        };\n\n        Problem.prototype.poll = function(previousTimeout, focusCallback) {\n            var that = this;\n            return $.postWithPrefix('' + this.url + '/problem_get', function(response) {\n                var newTimeout;\n                // If queueing status changed, then render\n                that.new_queued_items = $(response.html).find('.xqueue');\n                if (that.new_queued_items.length !== that.num_queued_items) {\n                    edx.HtmlUtils.setHtml(that.el, edx.HtmlUtils.HTML(response.html)).promise().done(function() {\n                        return typeof focusCallback === 'function' ? focusCallback() : void 0;\n                    });\n                    JavascriptLoader.executeModuleScripts(that.el, function() {\n                        that.setupInputTypes();\n                        that.bind();\n                    });\n                }\n                that.num_queued_items = that.new_queued_items.length;\n                if (that.num_queued_items === 0) {\n                    that.forceUpdate(response);\n                    delete window.queuePollerID;\n                } else {\n                    newTimeout = previousTimeout * 2;\n                    // if the timeout is greather than 1 minute\n                    if (newTimeout >= 60000) {\n                        delete window.queuePollerID;\n                        that.gentle_alert(\n                            gettext('The grading process is still running. Refresh the page to see updates.')\n                        );\n                    } else {\n                        window.queuePollerID = window.setTimeout(function() {\n                            return that.poll(newTimeout, focusCallback);\n                        }, newTimeout);\n                    }\n                }\n            });\n        };\n\n        /**\n         * Use this if you want to make an ajax call on the input type object\n         * static method so you don't have to instantiate a Problem in order to use it\n         *\n         * Input:\n         *     url: the AJAX url of the problem\n         *     inputId: the inputId of the input you would like to make the call on\n         *         NOTE: the id is the ${id} part of \"input_${id}\" during rendering\n         *             If this function is passed the entire prefixed id, the backend may have trouble\n         *             finding the correct input\n         *     dispatch: string that indicates how this data should be handled by the inputtype\n         *     data: dictionary of data to send to the server\n         *     callback: the function that will be called once the AJAX call has been completed.\n         *          It will be passed a response object\n         */\n        Problem.inputAjax = function(url, inputId, dispatch, data, callback) {\n            data.dispatch = dispatch; // eslint-disable-line no-param-reassign\n            data.input_id = inputId; // eslint-disable-line no-param-reassign\n            return $.postWithPrefix('' + url + '/input_ajax', data, callback);\n        };\n\n        Problem.prototype.render = function(content, focusCallback) {\n            var that = this;\n            if (content) {\n                edx.HtmlUtils.setHtml(this.el, edx.HtmlUtils.HTML(content));\n                return JavascriptLoader.executeModuleScripts(this.el, function() {\n                    that.setupInputTypes();\n                    that.bind();\n                    that.queueing(focusCallback);\n                    that.renderProgressState();\n                    return typeof focusCallback === 'function' ? focusCallback() : void 0;\n                });\n            } else {\n                return $.postWithPrefix('' + this.url + '/problem_get', function(response) {\n                    edx.HtmlUtils.setHtml(that.el, edx.HtmlUtils.HTML(response.html));\n                    return JavascriptLoader.executeModuleScripts(that.el, function() {\n                        that.setupInputTypes();\n                        that.bind();\n                        that.queueing();\n                        return that.forceUpdate(response);\n                    });\n                });\n            }\n        };\n\n        Problem.prototype.setupInputTypes = function() {\n            var that = this;\n            this.inputtypeDisplays = {};\n            return this.el.find('.capa_inputtype').each(function(index, inputtype) {\n                var classes, cls, id, setupMethod, i, len, results;\n                classes = $(inputtype).attr('class').split(' ');\n                id = $(inputtype).attr('id');\n                results = [];\n                for (i = 0, len = classes.length; i < len; i++) {\n                    cls = classes[i];\n                    setupMethod = that.inputtypeSetupMethods[cls];\n                    if (setupMethod != null) {\n                        results.push(that.inputtypeDisplays[id] = setupMethod(inputtype));\n                    } else {\n                        results.push(void 0);\n                    }\n                }\n                return results;\n            });\n        };\n\n        /**\n         * If some function wants to be called before sending the answer to the\n         * server, give it a chance to do so.\n         *\n         * submit_save_waitfor allows the callee to send alerts if the user's input is\n         * invalid. To do so, the callee must throw an exception named \"WaitforException\".\n         * This and any other errors or exceptions that arise from the callee are rethrown\n         * and abort the submission.\n         *\n         * In order to use this feature, add a 'data-waitfor' attribute to the input,\n         * and specify the function to be called by the submit button before sending off @answers\n         */\n        Problem.prototype.submit_save_waitfor = function(callback) {\n            var flag, inp, i, len, ref,\n                that = this;\n            flag = false;\n            ref = this.inputs;\n            for (i = 0, len = ref.length; i < len; i++) {\n                inp = ref[i];\n                if ($(inp).is('input[waitfor]')) {\n                    try {\n                        $(inp).data('waitfor')(function() {\n                            that.refreshAnswers();\n                            return callback();\n                        });\n                    } catch (e) {\n                        if (e.name === 'Waitfor Exception') {\n                            alert(e.message); // eslint-disable-line no-alert\n                        } else {\n                            alert( // eslint-disable-line no-alert\n                                gettext('Could not grade your answer. The submission was aborted.')\n                            );\n                        }\n                        throw e;\n                    }\n                    flag = true;\n                } else {\n                    flag = false;\n                }\n            }\n            return flag;\n        };\n\n        // Scroll to problem metadata and next focus is problem input\n        Problem.prototype.scroll_to_problem_meta = function() {\n            var questionTitle;\n            questionTitle = this.$('.problem-header');\n            if (questionTitle.length > 0) {\n                $('html, body').animate({\n                    scrollTop: questionTitle.offset().top\n                }, 500);\n                questionTitle.focus();\n            }\n        };\n\n        Problem.prototype.focus_on_notification = function(type) {\n            var notification;\n            notification = this.$('.notification-' + type);\n            if (notification.length > 0) {\n                notification.focus();\n            }\n        };\n\n        Problem.prototype.focus_on_submit_notification = function() {\n            this.focus_on_notification('submit');\n        };\n\n        Problem.prototype.focus_on_hint_notification = function(hintIndex) {\n            this.$('.notification-hint .notification-message > ol > li.hint-index-' + hintIndex).focus();\n        };\n\n        Problem.prototype.focus_on_save_notification = function() {\n            this.focus_on_notification('save');\n        };\n\n        /**\n         * 'submit_fd' uses FormData to allow file submissions in the 'problem_check' dispatch,\n         *      in addition to simple querystring-based answers\n         *\n         * NOTE: The dispatch 'problem_check' is being singled out for the use of FormData;\n         *       maybe preferable to consolidate all dispatches to use FormData\n         */\n        Problem.prototype.submit_fd = function() {\n            var abortSubmission, error, errorHtml, errors, fd, fileNotSelected, fileTooLarge, maxFileSize,\n                requiredFilesNotSubmitted, settings, timeoutId, unallowedFileSubmitted, i, len,\n                that = this;\n\n            // If there are no file inputs in the problem, we can fall back on submit.\n            if (this.el.find('input:file').length === 0) {\n                this.submit();\n                return;\n            }\n            this.enableSubmitButton(false);\n            if (!window.FormData) {\n                alert(gettext('Submission aborted! Sorry, your browser does not support file uploads. If you can, please use Chrome or Safari which have been verified to support file uploads.')); // eslint-disable-line max-len, no-alert\n                this.enableSubmitButton(true);\n                return;\n            }\n            timeoutId = this.enableSubmitButtonAfterTimeout();\n            fd = new FormData();\n\n            // Sanity checks on submission\n            maxFileSize = 4 * 1000 * 1000;\n            fileTooLarge = false;\n            fileNotSelected = false;\n            requiredFilesNotSubmitted = false;\n            unallowedFileSubmitted = false;\n\n            errors = [];\n            this.inputs.each(function(index, element) {\n                var allowedFiles, file, maxSize, requiredFiles, loopI, loopLen, ref;\n                if (element.type === 'file') {\n                    requiredFiles = $(element).data('required_files');\n                    allowedFiles = $(element).data('allowed_files');\n                    ref = element.files;\n                    for (loopI = 0, loopLen = ref.length; loopI < loopLen; loopI++) {\n                        file = ref[loopI];\n                        if (allowedFiles.length !== 0 && indexOfHelper.call(allowedFiles, file.name) < 0) {\n                            unallowedFileSubmitted = true;\n                            errors.push(edx.StringUtils.interpolate(\n                                gettext('You submitted {filename}; only {allowedFiles} are allowed.'), {\n                                    filename: file.name,\n                                    allowedFiles: allowedFiles\n                                }\n                            ));\n                        }\n                        if (indexOfHelper.call(requiredFiles, file.name) >= 0) {\n                            requiredFiles.splice(requiredFiles.indexOf(file.name), 1);\n                        }\n                        if (file.size > maxFileSize) {\n                            fileTooLarge = true;\n                            maxSize = maxFileSize / (1000 * 1000);\n                            errors.push(edx.StringUtils.interpolate(\n                                gettext('Your file {filename} is too large (max size: {maxSize}MB).'), {\n                                    filename: file.name,\n                                    maxSize: maxSize\n                                }\n                            ));\n                        }\n                        fd.append(element.id, file);  // xss-lint: disable=javascript-jquery-append\n                    }\n                    if (element.files.length === 0) {\n                        fileNotSelected = true;\n                        // In case we want to allow submissions with no file\n                        fd.append(element.id, '');  // xss-lint: disable=javascript-jquery-append\n                    }\n                    if (requiredFiles.length !== 0) {\n                        requiredFilesNotSubmitted = true;\n                        errors.push(edx.StringUtils.interpolate(\n                            gettext('You did not submit the required files: {requiredFiles}.'), {\n                                requiredFiles: requiredFiles\n                            }\n                        ));\n                    }\n                } else {\n                    fd.append(element.id, element.value);  // xss-lint: disable=javascript-jquery-append\n                }\n            });\n            if (fileNotSelected) {\n                errors.push(gettext('You did not select any files to submit.'));\n            }\n            errorHtml = '';\n            for (i = 0, len = errors.length; i < len; i++) {\n                error = errors[i];\n                errorHtml = edx.HtmlUtils.joinHtml(\n                    errorHtml,\n                    edx.HtmlUtils.interpolateHtml(edx.HtmlUtils.HTML('<li>{error}</li>'), {error: error})\n                );\n            }\n            errorHtml = edx.HtmlUtils.interpolateHtml(edx.HtmlUtils.HTML('<ul>{errors}</ul>'), {errors: errorHtml});\n            this.gentle_alert(errorHtml.toString());\n            abortSubmission = fileTooLarge || fileNotSelected || unallowedFileSubmitted || requiredFilesNotSubmitted;\n            if (abortSubmission) {\n                window.clearTimeout(timeoutId);\n                this.enableSubmitButton(true);\n            } else {\n                settings = {\n                    type: 'POST',\n                    data: fd,\n                    processData: false,\n                    contentType: false,\n                    complete: this.enableSubmitButtonAfterResponse,\n                    success: function(response) {\n                        switch (response.success) {\n                        case 'submitted':\n                        case 'incorrect':\n                        case 'correct':\n                            that.render(response.contents);\n                            that.updateProgress(response);\n                            break;\n                        default:\n                            that.gentle_alert(response.success);\n                        }\n                        return Logger.log('problem_graded', [that.answers, response.contents], that.id);\n                    },\n                    error: function(response) {\n                        that.gentle_alert(response.responseJSON.success);\n                    }\n                };\n                $.ajaxWithPrefix('' + this.url + '/problem_check', settings);\n            }\n        };\n\n        Problem.prototype.submit = function() {\n            if (!this.submit_save_waitfor(this.submit_internal)) {\n                this.disableAllButtonsWhileRunning(this.submit_internal, true);\n            }\n        };\n\n        Problem.prototype.submit_internal = function() {\n            var that = this;\n            Logger.log('problem_check', this.answers);\n            return $.postWithPrefix('' + this.url + '/problem_check', this.answers, function(response) {\n                switch (response.success) {\n                case 'submitted':\n                case 'incorrect':\n                case 'correct':\n                    window.SR.readTexts(that.get_sr_status(response.contents));\n                    that.el.trigger('contentChanged', [that.id, response.contents, response]);\n                    that.render(response.contents, that.focus_on_submit_notification);\n                    that.updateProgress(response);\n                    break;\n                default:\n                    that.saveNotification.hide();\n                    that.gentle_alert(response.success);\n                }\n                return Logger.log('problem_graded', [that.answers, response.contents], that.id);\n            });\n        };\n\n        /**\n         * This method builds up an array of strings to send to the page screen-reader span.\n         * It first gets all elements with class \"status\", and then looks to see if they are contained\n         * in sections with aria-labels. If so, labels are prepended to the status element text.\n         * If not, just the text of the status elements are returned.\n         */\n        Problem.prototype.get_sr_status = function(contents) {\n            var addedStatus, ariaLabel, element, labeledStatus, parentSection, statusElement, template, i, len;\n            statusElement = $(contents).find('.status');\n            labeledStatus = [];\n            for (i = 0, len = statusElement.length; i < len; i++) {\n                element = statusElement[i];\n                parentSection = $(element).closest('.wrapper-problem-response');\n                addedStatus = false;\n                if (parentSection) {\n                    ariaLabel = parentSection.attr('aria-label');\n                    if (ariaLabel) {\n                        // Translators: This is only translated to allow for reordering of label and associated status.;\n                        template = gettext('{label}: {status}');\n                        labeledStatus.push(edx.StringUtils.interpolate(\n                            template, {\n                                label: ariaLabel,\n                                status: $(element).text()\n                            }\n                        ));\n                        addedStatus = true;\n                    }\n                }\n                if (!addedStatus) {\n                    labeledStatus.push($(element).text());\n                }\n            }\n            return labeledStatus;\n        };\n\n        Problem.prototype.reset = function() {\n            return this.disableAllButtonsWhileRunning(this.reset_internal, false);\n        };\n\n        Problem.prototype.reset_internal = function() {\n            var that = this;\n            Logger.log('problem_reset', this.answers);\n            return $.postWithPrefix('' + this.url + '/problem_reset', {\n                id: this.id\n            }, function(response) {\n                if (response.success) {\n                    that.el.trigger('contentChanged', [that.id, response.html, response]);\n                    that.render(response.html, that.scroll_to_problem_meta);\n                    that.updateProgress(response);\n                    return window.SR.readText(gettext('This problem has been reset.'));\n                } else {\n                    return that.gentle_alert(response.msg);\n                }\n            });\n        };\n\n        // TODO this needs modification to deal with javascript responses; perhaps we\n        // need something where responsetypes can define their own behavior when show\n        // is called.\n        Problem.prototype.show = function() {\n            var that = this;\n            Logger.log('problem_show', {\n                problem: this.id\n            });\n            return $.postWithPrefix('' + this.url + '/problem_show', function(response) {\n                var answers;\n                answers = response.answers;\n                $.each(answers, function(key, value) {\n                    var safeKey = key.replace(':', '\\\\:'); // fix for courses which use url_names with colons, e.g. problem:question1\n                    var answer;\n                    if (!$.isArray(value)) {\n                        answer = that.$('#answer_' + safeKey + ', #solution_' + safeKey);\n                        edx.HtmlUtils.setHtml(answer, edx.HtmlUtils.HTML(value));\n                        Collapsible.setCollapsibles(answer);\n\n                        // Sometimes, `value` is just a string containing a MathJax formula.\n                        // If this is the case, jQuery will throw an error in some corner cases\n                        // because of an incorrect selector. We setup a try..catch so that\n                        // the script doesn't break in such cases.\n                        //\n                        // We will fallback to the second `if statement` below, if an\n                        // error is thrown by jQuery.\n                        try {\n                            return $(value).find('.detailed-solution');\n                        } catch (e) {\n                            return {};\n                        }\n\n                        // TODO remove the above once everything is extracted into its own\n                        // inputtype functions.\n                    }\n                });\n                that.el.find('.capa_inputtype').each(function(index, inputtype) {\n                    var classes, cls, display, showMethod, i, len, results;\n                    classes = $(inputtype).attr('class').split(' ');\n                    results = [];\n                    for (i = 0, len = classes.length; i < len; i++) {\n                        cls = classes[i];\n                        display = that.inputtypeDisplays[$(inputtype).attr('id')];\n                        showMethod = that.inputtypeShowAnswerMethods[cls];\n                        if (showMethod != null) {\n                            results.push(showMethod(inputtype, display, answers, response.correct_status_html));\n                        } else {\n                            results.push(void 0);\n                        }\n                    }\n                    return results;\n                });\n                if (typeof MathJax !== 'undefined' && MathJax !== null) {\n                    that.el.find('.problem > div').each(function(index, element) {\n                        return MathJax.Hub.Queue(['Typeset', MathJax.Hub, element]);\n                    });\n                }\n                that.el.find('.show').attr('disabled', 'disabled');\n                that.updateProgress(response);\n                that.clear_all_notifications();\n                that.showAnswerNotification.show();\n                that.focus_on_notification('show-answer');\n            });\n        };\n\n        Problem.prototype.clear_all_notifications = function() {\n            this.submitNotification.remove();\n            this.gentleAlertNotification.hide();\n            this.saveNotification.hide();\n            this.showAnswerNotification.hide();\n        };\n\n        Problem.prototype.gentle_alert = function(msg) {\n            edx.HtmlUtils.setHtml(\n                this.el.find('.notification-gentle-alert .notification-message'),\n                edx.HtmlUtils.HTML(msg)\n            );\n            this.clear_all_notifications();\n            this.gentleAlertNotification.show();\n            this.gentleAlertNotification.focus();\n        };\n\n        Problem.prototype.save = function() {\n            if (!this.submit_save_waitfor(this.save_internal)) {\n                this.disableAllButtonsWhileRunning(this.save_internal, false);\n            }\n        };\n\n        Problem.prototype.save_internal = function() {\n            var that = this;\n            Logger.log('problem_save', this.answers);\n            return $.postWithPrefix('' + this.url + '/problem_save', this.answers, function(response) {\n                var saveMessage;\n                saveMessage = response.msg;\n                if (response.success) {\n                    that.el.trigger('contentChanged', [that.id, response.html, response]);\n                    edx.HtmlUtils.setHtml(\n                        that.el.find('.notification-save .notification-message'),\n                        edx.HtmlUtils.HTML(saveMessage)\n                    );\n                    that.clear_all_notifications();\n                    that.el.find('.wrapper-problem-response .message').hide();\n                    that.saveNotification.show();\n                    that.focus_on_save_notification();\n                } else {\n                    that.gentle_alert(saveMessage);\n                }\n            });\n        };\n\n        Problem.prototype.refreshMath = function(event, element) {\n            var elid, eqn, jax, mathjaxPreprocessor, preprocessorTag, target;\n            if (!element) {\n                element = event.target; // eslint-disable-line no-param-reassign\n            }\n            elid = element.id.replace(/^input_/, '');\n            target = 'display_' + elid;\n\n            // MathJax preprocessor is loaded by 'setupInputTypes'\n            preprocessorTag = 'inputtype_' + elid;\n            mathjaxPreprocessor = this.inputtypeDisplays[preprocessorTag];\n            if (typeof MathJax !== 'undefined' && MathJax !== null && MathJax.Hub.getAllJax(target)[0]) {\n                jax = MathJax.Hub.getAllJax(target)[0];\n                eqn = $(element).val();\n                if (mathjaxPreprocessor) {\n                    eqn = mathjaxPreprocessor(eqn);\n                }\n                MathJax.Hub.Queue(['Text', jax, eqn], [this.updateMathML, jax, element]);\n            }\n        };\n\n        Problem.prototype.updateMathML = function(jax, element) {\n            try {\n                $('#' + element.id + '_dynamath').val(jax.root.toMathML(''));\n            } catch (exception) {\n                if (!exception.restart) {\n                    throw exception;\n                }\n                if (typeof MathJax !== 'undefined' && MathJax !== null) {\n                    MathJax.Callback.After([this.refreshMath, jax], exception.restart);\n                }\n            }\n        };\n\n        Problem.prototype.refreshAnswers = function() {\n            this.$('input.schematic').each(function(index, element) {\n                return element.schematic.update_value();\n            });\n            this.$('.CodeMirror').each(function(index, element) {\n                if (element.CodeMirror.save) {\n                    element.CodeMirror.save();\n                }\n            });\n            this.answers = this.inputs.serialize();\n        };\n\n        /**\n         * Used to check available answers and if something is checked (or the answer is set in some textbox),\n         * the \"Submit\" button becomes enabled. Otherwise it is disabled by default.\n         *\n         * Arguments:\n         *    bind (boolean): used on the first check to attach event handlers to input fields\n         *       to change \"Submit\" enable status in case of some manipulations with answers\n         */\n        Problem.prototype.submitAnswersAndSubmitButton = function(bind) {\n            var answered, atLeastOneTextInputFound, oneTextInputFilled,\n                that = this;\n            if (bind === null || bind === undefined) {\n                bind = false; // eslint-disable-line no-param-reassign\n            }\n            answered = true;\n            atLeastOneTextInputFound = false;\n            oneTextInputFilled = false;\n            this.el.find('input:text').each(function(i, textField) {\n                if ($(textField).is(':visible')) {\n                    atLeastOneTextInputFound = true;\n                    if ($(textField).val() !== '') {\n                        oneTextInputFilled = true;\n                    }\n                    if (bind) {\n                        $(textField).on('input', function() {\n                            that.saveNotification.hide();\n                            that.showAnswerNotification.hide();\n                            that.submitAnswersAndSubmitButton();\n                        });\n                    }\n                }\n            });\n            if (atLeastOneTextInputFound && !oneTextInputFilled) {\n                answered = false;\n            }\n            this.el.find('.choicegroup').each(function(i, choicegroupBlock) {\n                var checked;\n                checked = false;\n                $(choicegroupBlock).find('input[type=checkbox], input[type=radio]').\n                    each(function(j, checkboxOrRadio) {\n                        if ($(checkboxOrRadio).is(':checked')) {\n                            checked = true;\n                        }\n                        if (bind) {\n                            $(checkboxOrRadio).on('click', function() {\n                                that.saveNotification.hide();\n                                that.el.find('.show').removeAttr('disabled');\n                                that.showAnswerNotification.hide();\n                                that.submitAnswersAndSubmitButton();\n                            });\n                        }\n                    });\n                if (!checked) {\n                    answered = false;\n                }\n            });\n            this.el.find('select').each(function(i, selectField) {\n                var selectedOption = $(selectField).find('option:selected').text()\n                    .trim();\n                if (selectedOption === 'Select an option') {\n                    answered = false;\n                }\n                if (bind) {\n                    $(selectField).on('change', function() {\n                        that.saveNotification.hide();\n                        that.showAnswerNotification.hide();\n                        that.submitAnswersAndSubmitButton();\n                    });\n                }\n            });\n            if (answered) {\n                return this.enableSubmitButton(true);\n            } else {\n                return this.enableSubmitButton(false, false);\n            }\n        };\n\n        Problem.prototype.bindResetCorrectness = function() {\n            // Loop through all input types.\n            // Bind the reset functions at that scope.\n            var $inputtypes,\n                that = this;\n            $inputtypes = this.el.find('.capa_inputtype').add(this.el.find('.inputtype'));\n            return $inputtypes.each(function(index, inputtype) {\n                var bindMethod, classes, cls, i, len, results;\n                classes = $(inputtype).attr('class').split(' ');\n                results = [];\n                for (i = 0, len = classes.length; i < len; i++) {\n                    cls = classes[i];\n                    bindMethod = that.bindResetCorrectnessByInputtype[cls];\n                    if (bindMethod != null) {\n                        results.push(bindMethod(inputtype));\n                    } else {\n                        results.push(void 0);\n                    }\n                }\n                return results;\n            });\n        };\n\n        // Find all places where each input type displays its correct-ness\n        // Replace them with their original state--'unanswered'.\n        Problem.prototype.bindResetCorrectnessByInputtype = {\n            // These are run at the scope of the capa inputtype\n            // They should set handlers on each <input> to reset the whole.\n            formulaequationinput: function(element) {\n                return $(element).find('input').on('input', function() {\n                    var $p;\n                    $p = $(element).find('span.status');\n                    $p.removeClass('correct incorrect submitted');\n                    return $p.parent().removeAttr('class').addClass('unsubmitted');\n                });\n            },\n            choicegroup: function(element) {\n                var $element, id;\n                $element = $(element);\n                id = ($element.attr('id').match(/^inputtype_(.*)$/))[1];\n                return $element.find('input').on('change', function() {\n                    var $status;\n                    $status = $('#status_' + id);\n                    if ($status[0]) {\n                        $status.removeAttr('class').addClass('status unanswered');\n                    } else {\n                        $('<span>', {\n                            class: 'status unanswered',\n                            style: 'display: inline-block;',\n                            id: 'status_' + id\n                        });\n                    }\n                    $element.find('label').find('span.status.correct').remove();\n                    return $element.find('label').removeAttr('class');\n                });\n            },\n            'option-input': function(element) {\n                var $select, id;\n                $select = $(element).find('select');\n                id = ($select.attr('id').match(/^input_(.*)$/))[1];\n                return $select.on('change', function() {\n                    return $('#status_' + id).removeAttr('class').addClass('unanswered')\n                        .find('.sr')\n                        .text(gettext('unsubmitted'));\n                });\n            },\n            textline: function(element) {\n                return $(element).find('input').on('input', function() {\n                    var $p;\n                    $p = $(element).find('span.status');\n                    $p.removeClass('correct incorrect submitted');\n                    return $p.parent().removeClass('correct incorrect').addClass('unsubmitted');\n                });\n            }\n        };\n\n        Problem.prototype.inputtypeSetupMethods = {\n            'text-input-dynamath': function(element) {\n                /*\n                 Return: function (eqn) -> eqn that preprocesses the user formula input before\n                 it is fed into MathJax. Return 'false' if no preprocessor specified\n                 */\n                var data, preprocessor, preprocessorClass, preprocessorClassName;\n                data = $(element).find('.text-input-dynamath_data');\n                preprocessorClassName = data.data('preprocessor');\n                preprocessorClass = window[preprocessorClassName];\n                if (preprocessorClass == null) {\n                    return false;\n                } else {\n                    preprocessor = new preprocessorClass();\n                    return preprocessor.fn;\n                }\n            },\n            cminput: function(container) {\n                var CodeMirrorEditor, CodeMirrorTextArea, element, id, linenumbers, mode, spaces, tabsize;\n                element = $(container).find('textarea');\n                tabsize = element.data('tabsize');\n                mode = element.data('mode');\n                linenumbers = element.data('linenums');\n                spaces = Array(parseInt(tabsize, 10) + 1).join(' ');\n                CodeMirrorEditor = CodeMirror.fromTextArea(element[0], {\n                    lineNumbers: linenumbers,\n                    indentUnit: tabsize,\n                    tabSize: tabsize,\n                    mode: mode,\n                    matchBrackets: true,\n                    lineWrapping: true,\n                    indentWithTabs: false,\n                    smartIndent: false,\n                    extraKeys: {\n                        Esc: function() {\n                            $('.grader-status').focus();\n                            return false;\n                        },\n                        Tab: function(cm) {\n                            cm.replaceSelection(spaces, 'end');\n                            return false;\n                        }\n                    }\n                });\n                id = element.attr('id').replace(/^input_/, '');\n                CodeMirrorTextArea = CodeMirrorEditor.getInputField();\n                CodeMirrorTextArea.setAttribute('id', 'cm-textarea-' + id);\n                CodeMirrorTextArea.setAttribute('aria-describedby', 'cm-editor-exit-message-' + id + ' status_' + id);\n                return CodeMirrorEditor;\n            }\n        };\n\n        Problem.prototype.inputtypeShowAnswerMethods = {\n            choicegroup: function(element, display, answers, correctStatusHtml) {\n                var answer, choice, inputId, i, len, results, $element, $inputLabel, $inputStatus;\n                $element = $(element);\n                inputId = $element.attr('id').replace(/inputtype_/, '');\n                inputId = inputId.replace(':', '\\\\:'); // fix for courses which use url_names with colons, e.g. problem:question1\n                answer = answers[inputId];\n                results = [];\n                for (i = 0, len = answer.length; i < len; i++) {\n                    choice = answer[i];\n                    $inputLabel = $element.find('#input_' + inputId + '_' + choice + ' + label');\n                    $inputStatus = $element.find('#status_' + inputId);\n                    // If the correct answer was already Submitted before \"Show Answer\" was selected,\n                    // the status HTML will already be present. Otherwise, inject the status HTML.\n\n                    // If the learner clicked a different answer after Submit, their submitted answers\n                    // will be marked as \"unanswered\". In that case, for correct answers update the\n                    // classes accordingly.\n                    if ($inputStatus.hasClass('unanswered')) {\n                        edx.HtmlUtils.append($inputLabel, edx.HtmlUtils.HTML(correctStatusHtml));\n                        $inputLabel.addClass('choicegroup_correct');\n                    } else if (!$inputLabel.hasClass('choicegroup_correct')) {\n                        // If the status HTML is not already present (due to clicking Submit), append\n                        // the status HTML for correct answers.\n                        edx.HtmlUtils.append($inputLabel, edx.HtmlUtils.HTML(correctStatusHtml));\n                        $inputLabel.removeClass('choicegroup_incorrect');\n                        results.push($inputLabel.addClass('choicegroup_correct'));\n                    }\n                }\n                return results;\n            },\n            choicetextgroup: function(element, display, answers) {\n                var answer, choice, inputId, i, len, results, $element;\n                $element = $(element);\n                inputId = $element.attr('id').replace(/inputtype_/, '');\n                answer = answers[inputId];\n                results = [];\n                for (i = 0, len = answer.length; i < len; i++) {\n                    choice = answer[i];\n                    results.push($element.find('section#forinput' + choice).addClass('choicetextgroup_show_correct'));\n                }\n                return results;\n            },\n            imageinput: function(element, display, answers) {\n                // answers is a dict of (answer_id, answer_text) for each answer for this question.\n                //\n                // @Examples:\n                // {'anwser_id': {\n                //    'rectangle': '(10,10)-(20,30);(12,12)-(40,60)',\n                //    'regions': '[[10,10], [30,30], [10, 30], [30, 10]]'\n                // } }\n                var canvas, container, id, types, context, $element;\n                types = {\n                    rectangle: function(ctx, coords) {\n                        var rects, reg;\n                        reg = /^\\(([0-9]+),([0-9]+)\\)-\\(([0-9]+),([0-9]+)\\)$/;\n                        rects = coords.replace(/\\s*/g, '').split(/;/);\n                        $.each(rects, function(index, rect) {\n                            var abs, height, points, width;\n                            abs = Math.abs;\n                            points = reg.exec(rect);\n                            if (points) {\n                                width = abs(points[3] - points[1]);\n                                height = abs(points[4] - points[2]);\n                                ctx.rect(points[1], points[2], width, height);\n                            }\n                        });\n                        ctx.stroke();\n                        return ctx.fill();\n                    },\n                    regions: function(ctx, coords) {\n                        var parseCoords;\n                        parseCoords = function(coordinates) {\n                            var reg;\n                            reg = JSON.parse(coordinates);\n\n                            // Regions is list of lists [region1, region2, region3, ...] where regionN\n                            // is disordered list of points: [[1,1], [100,100], [50,50], [20, 70]].\n                            // If there is only one region in the list, simpler notation can be used:\n                            // regions=\"[[10,10], [30,30], [10, 30], [30, 10]]\" (without explicitly\n                            // setting outer list)\n                            if (typeof reg[0][0][0] === 'undefined') {\n                                // we have [[1,2],[3,4],[5,6]] - single region\n                                // instead of [[[1,2],[3,4],[5,6], [[1,2],[3,4],[5,6]]]\n                                // or [[[1,2],[3,4],[5,6]]] - multiple regions syntax\n                                reg = [reg];\n                            }\n                            return reg;\n                        };\n                        return $.each(parseCoords(coords), function(index, region) {\n                            ctx.beginPath();\n                            $.each(region, function(idx, point) {\n                                if (idx === 0) {\n                                    return ctx.moveTo(point[0], point[1]);\n                                } else {\n                                    return ctx.lineTo(point[0], point[1]);\n                                }\n                            });\n                            ctx.closePath();\n                            ctx.stroke();\n                            return ctx.fill();\n                        });\n                    }\n                };\n                $element = $(element);\n                id = $element.attr('id').replace(/inputtype_/, '');\n                container = $element.find('#answer_' + id);\n                canvas = document.createElement('canvas');\n                canvas.width = container.data('width');\n                canvas.height = container.data('height');\n                if (canvas.getContext) {\n                    context = canvas.getContext('2d');\n                } else {\n                    console.log('Canvas is not supported.'); // eslint-disable-line no-console\n                }\n                context.fillStyle = 'rgba(255,255,255,.3)';\n                context.strokeStyle = '#FF0000';\n                context.lineWidth = '2';\n                if (answers[id]) {\n                    $.each(answers[id], function(key, value) {\n                        if ((types[key] !== null && types[key] !== undefined) && value) {\n                            types[key](context, value);\n                        }\n                    });\n                    edx.HtmlUtils.setHtml(container, edx.HtmlUtils.HTML(canvas));\n                } else {\n                    console.log('Answer is absent for image input with id=' + id); // eslint-disable-line no-console\n                }\n            }\n        };\n\n        /**\n         * Used to keep the buttons disabled while operationCallback is running.\n         *\n         * params:\n         *      'operationCallback' is an operation to be run.\n         *      isFromCheckOperation' is a boolean to keep track if 'operationCallback' was\n         *           from submit, if so then text of submit button will be changed as well.\n         *\n         */\n        Problem.prototype.disableAllButtonsWhileRunning = function(operationCallback, isFromCheckOperation) {\n            var that = this;\n            var allButtons = [this.resetButton, this.saveButton, this.showButton, this.hintButton, this.submitButton];\n            var initiallyEnabledButtons = allButtons.filter(function(button) {\n                return !button.attr('disabled');\n            });\n            this.enableButtons(initiallyEnabledButtons, false, isFromCheckOperation);\n            return operationCallback().always(function() {\n                return that.enableButtons(initiallyEnabledButtons, true, isFromCheckOperation);\n            });\n        };\n\n        /**\n         * Enables/disables buttons by removing/adding the disabled attribute. The submit button is checked\n         *     separately due to the changing text it contains.\n         *\n         * params:\n         *     'buttons' is an array of buttons that will have their 'disabled' attribute modified\n         *     'enable' a boolean to either enable or disable the buttons passed in the first parameter\n         *     'changeSubmitButtonText' is a boolean to keep track if operation was initiated\n         *         from submit so that text of submit button will also be changed while disabling/enabling\n         *         the submit button.\n         */\n        Problem.prototype.enableButtons = function(buttons, enable, changeSubmitButtonText) {\n            var that = this;\n            buttons.forEach(function(button) {\n                if (button.hasClass('submit')) {\n                    that.enableSubmitButton(enable, changeSubmitButtonText);\n                } else if (enable) {\n                    button.removeAttr('disabled');\n                } else {\n                    button.attr({disabled: 'disabled'});\n                }\n            });\n        };\n\n        /**\n         *  Used to disable submit button to reduce chance of accidental double-submissions.\n         *\n         * params:\n         *     'enable' is a boolean to determine enabling/disabling of submit button.\n         *     'changeText' is a boolean to determine if there is need to change the\n         *         text of submit button as well.\n         */\n        Problem.prototype.enableSubmitButton = function(enable, changeText) {\n            var submitCanBeEnabled;\n            if (changeText === null || changeText === undefined) {\n                changeText = true; // eslint-disable-line no-param-reassign\n            }\n            if (enable) {\n                submitCanBeEnabled = this.submitButton.data('should-enable-submit-button') === 'True';\n                if (submitCanBeEnabled) {\n                    this.submitButton.removeAttr('disabled');\n                }\n                if (changeText) {\n                    this.submitButtonLabel.text(this.submitButtonSubmitText);\n                }\n            } else {\n                this.submitButton.attr({disabled: 'disabled'});\n                if (changeText) {\n                    this.submitButtonLabel.text(this.submitButtonSubmittingText);\n                }\n            }\n        };\n\n        Problem.prototype.enableSubmitButtonAfterResponse = function() {\n            this.has_response = true;\n            if (!this.has_timed_out) {\n                // Server has returned response before our timeout.\n                return this.enableSubmitButton(false);\n            } else {\n                return this.enableSubmitButton(true);\n            }\n        };\n\n        Problem.prototype.enableSubmitButtonAfterTimeout = function() {\n            var enableSubmitButton,\n                that = this;\n            this.has_timed_out = false;\n            this.has_response = false;\n            enableSubmitButton = function() {\n                that.has_timed_out = true;\n                if (that.has_response) {\n                    that.enableSubmitButton(true);\n                }\n            };\n            return window.setTimeout(enableSubmitButton, 750);\n        };\n\n        Problem.prototype.hint_button = function() {\n            // Store the index of the currently shown hint as an attribute.\n            // Use that to compute the next hint number when the button is clicked.\n            var hintContainer, hintIndex, nextIndex,\n                that = this;\n            hintContainer = this.$('.problem-hint');\n            hintIndex = hintContainer.attr('hint_index');\n            if (hintIndex === void 0) {\n                nextIndex = 0;\n            } else {\n                nextIndex = parseInt(hintIndex, 10) + 1;\n            }\n            return $.postWithPrefix('' + this.url + '/hint_button', {\n                hint_index: nextIndex,\n                input_id: this.id\n            }, function(response) {\n                var hintMsgContainer;\n                if (response.success) {\n                    hintMsgContainer = that.$('.problem-hint .notification-message');\n                    hintContainer.attr('hint_index', response.hint_index);\n                    edx.HtmlUtils.setHtml(hintMsgContainer, edx.HtmlUtils.HTML(response.msg));\n                    MathJax.Hub.Queue(['Typeset', MathJax.Hub, hintContainer[0]]);\n                    if (response.should_enable_next_hint) {\n                        that.hintButton.removeAttr('disabled');\n                    } else {\n                        that.hintButton.attr({disabled: 'disabled'});\n                    }\n                    that.el.find('.notification-hint').show();\n                    that.focus_on_hint_notification(nextIndex);\n                } else {\n                    that.gentle_alert(response.msg);\n                }\n            });\n        };\n\n        return Problem;\n    }).call(this);\n}).call(this);\n\n}.call(window));\n\n\n// WEBPACK FOOTER //\n// ./common/static/xmodule/modules/js/002-37ce0eea8f9a85c26819ef3b8b3a37d4.js","/*** IMPORTS FROM imports-loader ***/\n(function() {\n\n(function(undefined) {\n    'use strict';\n\n    // [module Collapsible]\n    //\n    // [description]\n    //     Set of library functions that provide a simple way to add\n    //     collapsible functionality to elements.\n    this.Collapsible = {\n        setCollapsibles: setCollapsibles,\n        toggleFull: toggleFull,\n        toggleHint: toggleHint\n    };\n\n    return;\n\n    // [function setCollapsibles]\n    //\n    // [description]\n    //     Scan element's content for generic collapsible containers.\n    //\n    // [params]\n    //     el: container\n    function setCollapsibles(el) {\n        var linkBottom, linkTop, short_custom;\n\n        linkTop = '<a href=\"#\" class=\"full full-top\">See full output</a>';\n        linkBottom = '<a href=\"#\" class=\"full full-bottom\">See full output</a>';\n\n        // Standard longform + shortfom pattern.\n        el.find('.longform').hide();\n        el.find('.shortform').append(linkTop, linkBottom);\n\n        // Custom longform + shortform text pattern.\n        short_custom = el.find('.shortform-custom');\n\n        // Set up each one individually.\n        short_custom.each(function(index, elt) {\n            var close_text, open_text;\n\n            open_text = $(elt).data('open-text');\n            close_text = $(elt).data('close-text');\n            $(elt).append(\"<a href='#' class='full-custom'>\" + open_text + '</a>');\n\n            $(elt).find('.full-custom').click(function(event) {\n                Collapsible.toggleFull(event, open_text, close_text);\n            });\n        });\n\n        // Collapsible pattern.\n        el.find('.collapsible header + section').hide();\n\n        // Set up triggers.\n        el.find('.full').click(function(event) {\n            Collapsible.toggleFull(event, 'See full output', 'Hide output');\n        });\n        el.find('.collapsible header a').click(Collapsible.toggleHint);\n    }\n\n    // [function toggleFull]\n    //\n    // [description]\n    //     Toggle the display of full text for a collapsible element.\n    //\n    // [params]\n    //     event: jQuery event object associated with the event that\n    //         triggered this callback function.\n    //     open_text: text that should be displayed when the collapsible\n    //         is open.\n    //     close_text: text that should be displayed when the collapsible\n    //         is closed.\n    function toggleFull(event, open_text, close_text) {\n        var $el, new_text, parent;\n\n        event.preventDefault();\n\n        parent = $(event.target).parent();\n        parent.siblings().slideToggle();\n        parent.parent().toggleClass('open');\n\n        if ($(event.target).text() === open_text) {\n            new_text = close_text;\n        } else {\n            new_text = open_text;\n        }\n\n        if ($(event.target).hasClass('full')) {\n            $el = parent.find('.full');\n        } else {\n            $el = $(event.target);\n        }\n\n        $el.text(new_text);\n    }\n\n    // [function toggleHint]\n    //\n    // [description]\n    //     Toggle the collapsible open to show the hint.\n    //\n    // [params]\n    //     event: jQuery event object associated with the event that\n    //         triggered this callback function.\n    function toggleHint(event) {\n        event.preventDefault();\n\n        $(event.target).parent().siblings().slideToggle();\n        $(event.target).parent().parent().toggleClass('open');\n    }\n}).call(this);\n\n}.call(window));\n\n\n// WEBPACK FOOTER //\n// ./common/static/xmodule/modules/js/003-d47e678753905042c21bbc110fb3f8d8.js","/*** IMPORTS FROM imports-loader ***/\n(function() {\n\n/**\n * Simple image input\n *\n *\n * Click on image. Update the coordinates of a dot on the image.\n * The new coordinates are the location of the click.\n */\n\n/**\n * 'The wise adapt themselves to circumstances, as water molds itself to the\n * pitcher.'\n *\n * ~ Chinese Proverb\n */\n\nwindow.ImageInput = (function($, undefined) {\n    var ImageInput = ImageInputConstructor;\n\n    ImageInput.prototype = {\n        constructor: ImageInputConstructor,\n        clickHandler: clickHandler\n    };\n\n    return ImageInput;\n\n    function ImageInputConstructor(elementId) {\n        this.el = $('#imageinput_' + elementId);\n        this.crossEl = $('#cross_' + elementId);\n        this.inputEl = $('#input_' + elementId);\n\n        this.el.on('click', this.clickHandler.bind(this));\n    }\n\n    function clickHandler(event) {\n        var offset = this.el.offset(),\n            posX = event.offsetX ?\n                event.offsetX : event.pageX - offset.left,\n            posY = event.offsetY ?\n                event.offsetY : event.pageY - offset.top,\n\n            // To reduce differences between values returned by different kinds\n            // of browsers, we round `posX` and `posY`.\n            //\n            // IE10: `posX` and `posY` - float.\n            // Chrome, FF: `posX` and `posY` - integers.\n            result = '[' + Math.round(posX) + ',' + Math.round(posY) + ']';\n\n        this.crossEl.css({\n            left: posX - 15,\n            top: posY - 15,\n            visibility: 'visible'\n        });\n\n        this.inputEl.val(result);\n    }\n}).call(this, window.jQuery);\n\n}.call(window));\n\n\n// WEBPACK FOOTER //\n// ./common/static/xmodule/modules/js/004-b0c34afa95eaa6b45d843d92ca523a94.js","/*** IMPORTS FROM imports-loader ***/\n(function() {\n\n/* eslint-disable */\n\n//////////////////////////////////////////////////////////////////////////////\n//\n//  Circuit simulator\n//\n//////////////////////////////////////////////////////////////////////////////\n\n// Copyright (C) 2011 Massachusetts Institute of Technology\n\n\n// create a circuit for simulation using \"new cktsim.Circuit()\"\n\n// for modified nodal analysis (MNA) stamps see\n// http://www.analog-electronics.eu/analog-electronics/modified-nodal-analysis/modified-nodal-analysis.xhtml\n\nvar cktsim = (function() {\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Circuit\n\t//\n\t//////////////////////////////////////////////////////////////////////////////\n\n    // types of \"nodes\" in the linear system\n    var T_VOLTAGE = 0;\n    var T_CURRENT = 1;\n\n    var v_newt_lim = 0.3; // Voltage limited Newton great for Mos/diodes\n    var v_abstol = 1e-6; // Absolute voltage error tolerance\n    var i_abstol = 1e-12; // Absolute current error tolerance\n    var eps = 1.0e-12; // A very small number compared to one.\n    var dc_max_iters = 1000; // max iterations before giving up\n    var max_tran_iters = 20; // max iterations before giving up\n    var time_step_increase_factor = 2.0; // How much can lte let timestep grow.\n    var lte_step_decrease_factor = 8; // Limit lte one-iter timestep shrink.\n    var nr_step_decrease_factor = 4; // Newton failure timestep shrink.\n    var reltol = 0.0001; // Relative tol to max observed value\n    var lterel = 10; // LTE/Newton tolerance ratio (> 10!)\n    var res_check_abs = Math.sqrt(i_abstol); // Loose Newton residue check\n    var res_check_rel = Math.sqrt(reltol); // Loose Newton residue check\n\n\tfunction Circuit() {\n        this.node_map = [];\n\t    this.ntypes = [];\n        this.initial_conditions = [];\n        this.devices = [];\n        this.device_map = [];\n        this.voltage_sources = [];\n        this.current_sources = [];\n\t    this.finalized = false;\n\t    this.diddc = false;\n\t    this.node_index = -1;\n\t    this.periods = 1\n\t}\n\n\t// index of ground node\n\tCircuit.prototype.gnd_node = function() {\n\t    return -1;\n\t}\n\n\t// allocate a new node index\n\tCircuit.prototype.node = function(name,ntype,ic) {\n\t    this.node_index += 1;\n\t    if (name) this.node_map[name] = this.node_index;\n\t    this.ntypes.push(ntype);\n\t    this.initial_conditions.push(ic);\n\t    return this.node_index;\n\t}\n\n\t// call to finalize the circuit in preparation for simulation\n\tCircuit.prototype.finalize = function() {\n\t    if (!this.finalized) {\n\t\tthis.finalized = true;\n\t\tthis.N = this.node_index + 1;  // number of nodes\n\n\t\t// give each device a chance to finalize itself\n\t\tfor (var i = this.devices.length - 1; i >= 0; --i)\n\t\t    this.devices[i].finalize(this);\n\n\t\t// set up augmented matrix and various temp vectors\n\t\tthis.matrix = mat_make(this.N, this.N+1);\n\t\tthis.Gl = mat_make(this.N, this.N);  // Matrix for linear conductances\n\t\tthis.G = mat_make(this.N, this.N);  // Complete conductance matrix\n\t\tthis.C = mat_make(this.N, this.N);  // Matrix for linear L's and C's\n\n\t\tthis.soln_max = new Array(this.N);   // max abs value seen for each unknown\n\t\tthis.abstol = new Array(this.N);\n\t\tthis.solution = new Array(this.N);\n\t\tthis.rhs = new Array(this.N);\n\t\tfor (var i = this.N - 1; i >= 0; --i) {\n\t\t    this.soln_max[i] = 0.0;\n\t\t    this.abstol[i] = this.ntypes[i] == T_VOLTAGE ? v_abstol : i_abstol;\n\t\t    this.solution[i] = 0.0;\n\t\t    this.rhs[i] = 0.0;\n\t\t}\n\n\t\t// Load up the linear elements once and for all\n\t\tfor (var i = this.devices.length - 1; i >= 0; --i) {\n\t\t    this.devices[i].load_linear(this)\n\t\t}\n\n\t\t// Check for voltage source loops.\n        var n_vsrc = this.voltage_sources.length;\n\t\tif (n_vsrc > 0) { // At least one voltage source\n\t\t    var GV = mat_make(n_vsrc, this.N);  // Loop check\n\t\t    for (var i = n_vsrc - 1; i >= 0; --i) {\n\t\t\tvar branch = this.voltage_sources[i].branch;\n\t\t\tfor (var j = this.N - 1; j >= 0; j--)\n\t\t\t    GV[i][j] = this.Gl[branch][j];\n\t\t    }\n\t\t    var rGV = mat_rank(GV);\n\t\t    if (rGV < n_vsrc) {\n\t\t\talert('Warning!!! Circuit has a voltage source loop or a source or current probe shorted by a wire, please remove the source or the wire causing the short.');\n\t\t\talert('Warning!!! Simulator might produce meaningless results or no result with illegal circuits.');\n\t\t\treturn false;\n\t\t    }\n\t\t}\n\t    }\n\t    return true;\n\t}\n\n\t// load circuit from JSON netlist (see schematic.js)\n\tCircuit.prototype.load_netlist = function(netlist) {\n\t    // set up mapping for all ground connections\n\t    for (var i = netlist.length - 1; i >= 0; --i) {\n\t\tvar component = netlist[i];\n\t\tvar type = component[0];\n\t\tif (type == 'g') {\n\t\t    var connections = component[3];\n\t\t    this.node_map[connections[0]] = this.gnd_node();\n\t\t}\n\t    }\n\n\t    // process each component in the JSON netlist (see schematic.js for format)\n\t    var found_ground = false;\n\t    for (var i = netlist.length - 1; i >= 0; --i) {\n\t\tvar component = netlist[i];\n\t\tvar type = component[0];\n\n\t\t// ignore wires, ground connections, scope probes and view info\n\t\tif (type == 'view' || type == 'w' || type == 'g' || type == 's' || type == 'L') {\n\t\t    continue;\n\t\t}\n\n\t\tvar properties = component[2];\n\t\tvar name = properties['name'];\n\t\tif (name==undefined || name=='')\n\t\t    name = '_' + properties['_json_'].toString();\n\n\t\t// convert node names to circuit indicies\n\t\tvar connections = component[3];\n\t\tfor (var j = connections.length - 1; j >= 0; --j) {\n\t\t    var node = connections[j];\n\t\t    var index = this.node_map[node];\n\t\t    if (index == undefined) index = this.node(node,T_VOLTAGE);\n\t\t    else if (index == this.gnd_node()) found_ground = true;\n\t\t    connections[j] = index;\n\t\t}\n\n\t\t// process the component\n\t\tif (type == 'r')\t// resistor\n\t\t    this.r(connections[0],connections[1],properties['r'],name);\n\t\telse if (type == 'd')\t// diode\n\t\t    this.d(connections[0],connections[1],properties['area'],properties['type'],name);\n\t\telse if (type == 'c')   // capacitor\n\t\t    this.c(connections[0],connections[1],properties['c'],name);\n\t\telse if (type == 'l')\t// inductor\n\t\t    this.l(connections[0],connections[1],properties['l'],name);\n\t\telse if (type == 'v') \t// voltage source\n\t\t    this.v(connections[0],connections[1],properties['value'],name);\n\t\telse if (type == 'i') \t// current source\n\t\t    this.i(connections[0],connections[1],properties['value'],name);\n\t\telse if (type == 'o') \t// op amp\n\t\t    this.opamp(connections[0],connections[1],connections[2],connections[3],properties['A'],name);\n\t\telse if (type == 'n') \t// n fet\n\t\t    this.n(connections[0],connections[1],connections[2],properties['W/L'],name);\n\t\telse if (type == 'p') \t// p fet\n\t\t    this.p(connections[0],connections[1],connections[2],properties['W/L'],name);\n\t\telse if (type == 'a') \t// current probe == 0-volt voltage source\n\t\t    this.v(connections[0],connections[1],'0',name);\n\t    }\n\n\t    if (!found_ground) { // No ground on schematic\n\t\talert('Please make at least one connection to ground  (inverted T symbol)');\n\t\treturn false;\n\t    }\n\t    return true;\n\t}\n\n\t// if converges: updates this.solution, this.soln_max, returns iter count\n\t// otherwise: return undefined and set this.problem_node\n\t// Load should compute -f and df/dx (note the sign pattern!)\n        Circuit.prototype.find_solution = function(load,maxiters) {\n\t    var soln = this.solution;\n\t    var rhs = this.rhs;\n\t    var d_sol = [];\n\t    var abssum_compare;\n\t    var converged,abssum_old=0, abssum_rhs;\n\t    var use_limiting = false;\n\t    var down_count = 0;\n        var thresh;\n\n\t    // iteratively solve until values convere or iteration limit exceeded\n\t    for (var iter = 0; iter < maxiters; iter++) {\n\t\t// set up equations\n\t\tload(this,soln,rhs);\n\n\t\t// Compute norm of rhs, assume variables of v type go with eqns of i type\n\t\tabssum_rhs = 0;\n\t\tfor (var i = this.N - 1; i >= 0; --i)\n\t\t    if (this.ntypes[i] == T_VOLTAGE)\n\t\t\tabssum_rhs += Math.abs(rhs[i]);\n\n\t\tif ((iter > 0) && (use_limiting == false) && (abssum_old < abssum_rhs)) {\n\t\t    // Old rhsnorm was better, undo last iter and turn on limiting\n\t\t    for (var i = this.N - 1; i >= 0; --i)\n\t\t\tsoln[i] -= d_sol[i];\n\t\t    iter -= 1;\n\t\t    use_limiting = true;\n\t\t}\n\t        else {  // Compute the Newton delta\n\t\t    d_sol = mat_solve_rq(this.matrix,rhs);\n\n\t\t    // If norm going down for ten iters, stop limiting\n\t\t    if (abssum_rhs < abssum_old)\n\t\t\tdown_count += 1;\n\t\t    else\n\t\t\tdown_count = 0;\n\t\t    if (down_count > 10) {\n\t\t\tuse_limiting = false;\n\t\t\tdown_count = 0;\n\t\t    }\n\n\t\t    // Update norm of rhs\n\t\t    abssum_old = abssum_rhs;\n\t\t}\n\n\t\t// Update the worst case abssum for comparison.\n\t\tif ((iter == 0) || (abssum_rhs > abssum_compare))\n\t\t    abssum_compare = abssum_rhs;\n\n\t\t// Check residue convergence, but loosely, and give up\n\t\t// on last iteration\n\t\tif ( (iter < (maxiters - 1)) &&\n\t\t     (abssum_rhs > (res_check_abs+res_check_rel*abssum_compare)))\n\t\t    converged = false;\n\t\telse converged = true;\n\n\n\t\t// Update solution and check delta convergence\n\t\tfor (var i = this.N - 1; i >= 0; --i) {\n\t\t    // Simple voltage step limiting to encourage Newton convergence\n\t\t    if (use_limiting) {\n\t\t\tif (this.ntypes[i] == T_VOLTAGE) {\n\t\t\t    d_sol[i] = (d_sol[i] > v_newt_lim) ? v_newt_lim : d_sol[i];\n\t\t\t    d_sol[i] = (d_sol[i] < -v_newt_lim) ? -v_newt_lim : d_sol[i];\n\t\t\t}\n\t\t    }\n\t\t    soln[i] += d_sol[i];\n\t\t    thresh = this.abstol[i] + reltol*this.soln_max[i];\n\t\t    if (Math.abs(d_sol[i]) > thresh) {\n\t\t\tconverged = false;\n\t\t\tthis.problem_node = i;\n\t\t    }\n\t\t}\n\n                if (converged == true) {\n\t\t    for (var i = this.N - 1; i >= 0; --i)\n\t\t\tif (Math.abs(soln[i]) > this.soln_max[i])\n\t\t\t    this.soln_max[i] = Math.abs(soln[i]);\n\t\t    return iter+1;\n\t\t}\n\t    }\n\t    return undefined;\n\t}\n\n\t// DC analysis\n\tCircuit.prototype.dc = function() {\n\t    // Allocation matrices for linear part, etc.\n\t    if (this.finalize() == false)\n\t\treturn undefined;\n\n\t    // Define -f and df/dx for Newton solver\n\t    function load_dc(ckt,soln,rhs) {\n\t\t// rhs is initialized to -Gl * soln\n\t\tmat_v_mult(ckt.Gl, soln, rhs, -1.0);\n\t\t// G matrix is initialized with linear Gl\n\t\tmat_copy(ckt.Gl,ckt.G);\n\t\t// Now load up the nonlinear parts of rhs and G\n\t\tfor (var i = ckt.devices.length - 1; i >= 0; --i)\n\t\t\tckt.devices[i].load_dc(ckt,soln,rhs);\n\t\t// G matrix is copied in to the system matrix\n\t\tmat_copy(ckt.G,ckt.matrix);\n\t    }\n\n\t    // find the operating point\n\t    var iterations = this.find_solution(load_dc,dc_max_iters);\n\n\t    if (typeof iterations == 'undefined') {\n\t    // too many iterations\n\t\tif (this.current_sources.length > 0) {\n\t\t    alert('Newton Method Failed, do your current sources have a conductive path to ground?');\n\t\t} else {\n\t\t    alert('Newton Method Failed, it may be your circuit or it may be our simulator.');\n\t\t}\n\n\t\treturn undefined\n\t    } else {\n\t\t// Note that a dc solution was computed\n\t\tthis.diddc = true;\n\t\t// create solution dictionary\n        var result = [];\n\t\t// capture node voltages\n\t\tfor (var name in this.node_map) {\n\t\t    var index = this.node_map[name];\n\t\t    result[name] = (index == -1) ? 0 : this.solution[index];\n\t\t}\n\t\t// capture branch currents from voltage sources\n\t\tfor (var i = this.voltage_sources.length - 1; i >= 0; --i) {\n\t\t    var v = this.voltage_sources[i];\n\t\t    result['I('+v.name+')'] = this.solution[v.branch];\n\t\t}\n\t\treturn result;\n\t    }\n\t}\n\n\t// Transient analysis (needs work!)\n        Circuit.prototype.tran = function(ntpts, tstart, tstop, probenames, no_dc) {\n\n\t    // Define -f and df/dx for Newton solver\n\t    function load_tran(ckt,soln,rhs) {\n\t\t// Crnt is initialized to -Gl * soln\n\t\tmat_v_mult(ckt.Gl, soln, ckt.c,-1.0);\n\t\t// G matrix is initialized with linear Gl\n\t\tmat_copy(ckt.Gl,ckt.G);\n\t\t// Now load up the nonlinear parts of crnt and G\n\t\tfor (var i = ckt.devices.length - 1; i >= 0; --i)\n\t\t    ckt.devices[i].load_tran(ckt,soln,ckt.c,ckt.time);\n\t\t// Exploit the fact that storage elements are linear\n\t\tmat_v_mult(ckt.C, soln, ckt.q, 1.0);\n\t\t// -rhs = c - dqdt\n\t\tfor (var i = ckt.N-1; i >= 0; --i) {\n\t\t    var dqdt = ckt.alpha0*ckt.q[i] + ckt.alpha1*ckt.oldq[i] +\n\t\t\tckt.alpha2*ckt.old2q[i];\n\t\t    rhs[i] = ckt.beta0[i]*ckt.c[i] + ckt.beta1[i]*ckt.oldc[i] - dqdt;\n\t\t}\n\t\t// matrix = beta0*G + alpha0*C.\n\t\tmat_scale_add(ckt.G,ckt.C,ckt.beta0,ckt.alpha0,ckt.matrix);\n\t    }\n\n\t    var p = new Array(3);\n\t    function interp_coeffs(t, t0, t1, t2) {\n\t\t// Poly coefficients\n\t\tvar dtt0 = (t - t0);\n\t\tvar dtt1 = (t - t1);\n\t\tvar dtt2 = (t - t2);\n\t\tvar dt0dt1 = (t0 - t1);\n\t\tvar dt0dt2 = (t0 - t2);\n\t\tvar dt1dt2 = (t1 - t2);\n\t\tp[0] = (dtt1*dtt2)/(dt0dt1 * dt0dt2);\n\t\tp[1] = (dtt0*dtt2)/(-dt0dt1 * dt1dt2);\n\t\tp[2] = (dtt0*dtt1)/(dt0dt2 * dt1dt2);\n\t\treturn p;\n\t    }\n\n\t    function pick_step(ckt, step_index) {\n\t\tvar min_shrink_factor = 1.0/lte_step_decrease_factor;\n\t        var max_growth_factor = time_step_increase_factor;\n\t\tvar N = ckt.N;\n\t\tvar p = interp_coeffs(ckt.time, ckt.oldt, ckt.old2t, ckt.old3t);\n\t\tvar trapcoeff = 0.5*(ckt.time - ckt.oldt)/(ckt.time - ckt.old3t);\n\t\tvar maxlteratio = 0.0;\n\t\tfor (var i = ckt.N-1; i >= 0; --i) {\n\t\t    if (ckt.ltecheck[i]) { // Check lte on variable\n\t\t\tvar pred = p[0]*ckt.oldsol[i] + p[1]*ckt.old2sol[i] + p[2]*ckt.old3sol[i];\n\t\t\tvar lte = Math.abs((ckt.solution[i] - pred))*trapcoeff;\n\t\t\tvar lteratio = lte/(lterel*(ckt.abstol[i] + reltol*ckt.soln_max[i]));\n\t\t\tmaxlteratio = Math.max(maxlteratio, lteratio);\n\t\t    }\n\t\t}\n\t\tvar new_step;\n\t\tvar lte_step_ratio = 1.0/Math.pow(maxlteratio,1/3); // Cube root because trap\n\t\tif (lte_step_ratio < 1.0) { // Shrink the timestep to make lte\n\t\t    lte_step_ratio = Math.max(lte_step_ratio,min_shrink_factor);\n\t\t    new_step = (ckt.time - ckt.oldt)*0.75*lte_step_ratio;\n\t\t    new_step = Math.max(new_step, ckt.min_step);\n\t\t} else {\n\t\t    lte_step_ratio = Math.min(lte_step_ratio, max_growth_factor);\n\t\t    if (lte_step_ratio > 1.2)  /* Increase timestep due to lte. */\n\t\t\tnew_step = (ckt.time - ckt.oldt) * lte_step_ratio / 1.2;\n\t\t    else\n\t\t\tnew_step = (ckt.time - ckt.oldt);\n\t\t    new_step = Math.min(new_step, ckt.max_step);\n\t\t}\n\t\treturn new_step;\n\t    }\n\n\t    // Standard to do a dc analysis before transient\n\t    // Otherwise, do the setup also done in dc.\n\t    no_dc = false;\n\t    if ((this.diddc == false) && (no_dc == false)) {\n\t\tif (this.dc() == undefined) { // DC failed, realloc mats and vects.\n\t\t    alert('DC failed, trying transient analysis from zero.');\n\t\t    this.finalized = false;  // Reset the finalization.\n\t\t    if (this.finalize() == false)\n\t\t\treturn undefined;\n\t\t}\n\t    }\n\t    else {\n\t\tif (this.finalize() == false) // Allocate matrices and vectors.\n\t\t    return undefined;\n\t    }\n\n\t    // Tired of typing this, and using \"with\" generates hate mail.\n\t    var N = this.N;\n\n\t    // build array to hold list of results for each variable\n\t    // last entry is for timepoints.\n\t    var response = new Array(N + 1);\n        for (var i = N; i >= 0; --i) response[i] = [];\n\n\t    // Allocate back vectors for up to a second order method\n\t    this.old3sol = new Array(this.N);\n\t    this.old3q = new Array(this.N);\n\t    this.old2sol = new Array(this.N);\n\t    this.old2q = new Array(this.N);\n\t    this.oldsol = new Array(this.N);\n\t    this.oldq = new Array(this.N);\n\t    this.q = new Array(this.N);\n\t    this.oldc = new Array(this.N);\n\t    this.c = new Array(this.N);\n\t    this.alpha0 = 1.0;\n\t    this.alpha1 = 0.0;\n\t    this.alpha2 = 0.0;\n\t    this.beta0 = new Array(this.N);\n\t    this.beta1 = new Array(this.N);\n\n\t    // Mark a set of algebraic variable (don't miss hidden ones!).\n\t    this.ar = this.algebraic(this.C);\n\n\t    // Non-algebraic variables and probe variables get lte\n\t    this.ltecheck = new Array(this.N);\n\t    for (var i = N; i >= 0; --i)\n\t\tthis.ltecheck[i] = (this.ar[i] == 0);\n\n\t    for (var name in this.node_map) {\n\t\tvar index = this.node_map[name];\n\t\tfor (var i = probenames.length; i >= 0; --i) {\n\t\t    if (name == probenames[i]) {\n\t\t\tthis.ltecheck[index] = true;\n\t\t\tbreak;\n\t\t    }\n\t\t}\n\t    }\n\n\t    // Check for periodic sources\n\t    var period = tstop - tstart;\n\t    for (var i = this.voltage_sources.length - 1; i >= 0; --i) {\n\t\tvar per = this.voltage_sources[i].src.period;\n\t\tif (per > 0)\n\t\t    period = Math.min(period, per);\n\t    }\n\t    for (var i = this.current_sources.length - 1; i >= 0; --i) {\n\t\tvar per = this.current_sources[i].src.period;\n\t\tif (per > 0)\n\t\t    period = Math.min(period, per);\n\t    }\n\t    this.periods = Math.ceil((tstop - tstart)/period);\n\n\t    this.time = tstart;\n\t    // ntpts adjusted by numbers of periods in input\n\t    this.max_step = (tstop - tstart)/(this.periods*ntpts);\n\t    this.min_step = this.max_step/1e8;\n\t    var new_step = this.max_step/1e6;\n\t    this.oldt = this.time - new_step;\n\n\t    // Initialize old crnts, charges, and solutions.\n\t    load_tran(this,this.solution,this.rhs)\n\t    for (var i = N-1; i >= 0; --i) {\n\t\tthis.old3sol[i] = this.solution[i];\n\t\tthis.old2sol[i] = this.solution[i];\n\t\tthis.oldsol[i] = this.solution[i];\n\t\tthis.old3q[i] = this.q[i];\n\t\tthis.old2q[i] = this.q[i];\n\t\tthis.oldq[i] = this.q[i];\n\t\tthis.oldc[i] = this.c[i];\n\t    }\n\n\t    var beta0,beta1;\n\t    // Start with two pseudo-Euler steps, maximum 50000 steps/period\n\t    var max_nsteps = this.periods*50000;\n\t    for(var step_index = -3; step_index < max_nsteps; step_index++) {\n\t\t// Save the just computed solution, and move back q and c.\n\t\tfor (var i = this.N - 1; i >= 0; --i) {\n\t\t    if (step_index >= 0)\n\t\t\tresponse[i].push(this.solution[i]);\n\t\t    this.oldc[i] = this.c[i];\n\t\t    this.old3sol[i] = this.old2sol[i];\n\t\t    this.old2sol[i] = this.oldsol[i];\n\t\t    this.oldsol[i] = this.solution[i];\n\t\t    this.old3q[i] = this.oldq[i];\n\t\t    this.old2q[i] = this.oldq[i];\n\t\t    this.oldq[i] = this.q[i];\n\t\t}\n\n\t\tif (step_index < 0) {  // Take a prestep using BE\n\t\t    this.old3t = this.old2t - (this.oldt-this.old2t)\n\t\t    this.old2t = this.oldt - (tstart-this.oldt)\n\t\t    this.oldt = tstart - (this.time - this.oldt);\n\t\t    this.time = tstart;\n\t\t    beta0 = 1.0;\n\t\t    beta1 = 0.0;\n\t\t} else {  // Take a regular step\n\t\t    // Save the time, and rotate time wheel\n\t\t    response[this.N].push(this.time);\n\t\t    this.old3t = this.old2t;\n\t\t    this.old2t = this.oldt;\n\t\t    this.oldt = this.time;\n\t\t    // Make sure we come smoothly in to the interval end.\n\t\t    if (this.time >= tstop) break;  // We're done.\n\t\t    else if(this.time + new_step > tstop)\n\t\t\tthis.time = tstop;\n\t\t    else if(this.time + 1.5*new_step > tstop)\n\t\t\tthis.time += (2/3)*(tstop - this.time);\n\t\t    else\n\t\t\tthis.time += new_step;\n\n\t\t    // Use trap (average old and new crnts.\n\t\t    beta0 = 0.5;\n\t\t    beta1 = 0.5;\n\t\t}\n\n\t\t// For trap rule, turn off current avging for algebraic eqns\n\t\tfor (var i = this.N - 1; i >= 0; --i) {\n\t\t    this.beta0[i] = beta0 + this.ar[i]*beta1;\n\t\t    this.beta1[i] = (1.0 - this.ar[i])*beta1;\n\t\t}\n\n\t\t// Loop to find NR converging timestep with okay LTE\n\t\twhile (true) {\n\t\t    // Set the timestep coefficients (alpha2 is for bdf2).\n\t\t    this.alpha0 = 1.0/(this.time - this.oldt);\n\t\t    this.alpha1 = -this.alpha0;\n\t\t    this.alpha2 = 0;\n\n\t\t    // If timestep is 1/10,000th of tstop, just use BE.\n\t\t    if ((this.time-this.oldt) < 1.0e-4*tstop) {\n\t\t\tfor (var i = this.N - 1; i >= 0; --i) {\n\t\t\t    this.beta0[i] = 1.0;\n\t\t\t    this.beta1[i] = 0.0;\n\t\t\t}\n\t\t    }\n\t\t    // Use Newton to compute the solution.\n\t\t    var iterations = this.find_solution(load_tran,max_tran_iters);\n\n\t\t    // If NR succeeds and stepsize is at min, accept and newstep=maxgrowth*minstep.\n\t\t    // Else if Newton Fails, shrink step by a factor and try again\n\t\t    // Else LTE picks new step, if bigger accept current step and go on.\n\t\t    if ((iterations != undefined) &&\n\t\t\t(step_index <= 0 || (this.time-this.oldt) < (1+reltol)*this.min_step)) {\n\t\t\tif (step_index > 0) new_step = time_step_increase_factor*this.min_step;\n\t\t\tbreak;\n\t\t    } else if (iterations == undefined) {  // NR nonconvergence, shrink by factor\n\t\t\tthis.time = this.oldt +\n\t\t\t    (this.time - this.oldt)/nr_step_decrease_factor;\n\t\t    } else {  // Check the LTE and shrink step if needed.\n\t\t\tnew_step = pick_step(this, step_index);\n\t\t\tif (new_step < (1.0 - reltol)*(this.time - this.oldt)) {\n\t\t\t    this.time = this.oldt + new_step;  // Try again\n\t\t\t}\n\t\t\telse\n\t\t\t    break;  // LTE okay, new_step for next step\n\t\t    }\n\t\t}\n\t    }\n\n\t    // create solution dictionary\n        var result = [];\n\t    for (var name in this.node_map) {\n\t\tvar index = this.node_map[name];\n\t\tresult[name] = (index == -1) ? 0 : response[index];\n\t    }\n\t    // capture branch currents from voltage sources\n\t    for (var i = this.voltage_sources.length - 1; i >= 0; --i) {\n\t\tvar v = this.voltage_sources[i];\n\t\tresult['I('+v.name+')'] = response[v.branch];\n\t    }\n\n\t    result['_time_'] = response[this.N];\n\t    return result;\n\t}\n\n\t// AC analysis: npts/decade for freqs in range [fstart,fstop]\n\t// result['_frequencies_'] = vector of log10(sample freqs)\n\t// result['xxx'] = vector of dB(response for node xxx)\n        // NOTE: Normalization removed in schematic.js, jkw.\n        Circuit.prototype.ac = function(npts,fstart,fstop,source_name) {\n\n\t    if (this.dc() == undefined) { // DC failed, realloc mats and vects.\n\t\treturn undefined;\n\t    }\n\n\t    var N = this.N;\n\t    var G = this.G;\n\t    var C = this.C;\n\n\t    // Complex numbers, we're going to need a bigger boat\n\t    var matrixac = mat_make(2*N, (2*N)+1);\n\n            // Get the source used for ac\n\t    if (this.device_map[source_name] === undefined) {\n\t\talert('AC analysis refers to unknown source ' + source_name);\n\t\treturn 'AC analysis failed, unknown source';\n\t    }\n\t    this.device_map[source_name].load_ac(this,this.rhs);\n\n\t    // build array to hold list of magnitude and phases for each node\n\t    // last entry is for frequency values\n\t    var response = new Array(2*N + 1);\n        for (var i = 2*N; i >= 0; --i) response[i] = [];\n\n\t    // multiplicative frequency increase between freq points\n\t    var delta_f = Math.exp(Math.LN10/npts);\n\n\t    var phase_offset = new Array(N);\n\t    for (var i = N-1; i >= 0; --i) phase_offset[i] = 0;\n\n\t    var f = fstart;\n\t    fstop *= 1.0001;  // capture that last freq point!\n\t    while (f <= fstop) {\n\t\tvar omega = 2 * Math.PI * f;\n\t\tresponse[2*N].push(f);   // 2*N for magnitude and phase\n\n\t\t// Find complex x+jy that sats Gx-omega*Cy=rhs; omega*Cx+Gy=0\n\t\t// Note: solac[0:N-1]=x, solac[N:2N-1]=y\n\t\tfor (var i = N-1; i >= 0; --i) {\n\t\t    // First the rhs, replicated for real and imaginary\n\t\t    matrixac[i][2*N] = this.rhs[i];\n\t\t    matrixac[i+N][2*N] = 0;\n\n\t\t    for (var j = N-1; j >= 0; --j) {\n\t\t\tmatrixac[i][j] = G[i][j];\n\t\t\tmatrixac[i+N][j+N] = G[i][j];\n\t\t\tmatrixac[i][j+N] = -omega*C[i][j];\n\t\t\tmatrixac[i+N][j] = omega*C[i][j];\n\t\t    }\n\t\t}\n\n\t\t// Compute the small signal response\n\t\tvar solac = mat_solve(matrixac);\n\n\t\t// Save magnitude and phase\n\t\tfor (var i = N - 1; i >= 0; --i) {\n\t\t    var mag = Math.sqrt(solac[i]*solac[i] + solac[i+N]*solac[i+N]);\n\t\t    response[i].push(mag);\n\n\t\t    // Avoid wrapping phase, add or sub 180 for each jump\n\t\t    var phase = 180*(Math.atan2(solac[i+N],solac[i])/Math.PI);\n\t\t    var phasei = response[i+N];\n\t\t    var L = phasei.length;\n\t\t    // Look for a one-step jump greater than 90 degrees\n\t\t    if (L > 1) {\n\t\t\tvar phase_jump = phase + phase_offset[i] - phasei[L-1];\n\t\t\tif (phase_jump > 90) {\n\t\t\t    phase_offset[i] -= 360;\n\t\t\t} else if (phase_jump < -90) {\n\t\t\t    phase_offset[i] += 360;\n\t\t\t}\n\t\t    }\n\t\t    response[i+N].push(phase + phase_offset[i]);\n\t\t}\n\t\tf *= delta_f;    // increment frequency\n\t    }\n\n\t    // create solution dictionary\n        var result = [];\n\t    for (var name in this.node_map) {\n\t\tvar index = this.node_map[name];\n\t\tresult[name] = (index == -1) ? 0 : response[index];\n\t\tresult[name+'_phase'] = (index == -1) ? 0 : response[index+N];\n\t    }\n\t    result['_frequencies_'] = response[2*N];\n\t    return result;\n\t}\n\n        // Helper for adding devices to a circuit, warns on duplicate device names.\n        Circuit.prototype.add_device = function(d,name) {\n\t    // Add device to list of devices and to device map\n\t    this.devices.push(d);\n\t    d.name = name;\n\t    if (name) {\n\t\tif (this.device_map[name] === undefined)\n\t\t    this.device_map[name] = d;\n\t\telse {\n\t\t    alert('Warning: two circuit elements share the same name ' + name);\n\t\t    this.device_map[name] = d;\n\t\t}\n\t    }\n\t    return d;\n\t}\n\n\tCircuit.prototype.r = function(n1,n2,v,name) {\n\t    // try to convert string value into numeric value, barf if we can't\n\t    if ((typeof v) == 'string') {\n\t\tv = parse_number(v,undefined);\n\t\tif (v === undefined) return undefined;\n\t    }\n\n\t    if (v != 0) {\n\t\tvar d = new Resistor(n1,n2,v);\n\t\treturn this.add_device(d, name);\n\t    } else return this.v(n1,n2,'0',name);   // zero resistance == 0V voltage source\n\t}\n\n\tCircuit.prototype.d = function(n1,n2,area,type,name) {\n\t    // try to convert string value into numeric value, barf if we can't\n\t    if ((typeof area) == 'string') {\n\t\tarea = parse_number(area,undefined);\n\t\tif (area === undefined) return undefined;\n\t    }\n\n\t    if (area != 0) {\n\t\tvar d = new Diode(n1,n2,area,type);\n\t\treturn this.add_device(d, name);\n\t    } // zero area diodes discarded.\n\t}\n\n\tCircuit.prototype.c = function(n1,n2,v,name) {\n\t    // try to convert string value into numeric value, barf if we can't\n\t    if ((typeof v) == 'string') {\n\t\tv = parse_number(v,undefined);\n\t\tif (v === undefined) return undefined;\n\t    }\n\t    var d = new Capacitor(n1,n2,v);\n\t    return this.add_device(d, name);\n\t}\n\n\tCircuit.prototype.l = function(n1,n2,v,name) {\n\t    // try to convert string value into numeric value, barf if we can't\n\t    if ((typeof v) == 'string') {\n\t\tv = parse_number(v,undefined);\n\t\tif (v === undefined) return undefined;\n\t    }\n\t    var branch = this.node(undefined,T_CURRENT);\n\t    var d = new Inductor(n1,n2,branch,v);\n\t    return this.add_device(d, name);\n\t}\n\n        Circuit.prototype.v = function(n1,n2,v,name) {\n\t    var branch = this.node(undefined,T_CURRENT);\n\t    var d = new VSource(n1,n2,branch,v);\n\t    this.voltage_sources.push(d);\n\t    return this.add_device(d, name);\n\t}\n\n\tCircuit.prototype.i = function(n1,n2,v,name) {\n\t    var d = new ISource(n1,n2,v);\n\t    this.current_sources.push(d);\n\t    return this.add_device(d, name);\n\t}\n\n        Circuit.prototype.opamp = function(np,nn,no,ng,A,name) {\n            var ratio;\n\t    // try to convert string value into numeric value, barf if we can't\n\t    if ((typeof A) == 'string') {\n\t\tratio = parse_number(A,undefined);\n\t\tif (A === undefined) return undefined;\n\t    }\n\t    var branch = this.node(undefined,T_CURRENT);\n\t    var d = new Opamp(np,nn,no,ng,branch,A,name);\n\t    return this.add_device(d, name);\n\t}\n\n        Circuit.prototype.n = function(d,g,s, ratio, name) {\n\t    // try to convert string value into numeric value, barf if we can't\n\t    if ((typeof ratio) == 'string') {\n\t\tratio = parse_number(ratio,undefined);\n\t\tif (ratio === undefined) return undefined;\n\t    }\n\t    var d = new Fet(d,g,s,ratio,name,'n');\n\t    return this.add_device(d, name);\n\t}\n\n        Circuit.prototype.p = function(d,g,s, ratio, name) {\n\t    // try to convert string value into numeric value, barf if we can't\n\t    if ((typeof ratio) == 'string') {\n\t\tratio = parse_number(ratio,undefined);\n\t\tif (ratio === undefined) return undefined;\n\t    }\n\t    var d = new Fet(d,g,s,ratio,name,'p');\n\t    return this.add_device(d, name);\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Support for creating conductance and capacitance matrices associated with\n        //  modified nodal analysis (unknowns are node voltages and inductor and voltage\n        //  source currents).\n        //  The linearized circuit is written as\n        //          C d/dt x = G x + rhs\n        //  x - vector of node voltages and element currents\n        //  rhs - vector of source values\n        //  C - Matrix whose values are capacitances and inductances, has many zero rows.\n        //  G - Matrix whose values are conductances and +-1's.\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\t// add val component between two nodes to matrix M\n\t// Index of -1 refers to ground node\n        Circuit.prototype.add_two_terminal = function(i,j,g,M) {\n\t    if (i >= 0) {\n\t\tM[i][i] += g;\n\t\tif (j >= 0) {\n\t\t    M[i][j] -= g;\n\t\t    M[j][i] -= g;\n\t\t    M[j][j] += g;\n\t\t}\n\t    } else if (j >= 0)\n\t\tM[j][j] += g;\n\t}\n\n\t// add val component between two nodes to matrix M\n\t// Index of -1 refers to ground node\n        Circuit.prototype.get_two_terminal = function(i,j,x) {\n\t    var xi_minus_xj = 0;\n\t    if (i >= 0) xi_minus_xj = x[i];\n\t    if (j >= 0) xi_minus_xj -= x[j];\n\t    return xi_minus_xj\n\t}\n\n        Circuit.prototype.add_conductance_l = function(i,j,g) {\n            this.add_two_terminal(i,j,g, this.Gl)\n\t}\n\n        Circuit.prototype.add_conductance = function(i,j,g) {\n            this.add_two_terminal(i,j,g, this.G)\n\t}\n\n        Circuit.prototype.add_capacitance = function(i,j,c) {\n            this.add_two_terminal(i,j,c,this.C)\n\t}\n\n\t// add individual conductance to Gl matrix\n\tCircuit.prototype.add_to_Gl = function(i,j,g) {\n\t    if (i >=0 && j >= 0)\n\t\tthis.Gl[i][j] += g;\n\t}\n\n\t// add individual conductance to Gl matrix\n\tCircuit.prototype.add_to_G = function(i,j,g) {\n\t    if (i >=0 && j >= 0)\n\t\tthis.G[i][j] += g;\n\t}\n\n\t// add individual capacitance to C matrix\n\tCircuit.prototype.add_to_C = function(i,j,c) {\n\t    if (i >=0 && j >= 0)\n\t\tthis.C[i][j] += c;\n\t}\n\n\t// add source info to rhs\n        Circuit.prototype.add_to_rhs = function(i,v,rhs) {\n\t    if (i >= 0)\trhs[i] += v;\n\t}\n\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Generic matrix support - making, copying, factoring, rank, etc\n\t//  Note, Matrices are stored using nested javascript arrays.\n\t////////////////////////////////////////////////////////////////////////////////\n\n        // Allocate an NxM matrix\n        function mat_make(N,M) {\n\t    var mat = new Array(N);\n\t    for (var i = N - 1; i >= 0; --i) {\n\t\tmat[i] = new Array(M);\n\t\tfor (var j = M - 1; j >= 0; --j) {\n\t\t    mat[i][j] = 0.0;\n\t\t}\n\t    }\n\t    return mat;\n\t}\n\n        // Form b = scale*Mx\n        function mat_v_mult(M,x,b,scale) {\n\t    var n = M.length;\n\t    var m = M[0].length;\n\n\t    if (n != b.length || m != x.length)\n\t\tthrow 'Rows of M mismatched to b or cols mismatch to x.';\n\n\t    for (var i = 0; i < n; i++) {\n\t\tvar temp = 0;\n\t\tfor (var j = 0; j < m; j++) temp += M[i][j]*x[j];\n\t\tb[i] = scale*temp;  // Recall the neg in the name\n\t    }\n\t}\n\n        // C = scalea*A + scaleb*B, scalea, scaleb eithers numbers or arrays (row scaling)\n        function mat_scale_add(A, B, scalea, scaleb, C) {\n\t    var n = A.length;\n\t    var m = A[0].length;\n\n\t    if (n > B.length || m > B[0].length)\n\t\tthrow 'Row or columns of A to large for B';\n\t    if (n > C.length || m > C[0].length)\n\t\tthrow 'Row or columns of A to large for C';\n\t    if ((typeof scalea == 'number') && (typeof scaleb == 'number'))\n\t\tfor (var i = 0; i < n; i++)\n\t\t    for (var j = 0; j < m; j++)\n\t\t\tC[i][j] = scalea*A[i][j] + scaleb*B[i][j];\n\t    else if ((typeof scaleb == 'number') && (scalea instanceof Array))\n\t\tfor (var i = 0; i < n; i++)\n\t\t    for (var j = 0; j < m; j++)\n\t\t\tC[i][j] = scalea[i]*A[i][j] + scaleb*B[i][j];\n\t    else if ((typeof scaleb instanceof Array) && (scalea instanceof Array))\n\t\tfor (var i = 0; i < n; i++)\n\t\t    for (var j = 0; j < m; j++)\n\t\t\tC[i][j] = scalea[i]*A[i][j] + scaleb[i]*B[i][j];\n\t    else\n\t\tthrow 'scalea and scaleb must be scalars or Arrays';\n\t}\n\n        // Returns a vector of ones and zeros, ones denote algebraic\n        // variables (rows that can be removed without changing rank(M).\n        Circuit.prototype.algebraic = function(M) {\n\t    var Nr = M.length\n\t    var Mc = mat_make(Nr, Nr);\n\t    mat_copy(M,Mc);\n\t    var R = mat_rank(Mc);\n\n\t    var one_if_alg = new Array(Nr);\n\t    for (var row = 0; row < Nr; row++) {  // psuedo gnd row small\n\t\tfor (var col = Nr - 1; col >= 0; --col)\n\t\t    Mc[row][col] = 0;\n\t\tif (mat_rank(Mc) == R)  // Zeroing row left rank unchanged\n\t\t    one_if_alg[row] = 1;\n\t\telse { // Zeroing row changed rank, put back\n\t\t    for (var col = Nr - 1; col >= 0; --col)\n\t\t\tMc[row][col] = M[row][col];\n\t\t    one_if_alg[row] = 0;\n\t\t}\n\t    }\n\t    return one_if_alg;\n\t}\n\n        // Copy A -> using the bounds of A\n\tfunction mat_copy(src,dest) {\n\t    var n = src.length;\n\t    var m = src[0].length;\n\t    if (n > dest.length || m >  dest[0].length)\n\t\tthrow 'Rows or cols > rows or cols of dest';\n\n\t    for (var i = 0; i < n; i++)\n\t\tfor (var j = 0; j < m; j++)\n\t\t    dest[i][j] = src[i][j];\n\t}\n        // Copy and transpose A -> using the bounds of A\n\tfunction mat_copy_transposed(src,dest) {\n\t    var n = src.length;\n\t    var m = src[0].length;\n\t    if (n > dest[0].length || m >  dest.length)\n\t\tthrow 'Rows or cols > cols or rows of dest';\n\n\t    for (var i = 0; i < n; i++)\n\t\tfor (var j = 0; j < m; j++)\n\t\t    dest[j][i] = src[i][j];\n\t}\n\n\n\t// Uses GE to determine rank.\n        function mat_rank(Mo) {\n\t    var Nr = Mo.length;  // Number of rows\n\t    var Nc = Mo[0].length;  // Number of columns\n\t    var temp,i,j;\n\t    // Make a copy to avoid overwriting\n        var M = mat_make(Nr, Nc);\n\t    mat_copy(Mo,M);\n\n\t    // Find matrix maximum entry\n\t    var max_abs_entry = 0;\n\t    for(var row = Nr-1; row >= 0; --row) {\n\t\tfor(var col = Nr-1; col >= 0; --col) {\n\t\t    if (Math.abs(M[row][col]) > max_abs_entry)\n\t\t\tmax_abs_entry = Math.abs(M[row][col]);\n\t\t}\n\t    }\n\n\t    // Gaussian elimination to find rank\n\t    var the_rank = 0;\n\t    var start_col = 0;\n\t    for (var row = 0; row < Nr; row++) {\n\t\t// Search for first nonzero column in the remaining rows.\n\t\tfor (var col = start_col; col < Nc; col++) {\n\t\t    var max_v = Math.abs(M[row][col]);\n\t\t    var max_row = row;\n\t\t    for (var i = row + 1; i < Nr; i++) {\n\t\t\ttemp = Math.abs(M[i][col]);\n\t\t\tif (temp > max_v) { max_v = temp; max_row = i; }\n\t\t    }\n\t\t    // if max_v non_zero, column is nonzero, eliminate in subsequent rows\n\t\t    if (Math.abs(max_v) > eps*max_abs_entry) {\n\t\t\tstart_col = col+1;\n\t\t\tthe_rank += 1;\n\t\t        // Swap rows to get max in M[row][col]\n\t\t\ttemp = M[row];\n\t\t\tM[row] = M[max_row];\n\t\t\tM[max_row] = temp;\n\n\t\t\t// now eliminate this column for all subsequent rows\n\t\t\tfor (var i = row + 1; i < Nr; i++) {\n\t\t\t    temp = M[i][col]/M[row][col];   // multiplier for current row\n\t\t\t    if (temp != 0)  // subtract\n\t\t\t    for (var j = col; j < Nc; j++) M[i][j] -= M[row][j]*temp;\n\t\t\t}\n\t\t\t// Now move on to the next row\n\t\t\tbreak;\n\t\t    }\n\t\t}\n\t    }\n\n\t    return the_rank;\n\t}\n\n\t// Solve Mx=b and return vector x using R^TQ^T factorization.\n        // Multiplication by R^T implicit, should be null-space free soln.\n        // M should have the extra column!\n        // Almost everything is in-lined for speed, sigh.\n        function mat_solve_rq(M, rhs) {\n            var scale;\n\t    var Nr = M.length;  // Number of rows\n\t    var Nc = M[0].length;  // Number of columns\n\n\t    // Copy the rhs in to the last column of M if one is given.\n\t    if (rhs != null) {\n\t\tfor (var row = Nr - 1; row >= 0; --row)\n\t\t    M[row][Nc-1] = rhs[row];\n\t    }\n\n\t    var mat_scale = 0; // Sets the scale for comparison to zero.\n\t    var max_nonzero_row = Nr-1;  // Assumes M nonsingular.\n\t    for (var row = 0; row < Nr; row++) {\n\t\t// Find largest row with largest 2-norm\n\t\tvar max_row = row;\n\t\tvar maxsumsq = 0;\n\t\tfor (var rowp = row; rowp < Nr; rowp++) {\n\t\t    var Mr = M[rowp];\n\t\t    var sumsq = 0;\n\t\t    for (var col = Nc-2; col >= 0; --col)  // Last col=rhs\n\t\t\tsumsq += Mr[col]*Mr[col];\n\t\t    if ((row == rowp) || (sumsq > maxsumsq)) {\n\t\t\tmax_row = rowp;\n\t\t\tmaxsumsq = sumsq;\n\t\t    }\n\t\t}\n\t\tif (max_row > row) { // Swap rows if not max row\n\t\t    var temp = M[row];\n\t\t    M[row] = M[max_row];\n\t\t    M[max_row] = temp;\n\t\t}\n\n\t\t// Calculate row norm, save if this is first (largest)\n        var row_norm = Math.sqrt(maxsumsq);\n\t\tif (row == 0) mat_scale = row_norm;\n\n\t\t// Check for all zero rows\n\t\tif (row_norm > mat_scale*eps)\n\t\t    scale = 1.0/row_norm;\n\t\telse {\n\t\t    max_nonzero_row = row - 1;  // Rest will be nullspace of M\n\t\t    break;\n\t\t}\n\n\t\t// Nonzero row, eliminate from rows below\n\t\tvar Mr = M[row];\n\t\tfor (var col =  Nc-1; col >= 0; --col) // Scale rhs also\n\t\t    Mr[col] *= scale;\n\t\tfor (var rowp = row + 1; rowp < Nr; rowp++) { // Update.\n\t\t    var Mrp = M[rowp];\n\t\t    var inner = 0;\n\t\t    for (var col =  Nc-2; col >= 0; --col)  // Project\n\t\t\tinner += Mr[col]*Mrp[col];\n\t\t    for (var col =  Nc-1; col >= 0; --col) // Ortho (rhs also)\n\t\t\tMrp[col] -= inner *Mr[col];\n\t\t}\n\t    }\n\n\t    // Last Column of M has inv(R^T)*rhs.  Scale rows of Q to get x.\n\t    var x = new Array(Nc-1);\n\t    for (var col = Nc-2; col >= 0; --col)\n\t\tx[col] = 0;\n\t    for (var row = max_nonzero_row; row >= 0; --row) {\n\t\tMr = M[row];\n\t\tfor (var col = Nc-2; col >= 0; --col) {\n\t\t    x[col] += Mr[col]*Mr[Nc-1];\n\t\t}\n\t    }\n\n\t    return x;\n\t}\n\n\t// solve Mx=b and return vector x given augmented matrix M = [A | b]\n\t// Uses Gaussian elimination with partial pivoting\n        function mat_solve(M,rhs) {\n\t    var N = M.length;      // augmented matrix M has N rows, N+1 columns\n\t    var temp,i,j;\n\n\t    // Copy the rhs in to the last column of M if one is given.\n\t    if (rhs != null) {\n\t\tfor (var row = 0; row < N ; row++)\n\t\t    M[row][N] = rhs[row];\n\t    }\n\n\t    // gaussian elimination\n\t    for (var col = 0; col < N ; col++) {\n\t\t// find pivot: largest abs(v) in this column of remaining rows\n\t\tvar max_v = Math.abs(M[col][col]);\n\t\tvar max_col = col;\n\t\tfor (i = col + 1; i < N; i++) {\n\t\t    temp = Math.abs(M[i][col]);\n\t\t    if (temp > max_v) { max_v = temp; max_col = i; }\n\t\t}\n\n\t\t// if no value found, generate a small conductance to gnd\n\t\t// otherwise swap current row with pivot row\n\t\tif (max_v == 0) M[col][col] = eps;\n\t\telse {\n\t\t    temp = M[col];\n\t\t    M[col] = M[max_col];\n\t\t    M[max_col] = temp;\n\t\t}\n\n\t\t// now eliminate this column for all subsequent rows\n\t\tfor (i = col + 1; i < N; i++) {\n\t\t    temp = M[i][col]/M[col][col];   // multiplier we'll use for current row\n\t\t    if (temp != 0)\n\t\t\t// subtract current row from row we're working on\n\t\t\t// remember to process b too!\n\t\t\tfor (j = col; j <= N; j++) M[i][j] -= M[col][j]*temp;\n\t\t}\n\t    }\n\n\t    // matrix is now upper triangular, so solve for elements of x starting\n\t    // with the last row\n\t    var x = new Array(N);\n\t    for (i = N-1; i >= 0; --i) {\n\t\ttemp = M[i][N];   // grab b[i] from augmented matrix as RHS\n\t\t// subtract LHS term from RHS using known x values\n\t\tfor (j = N-1; j > i; --j) temp -= M[i][j]*x[j];\n\t\t// now compute new x value\n\t\tx[i] = temp/M[i][i];\n\t    }\n\n\t    return x;\n\t}\n\n\t// test solution code, expect x = [2,3,-1]\n\t//M = [[2,1,-1,8],[-3,-1,2,-11],[-2,1,2,-3]];\n\t//x = mat_solve(M);\n\t//y = 1;  // so we have place to set a breakpoint :)\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Device base class\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Device() {\n\t}\n\n\t// complete initial set up of device\n\tDevice.prototype.finalize = function() {\n\t}\n\n        // Load the linear elements in to Gl and C\n        Device.prototype.load_linear = function(ckt) {\n\t}\n\n\t// load linear system equations for dc analysis\n\t// (inductors shorted and capacitors opened)\n        Device.prototype.load_dc = function(ckt,soln,rhs) {\n\t}\n\n\t// load linear system equations for tran analysis\n\tDevice.prototype.load_tran = function(ckt,soln) {\n\t}\n\n\t// load linear system equations for ac analysis:\n\t// current sources open, voltage sources shorted\n\t// linear models at operating point for everyone else\n\tDevice.prototype.load_ac = function(ckt,rhs) {\n\t}\n\n\t// return time of next breakpoint for the device\n\tDevice.prototype.breakpoint = function(time) {\n\t    return undefined;\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Parse numbers in engineering notation\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\t// convert first character of argument into an integer\n\tfunction ord(ch) {\n\t    return ch.charCodeAt(0);\n\t}\n\n\t// convert string argument to a number, accepting usual notations\n\t// (hex, octal, binary, decimal, floating point) plus engineering\n\t// scale factors (eg, 1k = 1000.0 = 1e3).\n\t// return default if argument couldn't be interpreted as a number\n\tfunction parse_number(s,default_v) {\n\t    var slen = s.length;\n\t    var multiplier = 1;\n\t    var result = 0;\n\t    var index = 0;\n\n\t    // skip leading whitespace\n\t    while (index < slen && s.charAt(index) <= ' ') index += 1;\n\t    if (index == slen) return default_v;\n\n\t    // check for leading sign\n\t    if (s.charAt(index) == '-') {\n\t\tmultiplier = -1;\n\t\tindex += 1;\n\t    } else if (s.charAt(index) == '+')\n\t\tindex += 1;\n\t    var start = index;   // remember where digits start\n\n\t    // if leading digit is 0, check for hex, octal or binary notation\n\t    if (index >= slen) return default_v;\n\t    else if (s.charAt(index) == '0') {\n\t\tindex += 1;\n\t\tif (index >= slen) return 0;\n\t\tif (s.charAt(index) == 'x' || s.charAt(index) == 'X') { // hex\n\t\t    while (true) {\n\t\t\tindex += 1;\n\t\t\tif (index >= slen) break;\n\t\t\tif (s.charAt(index) >= '0' && s.charAt(index) <= '9')\n\t\t\t    result = result*16 + ord(s.charAt(index)) - ord('0');\n\t\t\telse if (s.charAt(index) >= 'A' && s.charAt(index) <= 'F')\n\t\t\t    result = result*16 + ord(s.charAt(index)) - ord('A') + 10;\n\t\t\telse if (s.charAt(index) >= 'a' && s.charAt(index) <= 'f')\n\t\t\t    result = result*16 + ord(s.charAt(index)) - ord('a') + 10;\n\t\t\telse break;\n\t\t    }\n\t\t    return result*multiplier;\n\t\t} else if (s.charAt(index) == 'b' || s.charAt(index) == 'B') {  // binary\n\t\t    while (true) {\n\t\t\tindex += 1;\n\t\t\tif (index >= slen) break;\n\t\t\tif (s.charAt(index) >= '0' && s.charAt(index) <= '1')\n\t\t\t    result = result*2 + ord(s.charAt(index)) - ord('0');\n\t\t\telse break;\n\t\t    }\n\t\t    return result*multiplier;\n\t\t} else if (s.charAt(index) != '.') { // octal\n\t\t    while (true) {\n\t\t\tif (s.charAt(index) >= '0' && s.charAt(index) <= '7')\n\t\t\t    result = result*8 + ord(s.charAt(index)) - ord('0');\n\t\t\telse break;\n\t\t\tindex += 1;\n\t\t\tif (index >= slen) break;\n\t\t    }\n\t\t    return result*multiplier;\n\t\t}\n\t    }\n\t    // read decimal integer or floating-point number\n\t    while (true) {\n\t\tif (s.charAt(index) >= '0' && s.charAt(index) <= '9')\n\t\t    result = result*10 + ord(s.charAt(index)) - ord('0');\n\t\telse break;\n\t\tindex += 1;\n\t\tif (index >= slen) break;\n\t    }\n\n\t    // fractional part?\n\t    if (index < slen && s.charAt(index) == '.') {\n\t\twhile (true) {\n\t\t    index += 1;\n\t\t    if (index >= slen) break;\n\t\t    if (s.charAt(index) >= '0' && s.charAt(index) <= '9') {\n\t\t\tresult = result*10 + ord(s.charAt(index)) - ord('0');\n\t\t\tmultiplier *= 0.1;\n\t\t    } else break;\n\t\t}\n\t    }\n\n\t    // if we haven't seen any digits yet, don't check\n\t    // for exponents or scale factors\n\t    if (index == start) return default_v;\n\n\t    // type of multiplier determines type of result:\n\t    // multiplier is a float if we've seen digits past\n\t    // a decimal point, otherwise it's an int or long.\n\t    // Up to this point result is an int or long.\n\t    result *= multiplier;\n\n\t    // now check for exponent or engineering scale factor.  If there\n\t    // is one, result will be a float.\n\t    if (index < slen) {\n\t\tvar scale = s.charAt(index);\n\t\tindex += 1;\n\t\tif (scale == 'e' || scale == 'E') {\n\t\t    var exponent = 0;\n\t\t    multiplier = 10.0;\n\t\t    if (index < slen) {\n\t\t\tif (s.charAt(index) == '+') index += 1;\n\t\t\telse if (s.charAt(index) == '-') {\n\t\t\t    index += 1;\n\t\t\t    multiplier = 0.1;\n\t\t\t}\n\t\t    }\n\t\t    while (index < slen) {\n\t\t\tif (s.charAt(index) >= '0' && s.charAt(index) <= '9') {\n\t\t\t    exponent = exponent*10 + ord(s.charAt(index)) - ord('0');\n\t\t\t    index += 1;\n\t\t\t} else break;\n\t\t    }\n\t\t    while (exponent > 0) {\n\t\t\texponent -= 1;\n\t\t\tresult *= multiplier;\n\t\t    }\n\t\t} else if (scale == 't' || scale == 'T') result *= 1e12;\n\t\telse if (scale == 'g' || scale == 'G') result *= 1e9;\n\t\telse if (scale == 'M') result *= 1e6;\n\t\telse if (scale == 'k' || scale == 'K') result *= 1e3;\n\t\telse if (scale == 'm') result *= 1e-3;\n\t\telse if (scale == 'u' || scale == 'U') result *= 1e-6;\n\t\telse if (scale == 'n' || scale == 'N') result *= 1e-9;\n\t\telse if (scale == 'p' || scale == 'P') result *= 1e-12;\n\t\telse if (scale == 'f' || scale == 'F') result *= 1e-15;\n\t    }\n\t    // ignore any remaining chars, eg, 1kohms returns 1000\n\t    return result;\n\t}\n\n\tCircuit.prototype.parse_number = parse_number;  // make it easy to call from outside\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Sources\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\t// argument is a string describing the source's value (see comments for details)\n\t// source types: dc,step,square,triangle,sin,pulse,pwl,pwl_repeating\n\n\t// returns an object with the following attributes:\n\t//   fun -- name of source function\n\t//   args -- list of argument values\n\t//   value(t) -- compute source value at time t\n\t//   inflection_point(t) -- compute time after t when a time point is needed\n\t//   dc -- value at time 0\n\t//   period -- repeat period for periodic sources (0 if not periodic)\n\n\tfunction parse_source(v) {\n\t    // generic parser: parse v as either <value> or <fun>(<value>,...)\n        var src = {};\n\t    src.period = 0; // Default not periodic\n\t    src.value = function(t) { return 0; }  // overridden below\n\t    src.inflection_point = function(t) { return undefined; };  // may be overridden below\n\n\t    // see if there's a \"(\" in the description\n\t    var index = v.indexOf('(');\n\t    var ch;\n\t    if (index >= 0) {\n\t\tsrc.fun = v.slice(0,index);   // function name is before the \"(\"\n\t\tsrc.args = [];\t// we'll push argument values onto this list\n\t\tvar end = v.indexOf(')',index);\n\t\tif (end == -1) end = v.length;\n\n\t\tindex += 1;     // start parsing right after \"(\"\n\t\twhile (index < end) {\n\t\t    // figure out where next argument value starts\n\t\t    ch = v.charAt(index);\n\t\t    if (ch <= ' ') { index++; continue; }\n\t\t    // and where it ends\n\t\t    var arg_end = v.indexOf(',',index);\n\t\t    if (arg_end == -1) arg_end = end;\n\t\t    // parse and save result in our list of arg values\n\t\t    src.args.push(parse_number(v.slice(index,arg_end),undefined));\n\t\t    index = arg_end + 1;\n\t\t}\n\t    } else {\n\t\tsrc.fun = 'dc';\n\t\tsrc.args = [parse_number(v,0)];\n\t    }\n\n\t    // post-processing for constant sources\n\t    // dc(v)\n\t    if (src.fun == 'dc') {\n\t\tvar v = arg_value(src.args,0,0);\n\t\tsrc.args = [v];\n\t\tsrc.value = function(t) { return v; }  // closure\n\t    }\n\n\t    // post-processing for impulse sources\n\t    // impulse(height,width)\n\t    else if (src.fun == 'impulse') {\n\t\tvar h = arg_value(src.args,0,1);  // default height: 1\n\t\tvar w = Math.abs(arg_value(src.args,2,1e-9));  // default width: 1ns\n\t\tsrc.args = [h,w];  // remember any defaulted values\n\t\tpwl_source(src,[0,0,w/2,h,w,0],false);\n\t    }\n\n\t    // post-processing for step sources\n\t    // step(v_init,v_plateau,t_delay,t_rise)\n\t    else if (src.fun == 'step') {\n\t\tvar v1 = arg_value(src.args,0,0);  // default init value: 0V\n\t\tvar v2 = arg_value(src.args,1,1);  // default plateau value: 1V\n\t\tvar td = Math.max(0,arg_value(src.args,2,0));  // time step starts\n\t\tvar tr = Math.abs(arg_value(src.args,3,1e-9));  // default rise time: 1ns\n\t\tsrc.args = [v1,v2,td,tr];  // remember any defaulted values\n\t\tpwl_source(src,[td,v1,td+tr,v2],false);\n\t    }\n\n\t    // post-processing for square wave\n\t    // square(v_init,v_plateau,freq,duty_cycle)\n\t    else if (src.fun == 'square') {\n\t\tvar v1 = arg_value(src.args,0,0);  // default init value: 0V\n\t\tvar v2 = arg_value(src.args,1,1);  // default plateau value: 1V\n\t\tvar freq = Math.abs(arg_value(src.args,2,1));  // default frequency: 1Hz\n\t\tvar duty_cycle  = Math.min(100,Math.abs(arg_value(src.args,3,50)));  // default duty cycle: 0.5\n\t\tsrc.args = [v1,v2,freq,duty_cycle];  // remember any defaulted values\n\n\t\tvar per = freq == 0 ? Infinity : 1/freq;\n\t\tvar t_change = 0.01 * per;   // rise and fall time\n\t\tvar t_pw = .01 * duty_cycle * 0.98 * per;  // fraction of cycle minus rise and fall time\n\t\tpwl_source(src,[0,v1,t_change,v2,t_change+t_pw,\n\t\t\t\tv2,t_change+t_pw+t_change,v1,per,v1],true);\n\t    }\n\n\t    // post-processing for triangle\n\t    // triangle(v_init,v_plateua,t_period)\n\t    else if (src.fun == 'triangle') {\n\t\tvar v1 = arg_value(src.args,0,0);  // default init value: 0V\n\t\tvar v2 = arg_value(src.args,1,1);  // default plateau value: 1V\n\t\tvar freq = Math.abs(arg_value(src.args,2,1));  // default frequency: 1s\n\t\tsrc.args = [v1,v2,freq];  // remember any defaulted values\n\n\t\tvar per = freq == 0 ? Infinity : 1/freq;\n\t\tpwl_source(src,[0,v1,per/2,v2,per,v1],true);\n\t    }\n\n\t    // post-processing for pwl and pwlr sources\n\t    // pwl[r](t1,v1,t2,v2,...)\n\t    else if (src.fun == 'pwl' || src.fun == 'pwl_repeating') {\n\t\tpwl_source(src,src.args,src.fun == 'pwl_repeating');\n\t    }\n\n\t    // post-processing for pulsed sources\n\t    // pulse(v_init,v_plateau,t_delay,t_rise,t_fall,t_width,t_period)\n\t    else if (src.fun == 'pulse') {\n\t\tvar v1 = arg_value(src.args,0,0);  // default init value: 0V\n\t\tvar v2 = arg_value(src.args,1,1);  // default plateau value: 1V\n\t\tvar td = Math.max(0,arg_value(src.args,2,0));  // time pulse starts\n\t\tvar tr = Math.abs(arg_value(src.args,3,1e-9));  // default rise time: 1ns\n\t\tvar tf = Math.abs(arg_value(src.args,4,1e-9));  // default rise time: 1ns\n\t\tvar pw = Math.abs(arg_value(src.args,5,1e9));  // default pulse width: \"infinite\"\n\t\tvar per = Math.abs(arg_value(src.args,6,1e9));  // default period: \"infinite\"\n\t\tsrc.args = [v1,v2,td,tr,tf,pw,per];\n\n\t\tvar t1 = td;       // time when v1 -> v2 transition starts\n\t\tvar t2 = t1 + tr;  // time when v1 -> v2 transition ends\n\t\tvar t3 = t2 + pw;  // time when v2 -> v1 transition starts\n\t\tvar t4 = t3 + tf;  // time when v2 -> v1 transition ends\n\n\t\tpwl_source(src,[t1,v1, t2,v2, t3,v2, t4,v1, per,v1],true);\n\t    }\n\n\t    // post-processing for sinusoidal sources\n\t    // sin(v_offset,v_amplitude,freq_hz,t_delay,phase_offset_degrees)\n\t    else if (src.fun == 'sin') {\n\t\tvar voffset = arg_value(src.args,0,0);  // default offset voltage: 0V\n\t\tvar va = arg_value(src.args,1,1);  // default amplitude: -1V to 1V\n\t\tvar freq = Math.abs(arg_value(src.args,2,1));  // default frequency: 1Hz\n\t\tsrc.period = 1.0/freq;\n\n\t\tvar td = Math.max(0,arg_value(src.args,3,0));  // default time delay: 0sec\n\t\tvar phase = arg_value(src.args,4,0);  // default phase offset: 0 degrees\n\t\tsrc.args = [voffset,va,freq,td,phase];\n\n\t\tphase /= 360.0;\n\n\t\t// return value of source at time t\n\t\tsrc.value = function(t) {  // closure\n\t\t    if (t < td) return voffset + va*Math.sin(2*Math.PI*phase);\n\t\t    else return voffset + va*Math.sin(2*Math.PI*(freq*(t - td) + phase));\n\t\t}\n\n\t\t// return time of next inflection point after time t\n\t\tsrc.inflection_point = function(t) {\t// closure\n\t\t    if (t < td) return td;\n\t\t    else return undefined;\n\t\t}\n\t    }\n\n\t    // object has all the necessary info to compute the source value and inflection points\n\t    src.dc = src.value(0);   // DC value is value at time 0\n\t    return src;\n\t}\n\n\tfunction pwl_source(src,tv_pairs,repeat) {\n\t    var nvals = tv_pairs.length;\n\t    if (repeat)\n\t\tsrc.period = tv_pairs[nvals-2];  // Repeat period of source\n\t    if (nvals % 2 == 1) npts -= 1;  // make sure it's even!\n\n\t    if (nvals <= 2) {\n\t\t// handle degenerate case\n\t\tsrc.value = function(t) { return nvals == 2 ? tv_pairs[1] : 0; }\n\t\tsrc.inflection_point = function(t) { return undefined; }\n\t    } else {\n\t\tsrc.value = function(t) { // closure\n\t\t    if (repeat)\n\t\t\t// make time periodic if values are to be repeated\n\t\t\tt = Math.fmod(t,tv_pairs[nvals-2]);\n\t\t    var last_t = tv_pairs[0];\n\t\t    var last_v = tv_pairs[1];\n\t\t    if (t > last_t) {\n\t\t\tvar next_t,next_v;\n\t\t\tfor (var i = 2; i < nvals; i += 2) {\n\t\t\t    next_t = tv_pairs[i];\n\t\t\t    next_v = tv_pairs[i+1];\n\t\t\t    if (next_t > last_t)  // defend against bogus tv pairs\n\t\t\t\tif (t < next_t)\n\t\t\t\t    return last_v + (next_v - last_v)*(t - last_t)/(next_t - last_t);\n\t\t\t    last_t = next_t;\n\t\t\t    last_v = next_v;\n\t\t\t}\n\t\t    }\n\t\t    return last_v;\n\t\t}\n\t\tsrc.inflection_point = function(t) {  // closure\n\t\t    if (repeat)\n\t\t\t// make time periodic if values are to be repeated\n\t\t\tt = Math.fmod(t,tv_pairs[nvals-2]);\n\t\t    for (var i = 0; i < nvals; i += 2) {\n\t\t\tvar next_t = tv_pairs[i];\n\t\t\tif (t < next_t) return next_t;\n\t\t    }\n\t\t    return undefined;\n\t\t}\n\t    }\n\t}\n\n\t// helper function: return args[index] if present, else default_v\n\tfunction arg_value(args,index,default_v) {\n\t    if (index < args.length) {\n\t\tvar result = args[index];\n\t\tif (result === undefined) result = default_v;\n\t\treturn result;\n\t    } else return default_v;\n\t}\n\n\t// we need fmod in the Math library!\n\tMath.fmod = function(numerator,denominator) {\n\t    var quotient = Math.floor(numerator/denominator);\n\t    return numerator - quotient*denominator;\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Sources\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n        function VSource(npos,nneg,branch,v) {\n\t    Device.call(this);\n\t    this.src = parse_source(v);\n\t    this.npos = npos;\n\t    this.nneg = nneg;\n\t    this.branch = branch;\n\t}\n\tVSource.prototype = new Device();\n\tVSource.prototype.constructor = VSource;\n\n\t// load linear part for source evaluation\n        VSource.prototype.load_linear = function(ckt) {\n\t    // MNA stamp for independent voltage source\n\t    ckt.add_to_Gl(this.branch,this.npos,1.0);\n\t    ckt.add_to_Gl(this.branch,this.nneg,-1.0);\n\t    ckt.add_to_Gl(this.npos,this.branch,1.0);\n\t    ckt.add_to_Gl(this.nneg,this.branch,-1.0);\n\t}\n\n\t// Source voltage added to b.\n        VSource.prototype.load_dc = function(ckt,soln,rhs) {\n\t    ckt.add_to_rhs(this.branch,this.src.dc,rhs);\n\t}\n\n\t// Load time-dependent value for voltage source for tran\n        VSource.prototype.load_tran = function(ckt,soln,rhs,time) {\n\t    ckt.add_to_rhs(this.branch,this.src.value(time),rhs);\n\t}\n\n\t// return time of next breakpoint for the device\n\tVSource.prototype.breakpoint = function(time) {\n\t    return this.src.inflection_point(time);\n\t}\n\n\t// small signal model ac value\n        VSource.prototype.load_ac = function(ckt,rhs) {\n\t    ckt.add_to_rhs(this.branch,1.0,rhs);\n\t}\n\n\tfunction ISource(npos,nneg,v) {\n\t    Device.call(this);\n\t    this.src = parse_source(v);\n\t    this.npos = npos;\n\t    this.nneg = nneg;\n\t}\n\tISource.prototype = new Device();\n\tISource.prototype.constructor = ISource;\n\n        ISource.prototype.load_linear = function(ckt) {\n\t    // Current source is open when off, no linear contribution\n\t}\n\n\t// load linear system equations for dc analysis\n\tISource.prototype.load_dc = function(ckt,soln,rhs) {\n\t    var is = this.src.dc;\n\n\t    // MNA stamp for independent current source\n\t    ckt.add_to_rhs(this.npos,-is,rhs);  // current flow into npos\n\t    ckt.add_to_rhs(this.nneg,is,rhs);   // and out of nneg\n\t}\n\n\t// load linear system equations for tran analysis (just like DC)\n        ISource.prototype.load_tran = function(ckt,soln,rhs,time) {\n\t    var is = this.src.value(time);\n\n\t    // MNA stamp for independent current source\n\t    ckt.add_to_rhs(this.npos,-is,rhs);  // current flow into npos\n\t    ckt.add_to_rhs(this.nneg,is,rhs);   // and out of nneg\n\t}\n\n\t// return time of next breakpoint for the device\n\tISource.prototype.breakpoint = function(time) {\n\t    return this.src.inflection_point(time);\n\t}\n\n\t// small signal model: open circuit\n        ISource.prototype.load_ac = function(ckt,rhs) {\n\t    // MNA stamp for independent current source\n\t    ckt.add_to_rhs(this.npos,-1.0,rhs);  // current flow into npos\n\t    ckt.add_to_rhs(this.nneg,1.0,rhs);   // and out of nneg\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Resistor\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\tfunction Resistor(n1,n2,v) {\n\t    Device.call(this);\n\t    this.n1 = n1;\n\t    this.n2 = n2;\n\t    this.g = 1.0/v;\n\t}\n\tResistor.prototype = new Device();\n\tResistor.prototype.constructor = Resistor;\n\n        Resistor.prototype.load_linear = function(ckt) {\n\t    // MNA stamp for admittance g\n\t    ckt.add_conductance_l(this.n1,this.n2,this.g);\n\t}\n\n\tResistor.prototype.load_dc = function(ckt) {\n\t    // Nothing to see here, move along.\n\t}\n\n\tResistor.prototype.load_tran = function(ckt,soln) {\n\t}\n\n\tResistor.prototype.load_ac = function(ckt) {\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Diode\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\tfunction Diode(n1,n2,v,type) {\n\t    Device.call(this);\n\t    this.anode = n1;\n\t    this.cathode = n2;\n\t    this.area = v;\n\t    this.type = type;  // 'normal' or 'ideal'\n\t    this.is = 1.0e-14;\n\t    this.ais = this.area * this.is;\n\t    this.vt = (type == 'normal') ? 25.8e-3 : 0.1e-3;  // 26mv or .1mv\n\t    this.exp_arg_max = 50;  // less than single precision max.\n\t    this.exp_max = Math.exp(this.exp_arg_max);\n\t}\n\tDiode.prototype = new Device();\n        Diode.prototype.constructor = Diode;\n\n        Diode.prototype.load_linear = function(ckt) {\n\t    // Diode is not linear, has no linear piece.\n\t}\n\n        Diode.prototype.load_dc = function(ckt,soln,rhs) {\n\t    var vd = ckt.get_two_terminal(this.anode, this.cathode, soln);\n\t    var exp_arg = vd / this.vt;\n\t    var temp1, temp2;\n\t    // Estimate exponential with a quadratic if arg too big.\n\t    var abs_exp_arg = Math.abs(exp_arg);\n\t    var d_arg = abs_exp_arg - this.exp_arg_max;\n\t    if (d_arg > 0) {\n\t\tvar quad = 1 + d_arg + 0.5*d_arg*d_arg;\n\t\ttemp1 = this.exp_max * quad;\n\t\ttemp2 = this.exp_max * (1 + d_arg);\n\t    } else {\n\t\ttemp1 = Math.exp(abs_exp_arg);\n\t\ttemp2 = temp1;\n\t    }\n\t    if (exp_arg < 0) {  // Use exp(-x) = 1.0/exp(x)\n\t\ttemp1 = 1.0/temp1;\n\t\ttemp2 = (temp1*temp2)*temp1;\n\t    }\n\t    var id = this.ais * (temp1 - 1);\n\t    var gd = this.ais * (temp2 / this.vt);\n\n\t    // MNA stamp for independent current source\n\t    ckt.add_to_rhs(this.anode,-id,rhs);  // current flows into anode\n\t    ckt.add_to_rhs(this.cathode,id,rhs);   // and out of cathode\n\t    ckt.add_conductance(this.anode,this.cathode,gd);\n\t}\n\n        Diode.prototype.load_tran = function(ckt,soln,rhs,time) {\n\t    this.load_dc(ckt,soln,rhs);\n\t}\n\n\tDiode.prototype.load_ac = function(ckt) {\n\t}\n\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Capacitor\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\tfunction Capacitor(n1,n2,v) {\n\t    Device.call(this);\n\t    this.n1 = n1;\n\t    this.n2 = n2;\n\t    this.value = v;\n\t}\n\tCapacitor.prototype = new Device();\n\tCapacitor.prototype.constructor = Capacitor;\n\n        Capacitor.prototype.load_linear = function(ckt) {\n\t    // MNA stamp for capacitance matrix\n\t    ckt.add_capacitance(this.n1,this.n2,this.value);\n\t}\n\n\tCapacitor.prototype.load_dc = function(ckt,soln,rhs) {\n\t}\n\n\tCapacitor.prototype.load_ac = function(ckt) {\n\t}\n\n\tCapacitor.prototype.load_tran = function(ckt) {\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Inductor\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\tfunction Inductor(n1,n2,branch,v) {\n\t    Device.call(this);\n\t    this.n1 = n1;\n\t    this.n2 = n2;\n\t    this.branch = branch;\n\t    this.value = v;\n\t}\n\tInductor.prototype = new Device();\n\tInductor.prototype.constructor = Inductor;\n\n        Inductor.prototype.load_linear = function(ckt) {\n\t    // MNA stamp for inductor linear part\n\t    // L on diag of C because L di/dt = v(n1) - v(n2)\n\t    ckt.add_to_Gl(this.n1,this.branch,1);\n\t    ckt.add_to_Gl(this.n2,this.branch,-1);\n\t    ckt.add_to_Gl(this.branch,this.n1,-1);\n\t    ckt.add_to_Gl(this.branch,this.n2,1);\n\t    ckt.add_to_C(this.branch,this.branch,this.value)\n\t}\n\n\tInductor.prototype.load_dc = function(ckt,soln,rhs) {\n\t    // Inductor is a short at dc, so is linear.\n\t}\n\n\tInductor.prototype.load_ac = function(ckt) {\n\t}\n\n\tInductor.prototype.load_tran = function(ckt) {\n\t}\n\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Simple Voltage-Controlled Voltage Source Op Amp model\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n        function Opamp(np,nn,no,ng,branch,A,name) {\n\t    Device.call(this);\n\t    this.np = np;\n\t    this.nn = nn;\n\t    this.no = no;\n\t    this.ng = ng;\n\t    this.branch = branch;\n\t    this.gain = A;\n\t    this.name = name;\n\t}\n\n\tOpamp.prototype = new Device();\n        Opamp.prototype.constructor = Opamp;\n        Opamp.prototype.load_linear = function(ckt) {\n            // MNA stamp for VCVS: 1/A(v(no) - v(ng)) - (v(np)-v(nn))) = 0.\n\t    var invA = 1.0/this.gain;\n\t    ckt.add_to_Gl(this.no,this.branch,1);\n\t    ckt.add_to_Gl(this.ng,this.branch,-1);\n\t    ckt.add_to_Gl(this.branch,this.no,invA);\n\t    ckt.add_to_Gl(this.branch,this.ng,-invA);\n\t    ckt.add_to_Gl(this.branch,this.np,-1);\n\t    ckt.add_to_Gl(this.branch,this.nn,1);\n\t}\n\n\tOpamp.prototype.load_dc = function(ckt,soln,rhs) {\n\t    // Op-amp is linear.\n\t}\n\n\tOpamp.prototype.load_ac = function(ckt) {\n\t}\n\n\tOpamp.prototype.load_tran = function(ckt) {\n\t}\n\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Simplified MOS FET with no bulk connection and no body effect.\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n        function Fet(d,g,s,ratio,name,type) {\n\t    Device.call(this);\n\t    this.d = d;\n\t    this.g = g;\n\t    this.s = s;\n\t    this.name = name;\n\t    this.ratio = ratio;\n\t    if (type != 'n' && type != 'p')\n\t    { throw 'fet type is not n or p';\n\t    }\n\t    this.type_sign = (type == 'n') ? 1 : -1;\n\t    this.vt = 0.5;\n\t    this.kp = 20e-6;\n            this.beta = this.kp * this.ratio;\n\t    this.lambda = 0.05;\n\t}\n\tFet.prototype = new Device();\n        Fet.prototype.constructor = Fet;\n\n        Fet.prototype.load_linear = function(ckt) {\n\t    // FET's are nonlinear, just like javascript progammers\n\t}\n\n        Fet.prototype.load_dc = function(ckt,soln,rhs) {\n\t    var vds = this.type_sign * ckt.get_two_terminal(this.d, this.s, soln);\n\t    if (vds < 0) { // Drain and source have swapped roles\n\t\tvar temp = this.d;\n\t\tthis.d = this.s;\n\t\tthis.s = temp;\n\t\tvds = this.type_sign * ckt.get_two_terminal(this.d, this.s, soln);\n\t    }\n\t    var vgs = this.type_sign * ckt.get_two_terminal(this.g, this.s, soln);\n\t    var vgst = vgs - this.vt;\n\t    var gmgs,ids,gds;\n\t    if (vgst > 0.0 ) { // vgst < 0, transistor off, no subthreshold here.\n\t\tif (vgst < vds) { /* Saturation. */\n\t    \tgmgs =  this.beta * (1 + (this.lambda * vds)) * vgst;\n\t    \tids = this.type_sign * 0.5 * gmgs * vgst;\n\t    \tgds = 0.5 * this.beta * vgst * vgst * this.lambda;\n\t\t} else {  /* Linear region */\n\t    \tgmgs =  this.beta * (1 + this.lambda * vds);\n\t    \tids = this.type_sign * gmgs * vds * (vgst - 0.50 * vds);\n\t    \tgds = gmgs * (vgst - vds) + this.beta * this.lambda * vds * (vgst - 0.5 * vds);\n\t    \tgmgs *= vds;\n\t\t}\n\t\tckt.add_to_rhs(this.d,-ids,rhs);  // current flows into the drain\n\t\tckt.add_to_rhs(this.s, ids,rhs);   // and out the source\n\t\tckt.add_conductance(this.d,this.s,gds);\n\t\tckt.add_to_G(this.s,this.s, gmgs);\n\t\tckt.add_to_G(this.d,this.s,-gmgs);\n\t\tckt.add_to_G(this.d,this.g, gmgs);\n\t\tckt.add_to_G(this.s,this.g,-gmgs);\n\t    }\n\t}\n\n\tFet.prototype.load_tran = function(ckt,soln,rhs) {\n\t    this.load_dc(ckt,soln,rhs);\n\t}\n\n\tFet.prototype.load_ac = function(ckt) {\n\t}\n\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Module definition\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\tvar module = {\n\t    'Circuit': Circuit,\n\t    'parse_number': parse_number,\n\t    'parse_source': parse_source\n\t}\n\treturn module;\n    }());\n\n/////////////////////////////////////////////////////////////////////////////\n//\n//  Simple schematic capture\n//\n////////////////////////////////////////////////////////////////////////////////\n\n// Copyright (C) 2011 Massachusetts Institute of Technology\n\n// add schematics to a document with\n//\n//   <input type=\"hidden\" class=\"schematic\" name=\"unique_form_id\" value=\"JSON netlist...\" .../>\n//\n// other attributes you can add to the input tag:\n//   width -- width in pixels of diagram\n//   height -- height in pixels of diagram\n//   parts -- comma-separated list of parts for parts bin (see parts_map),\n//            parts=\"\" disables editing of diagram\n\n// JSON schematic representation:\n//  sch :=  [part, part, ...]\n//  part := [type, coords, properties, connections]\n//  type := string (see parts_map)\n//  coords := [number, ...]  // (x,y,rot) or (x1,y1,x2,y2)\n//  properties := {name: value, ...}\n//  connections := [node, ...]   // one per connection point in canoncial order\n//  node := string\n// need a netlist? just use the part's type, properites and connections\n\n// TO DO:\n// - wire labels?\n// - zoom/scroll canvas\n// - rotate multiple objects around their center of mass\n// - rubber band wires when moving components\n\n// set up each schematic entry widget\nfunction update_schematics() {\n    // set up each schematic on the page\n    var schematics = $('.schematic');\n    for (var i = 0; i < schematics.length; ++i)\n\tif (schematics[i].getAttribute(\"loaded\") != \"true\") {\n\t    try {\n\t\tnew schematic.Schematic(schematics[i]);\n\t    } catch (err) {\n\t\tvar msgdiv = document.createElement('div');\n\t\tmsgdiv.style.border = 'thick solid #FF0000';\n\t\tmsgdiv.style.margins = '20px';\n\t\tmsgdiv.style.padding = '20px';\n\t\tvar msg = document.createTextNode('Sorry, there a browser error in starting the schematic tool.  The tool is known to be compatible with the latest versions of Firefox and Chrome, which we recommend you use.');\n\t\tmsgdiv.appendChild(msg);\n\t\tschematics[i].parentNode.insertBefore(msgdiv,schematics[i]);\n\t    }\n\t    schematics[i].setAttribute(\"loaded\",\"true\");\n\t}\n}\nwindow.update_schematics = update_schematics;\n\nschematic = (function() {\n    var background_style = 'rgb(220,220,220)';\n    var element_style = 'rgb(255,255,255)';\n    var thumb_style = 'rgb(128,128,128)';\n    var normal_style = 'rgb(0,0,0)';  // default drawing color\n    var component_style = 'rgb(64,64,255)';  // color for unselected components\n    var selected_style = 'rgb(64,255,64)';  // highlight color for selected components\n    var grid_style = \"rgb(128,128,128)\";\n    var annotation_style = 'rgb(255,64,64)';  // color for diagram annotations\n    var property_size = 5;  // point size for Component property text\n    var annotation_size = 6;  // point size for diagram annotations\n\n    var parts_map = {\n\t    'g': [Ground, 'Ground connection'],\n\t    'L': [Label, 'Node label'],\n\t    'v': [VSource, 'Voltage source'],\n\t    'i': [ISource, 'Current source'],\n\t    'r': [Resistor, 'Resistor'],\n\t    'c': [Capacitor, 'Capacitor'],\n\t    'l': [Inductor, 'Inductor'],\n\t    'o': [OpAmp, 'Op Amp'],\n\t    'd': [Diode, 'Diode'],\n\t    'n': [NFet, 'NFet'],\n\t    'p': [PFet, 'PFet'],\n\t    's': [Probe, 'Voltage Probe'],\n\t    'a': [Ammeter, 'Current Probe']\n\t};\n\n\t// global clipboard\n\tif (typeof sch_clipboard == 'undefined')\n\t    sch_clipboard = [];\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Schematic = diagram + parts bin + status area\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\t// setup a schematic by populating the <div> with the appropriate children\n\tfunction Schematic(input) {\n\t    // set up diagram viewing parameters\n\t    this.show_grid = true;\n\t    this.grid = 8;\n\t    this.scale = 2;\n\t    this.origin_x = input.getAttribute(\"origin_x\");\n\t    if (this.origin_x == undefined) this.origin_x = 0;\n\t    this.origin_y = input.getAttribute(\"origin_y\");\n\t    if (this.origin_y == undefined) this.origin_y = 0;\n\t    this.cursor_x = 0;\n\t    this.cursor_y = 0;\n\t    this.window_list = [];  // list of pop-up windows in increasing z order\n\n\t    // use user-supplied list of parts if supplied\n\t    // else just populate parts bin with all the parts\n\t    this.edits_allowed = true;\n\t    var parts = input.getAttribute('parts');\n\t    if (parts == undefined || parts == 'None') {\n            parts = [];\n\t\tfor (var p in parts_map) parts.push(p);\n\t    } else if (parts == '') {\n\t\tthis.edits_allowed = false;\n\t\tparts = [];\n\t    } else parts = parts.split(',');\n\n\t    // now add the parts to the parts bin\n\t    this.parts_bin = [];\n\t    for (var i = 0; i < parts.length; i++) {\n\t\tvar part = new Part(this);\n\t\tvar pm = parts_map[parts[i]];\n\t\tpart.set_component(new pm[0](0,0,0),pm[1]);\n\t\tthis.parts_bin.push(part);\n\t    }\n\n\t    // use user-supplied list of analyses, otherwise provide them all\n\t    // analyses=\"\" means no analyses\n\t    var analyses = input.getAttribute('analyses');\n\t    if (analyses == undefined || analyses == 'None')\n\t\tanalyses = ['dc','ac','tran'];\n\t    else if (analyses == '') analyses = [];\n\t    else analyses = analyses.split(',');\n\n\t    if (parts.length == 0 && analyses.length == 0) this.diagram_only = true;\n\t    else this.diagram_only = false;\n\n\t    // see what we need to submit.  Expecting attribute of the form\n\t    // submit_analyses=\"{'tran':[[node_name,t1,t2,t3],...],\n\t    //                   'ac':[[node_name,f1,f2,...],...]}\"\n\t    var submit = input.getAttribute('submit_analyses');\n\t    if (submit && submit.indexOf('{') != -1)\n\t\tthis.submit_analyses = JSON.parse(submit);\n\t    else\n\t\tthis.submit_analyses = undefined;\n\n\t    // toolbar\n        this.tools = [];\n\t    this.toolbar = [];\n\n        /* DISABLE HELP BUTTON (target URL not consistent with multicourse hierarchy) -- SJSU\n\t    if (!this.diagram_only) {\n\t\tthis.tools['help'] = this.add_tool(help_icon,'Help: display help page',this.help);\n\t\tthis.enable_tool('help',true);\n\t\tthis.toolbar.push(null);  // spacer\n\t    }\n        END DISABLE HELP BUTTON -- SJSU */\n\n\t    if (this.edits_allowed) {\n\t\tthis.tools['grid'] = this.add_tool(grid_icon,'Grid: toggle grid display',this.toggle_grid);\n\t\tthis.enable_tool('grid',true);\n\t\tthis.tools['cut'] = this.add_tool(cut_icon,'Cut: move selected components from diagram to the clipboard',this.cut);\n\t\tthis.tools['copy'] = this.add_tool(copy_icon,'Copy: copy selected components into the clipboard',this.copy);\n\t\tthis.tools['paste'] = this.add_tool(paste_icon,'Paste: copy clipboard into the diagram',this.paste);\n\t\tthis.toolbar.push(null);  // spacer\n\t    }\n\n\t    // simulation interface if cktsim.js is loaded\n\t    if (typeof cktsim != 'undefined') {\n\t\tif (analyses.indexOf('dc') != -1) {\n\t\t    this.tools['dc'] = this.add_tool('DC','DC Analysis',this.dc_analysis);\n\t\t    this.enable_tool('dc',true);\n\t\t    this.dc_max_iters = '1000';  // default values dc solution\n\t\t}\n\n\t\tif (analyses.indexOf('ac') != -1) {\n\t\t    this.tools['ac'] = this.add_tool('AC','AC Small-Signal Analysis',this.setup_ac_analysis);\n\t\t    this.enable_tool('ac',true);\n\t\t    this.ac_npts = '50'; // default values for AC Analysis\n\t\t    this.ac_fstart = '10';\n\t\t    this.ac_fstop = '1G';\n\t\t    this.ac_source_name = undefined;\n\t\t}\n\n\t\tif (analyses.indexOf('tran') != -1) {\n\t\t    this.tools['tran'] = this.add_tool('TRAN','Transient Analysis',this.transient_analysis);\n\t\t    this.enable_tool('tran',true);\n\t\t    this.tran_npts = '100';  // default values for transient analysis\n\t\t    this.tran_tstop = '1';\n\t\t}\n\t    }\n\n\t    // set up diagram canvas\n\t    this.canvas = document.createElement('canvas');\n\t    this.width = input.getAttribute('width');\n\t    this.width = parseInt(this.width == undefined ? '400' : this.width);\n\t    this.canvas.width = this.width;\n\t    this.height = input.getAttribute('height');\n\t    this.height = parseInt(this.height == undefined ? '300' : this.height);\n\t    this.canvas.height = this.height;\n\n\t    this.sctl_r = 16;   // scrolling control parameters\n\t    this.sctl_x = this.sctl_r + 8;   // upper left\n\t    this.sctl_y = this.sctl_r + 8;\n\t    this.zctl_left = this.sctl_x - 8;\n\t    this.zctl_top = this.sctl_y + this.sctl_r + 8;\n\n\t    // repaint simply draws this buffer and then adds selected elements on top\n\t    this.bg_image = document.createElement('canvas');\n\t    this.bg_image.width = this.width;\n\t    this.bg_image.height = this.height;\n\n\t    if (!this.diagram_only) {\n        this.canvas.tabIndex = 0; // so we get keystrokes\n\t\tthis.canvas.style.borderStyle = 'solid';\n\t\tthis.canvas.style.borderWidth = '1px';\n\t\tthis.canvas.style.borderColor = grid_style;\n\t\tthis.canvas.style.outline = 'none';\n\t    }\n\n\t    this.canvas.schematic = this;\n\t    if (this.edits_allowed) {\n\t\tthis.canvas.addEventListener('mousemove',schematic_mouse_move,false);\n\t\tthis.canvas.addEventListener('mouseover',schematic_mouse_enter,false);\n\t\tthis.canvas.addEventListener('mouseout',schematic_mouse_leave,false);\n\t\tthis.canvas.addEventListener('mousedown',schematic_mouse_down,false);\n\t\tthis.canvas.addEventListener('mouseup',schematic_mouse_up,false);\n\t\tthis.canvas.addEventListener('mousewheel',schematic_mouse_wheel,false);\n\t\tthis.canvas.addEventListener('DOMMouseScroll',schematic_mouse_wheel,false);  // for FF\n\t\tthis.canvas.addEventListener('dblclick',schematic_double_click,false);\n\t\tthis.canvas.addEventListener('keydown',schematic_key_down,false);\n\t\tthis.canvas.addEventListener('keyup',schematic_key_up,false);\n\t    }\n\n\t    // set up message area\n\t    if (!this.diagram_only) {\n\t\tthis.status_div = document.createElement('div');\n\t\tthis.status = document.createTextNode('');\n\t\tthis.status_div.appendChild(this.status);\n\t\tthis.status_div.style.height = status_height + 'px';\n\t    } else this.status_div = undefined;\n\n        this.connection_points = []; // location string => list of cp's\n\t    this.components = [];\n\t    this.dragging = false;\n\t    this.select_rect = undefined;\n\t    this.wire = undefined;\n\t    this.operating_point = undefined;  // result from DC analysis\n\t    this.dc_results = undefined;   // saved analysis results for submission\n\t    this.ac_results = undefined;   // saved analysis results for submission\n\t    this.transient_results = undefined;   // saved analysis results for submission\n\n\t    // state of modifier keys\n\t    this.ctrlKey = false;\n\t    this.shiftKey = false;\n\t    this.altKey = false;\n\t    this.cmdKey = false;\n\n\t    // make sure other code can find us!\n\t    input.schematic = this;\n\t    this.input = input;\n\n\t    // set up DOM -- use nested tables to do the layout\n\t    var table,tr,td;\n\t    table = document.createElement('table');\n\t    table.rules = 'none';\n\t    if (!this.diagram_only) {\n\t\ttable.frame = 'box';\n\t\ttable.style.borderStyle = 'solid';\n\t\ttable.style.borderWidth = '2px';\n\t\ttable.style.borderColor = normal_style;\n\t\ttable.style.backgroundColor = background_style;\n\t    }\n\n\t    // add tools to DOM\n\t    if (this.toolbar.length > 0) {\n\t\ttr = document.createElement('tr');\n\t\ttable.appendChild(tr);\n\t\ttd = document.createElement('td');\n\t\ttd.style.verticalAlign = 'top';\n\t\ttd.colSpan = 2;\n\t\ttr.appendChild(td);\n\t\tfor (var i = 0; i < this.toolbar.length; ++i) {\n\t\t    var tool = this.toolbar[i];\n\t\t    if (tool != null) td.appendChild(tool);\n\t\t}\n\t    }\n\n\t    // add canvas and parts bin to DOM\n\t    tr = document.createElement('tr');\n\t    table.appendChild(tr);\n\n\t    td = document.createElement('td');\n\t    tr.appendChild(td);\n\t    var wrapper = document.createElement('div'); // for inserting pop-up windows\n\t    td.appendChild(wrapper);\n\t    wrapper.style.position = 'relative';  // so we can position subwindows\n\t    wrapper.appendChild(this.canvas);\n\n\t    td = document.createElement('td');\n\t    td.style.verticalAlign = 'top';\n\t    tr.appendChild(td);\n\t    var parts_table = document.createElement('table');\n\t    td.appendChild(parts_table);\n\t    parts_table.rules = 'none';\n\t    parts_table.frame = 'void';\n\t    parts_table.cellPadding = '0';\n\t    parts_table.cellSpacing = '0';\n\n\t    // fill in parts_table\n\t    var parts_per_column = Math.floor(this.height / (part_h + 5));  // mysterious extra padding\n\t    for (var i = 0; i < parts_per_column; ++i) {\n\t\ttr = document.createElement('tr');\n\t\tparts_table.appendChild(tr);\n\t\tfor (var j = i; j < this.parts_bin.length; j += parts_per_column) {\n\t\t    td = document.createElement('td');\n\t\t    tr.appendChild(td);\n\t\t    td.appendChild(this.parts_bin[j].canvas);\n\t\t}\n\t    }\n\n\t    if (this.status_div != undefined) {\n\t\ttr = document.createElement('tr');\n\t\ttable.appendChild(tr);\n\t\ttd = document.createElement('td');\n\t\ttr.appendChild(td);\n\t\ttd.colSpan = 2;\n\t\ttd.appendChild(this.status_div);\n\t    }\n\n\t    // add to dom\n\t    // avoid Chrome bug that changes to text cursor whenever\n\t    // drag starts.  Just do this in schematic tool...\n\t    var toplevel = document.createElement('div');\n\t    toplevel.onselectstart = function(){ return false; };\n\t    toplevel.appendChild(table);\n\t    this.input.parentNode.insertBefore(toplevel,this.input.nextSibling);\n\n\t    // process initial contents of diagram\n\t    this.load_schematic(this.input.getAttribute('value'),\n\t\t\t\tthis.input.getAttribute('initial_value'));\n\n\t    // start by centering diagram on the screen\n\t    this.zoomall();\n\t}\n\n\tvar part_w = 42;   // size of a parts bin compartment\n\tvar part_h = 42;\n\tvar status_height = 18;\n\n\tSchematic.prototype.add_component = function(new_c) {\n\t    this.components.push(new_c);\n\t    // create undoable edit record here\n\t}\n\n\tSchematic.prototype.remove_component = function(c) {\n\t    var index = this.components.indexOf(c);\n\t    if (index != -1) this.components.splice(index,1);\n\t}\n\n\tSchematic.prototype.find_connections = function(cp) {\n\t    return this.connection_points[cp.location];\n\t}\n\n\tSchematic.prototype.add_connection_point = function(cp) {\n\t    var cplist = this.connection_points[cp.location];\n\t    if (cplist) cplist.push(cp);\n\t    else {\n\t\tcplist = [cp];\n\t\tthis.connection_points[cp.location] = cplist;\n\t    }\n\n\t    return cplist;\n\t}\n\n\tSchematic.prototype.remove_connection_point = function(cp,old_location) {\n\t    // remove cp from list at old location\n\t    var cplist = this.connection_points[old_location];\n\t    if (cplist) {\n\t\tvar index = cplist.indexOf(cp);\n\t\tif (index != -1) {\n\t\t    cplist.splice(index,1);\n\t\t    // if no more connections at this location, remove\n\t\t    // entry from array to keep our search time short\n\t\t    if (cplist.length == 0)\n\t\t\tdelete this.connection_points[old_location];\n\t\t}\n\t    }\n\t}\n\n\tSchematic.prototype.update_connection_point = function(cp,old_location) {\n\t    this.remove_connection_point(cp,old_location);\n\t    return this.add_connection_point(cp);\n\t}\n\n\tSchematic.prototype.add_wire = function(x1,y1,x2,y2) {\n\t    var new_wire = new Wire(x1,y1,x2,y2);\n\t    new_wire.add(this);\n\t    new_wire.move_end();\n\t    return new_wire;\n\t}\n\n\tSchematic.prototype.split_wire = function(w,cp) {\n\t    // remove bisected wire\n\t    w.remove();\n\n\t    // add two new wires with connection point cp in the middle\n\t    this.add_wire(w.x,w.y,cp.x,cp.y);\n\t    this.add_wire(w.x+w.dx,w.y+w.dy,cp.x,cp.y);\n\t}\n\n\t// see if connection points of component c split any wires\n\tSchematic.prototype.check_wires = function(c) {\n\t    for (var i = 0; i < this.components.length; i++) {\n\t\tvar cc = this.components[i];\n\t\tif (cc != c) {  // don't check a component against itself\n\t\t    // only wires will return non-null from a bisect call\n\t\t    var cp = cc.bisect(c);\n\t\t    if (cp) {\n\t\t\t// cc is a wire bisected by connection point cp\n\t\t\tthis.split_wire(cc,cp);\n\t\t\tthis.redraw_background();\n\t\t    }\n\t\t}\n\t    }\n\t}\n\n\t// see if there are any existing connection points that bisect wire w\n\tSchematic.prototype.check_connection_points = function(w) {\n\t    for (var locn in this.connection_points) {\n\t\tvar cplist = this.connection_points[locn];\n\t\tif (cplist && w.bisect_cp(cplist[0])) {\n\t\t    this.split_wire(w,cplist[0]);\n\t\t    this.redraw_background();\n\n\t\t    // stop here, new wires introduced by split will do their own checks\n\t\t    return;\n\t\t}\n\t    }\n\t}\n\n\t// merge collinear wires sharing an end point\n\tSchematic.prototype.clean_up_wires = function() {\n\t    for (var locn in this.connection_points) {\n\t\tvar cplist = this.connection_points[locn];\n\t\tif (cplist && cplist.length == 2) {\n\t\t    // found a connection with just two connections, see if they're wires\n\t\t    var c1 = cplist[0].parent;\n\t\t    var c2 = cplist[1].parent;\n\t\t    if (c1.type == 'w' && c2.type == 'w') {\n\t\t\tvar e1 = c1.other_end(cplist[0]);\n\t\t\tvar e2 = c2.other_end(cplist[1]);\n\t\t\tvar e3 = cplist[0];  // point shared by the two wires\n\t\t\tif (collinear(e1,e2,e3)) {\n\t\t\t    c1.remove();\n\t\t\t    c2.remove();\n\t\t\t    this.add_wire(e1.x,e1.y,e2.x,e2.y);\n\t\t\t}\n\t\t    }\n\t\t}\n\t    }\n\t}\n\n\tSchematic.prototype.unselect_all = function(which) {\n\t    this.operating_point = undefined;  // remove annotations\n\t    for (var i = this.components.length - 1; i >= 0; --i)\n\t\tif (i != which) this.components[i].set_select(false);\n\t}\n\n\tSchematic.prototype.drag_begin = function() {\n\t    // let components know they're about to move\n\t    for (var i = this.components.length - 1; i >= 0; --i) {\n\t\tvar component = this.components[i];\n\t\tif (component.selected) component.move_begin();\n\t    }\n\n\t    // remember where drag started\n\t    this.drag_x = this.cursor_x;\n\t    this.drag_y = this.cursor_y;\n\t    this.dragging = true;\n\t}\n\n\tSchematic.prototype.drag_end = function() {\n\t    // let components know they're done moving\n\t    for (var i = this.components.length - 1; i >= 0; --i) {\n\t\tvar component = this.components[i];\n\t\tif (component.selected) component.move_end();\n\t    }\n\t    this.dragging = false;\n\t    this.clean_up_wires();\n\t    this.redraw_background();\n\t}\n\n\tSchematic.prototype.help = function() {\n\t    window.open('/static/handouts/schematic_tutorial.pdf');\n\t}\n\n\t// zoom diagram around given coords\n\tSchematic.prototype.rescale = function(nscale,cx,cy) {\n\t    if (cx == undefined) {\n\t\t// use current center point if no point has been specified\n\t\tcx = this.origin_x + this.width/(2*this.scale);\n\t\tcy = this.origin_y + this.height/(2*this.scale);\n\t    }\n\n\t    this.origin_x += cx*(this.scale - nscale);\n\t    this.origin_y += cy*(this.scale - nscale);\n\t    this.scale = nscale;\n\t    this.redraw_background();\n\t}\n\n\tSchematic.prototype.toggle_grid = function() {\n\t    this.show_grid = !this.show_grid;\n\t    this.redraw_background();\n\t}\n\n\tvar zoom_factor = 1.25;    // scaling is some power of zoom_factor\n\tvar zoom_min = 0.5;\n\tvar zoom_max = 4.0;\n\tvar origin_min = -200;    // in grids\n\tvar origin_max = 200;\n\n\tSchematic.prototype.zoomin = function() {\n\t    var nscale = this.scale * zoom_factor;\n\t    if (nscale < zoom_max) {\n\t\t// keep center of view unchanged\n\t\tthis.origin_x += (this.width/2)*(1.0/this.scale - 1.0/nscale);\n\t\tthis.origin_y += (this.height/2)*(1.0/this.scale - 1.0/nscale);\n\t\tthis.scale = nscale;\n\t\tthis.redraw_background();\n\t    }\n\t}\n\n\tSchematic.prototype.zoomout = function() {\n\t    var nscale = this.scale / zoom_factor;\n\t    if (nscale > zoom_min) {\n\t\t// keep center of view unchanged\n\t\tthis.origin_x += (this.width/2)*(1.0/this.scale - 1.0/nscale);\n\t\tthis.origin_y += (this.height/2)*(1.0/this.scale - 1.0/nscale);\n\t\tthis.scale = nscale;\n\t\tthis.redraw_background();\n\t    }\n\t}\n\n\tSchematic.prototype.zoomall = function() {\n\t    // w,h for schematic including a 25% margin on all sides\n\t    var sch_w = 1.5*(this.bbox[2] - this.bbox[0]);\n\t    var sch_h = 1.5*(this.bbox[3] - this.bbox[1]);\n\n\t    if (sch_w == 0 && sch_h == 0) {\n\t\tthis.origin_x = 0;\n\t\tthis.origin_y = 0;\n\t\tthis.scale = 2;\n\t    } else {\n\t\t// compute scales that would make schematic fit, choose smallest\n\t\tvar scale_x = this.width/sch_w;\n\t\tvar scale_y = this.height/sch_h;\n\t\tthis.scale = Math.pow(zoom_factor,Math.ceil(Math.log(Math.min(scale_x,scale_y))/Math.log(zoom_factor)));\n\t\tif (this.scale < zoom_min) this.scale = zoom_min;\n\t\telse if (this.scale > zoom_max) this.scale = zoom_max;\n\n\t\t// center the schematic\n\t\tthis.origin_x = (this.bbox[2] + this.bbox[0])/2 - this.width/(2*this.scale);\n\t\tthis.origin_y = (this.bbox[3] + this.bbox[1])/2 - this.height/(2*this.scale);\n\t    }\n\n\t    this.redraw_background();\n\t}\n\n\tSchematic.prototype.cut = function() {\n\t    // clear previous contents\n\t    sch_clipboard = [];\n\n\t    // look for selected components, move them to clipboard.\n\t    for (var i = this.components.length - 1; i >=0; --i) {\n\t\tvar c = this.components[i];\n\t\tif (c.selected) {\n\t\t    c.remove();\n\t\t    sch_clipboard.push(c);\n\t\t}\n\t    }\n\n\t    // update diagram view\n\t    this.redraw();\n\t}\n\n\tSchematic.prototype.copy = function() {\n\t    // clear previous contents\n\t    sch_clipboard = [];\n\n\t    // look for selected components, copy them to clipboard.\n\t    for (var i = this.components.length - 1; i >=0; --i) {\n\t\tvar c = this.components[i];\n\t\tif (c.selected)\n\t\t    sch_clipboard.push(c.clone(c.x,c.y));\n\t    }\n\t}\n\n\tSchematic.prototype.paste = function() {\n\t    // compute left,top of bounding box for origins of\n\t    // components in the clipboard\n\t    var left = undefined;\n\t    var top = undefined;\n\t    for (var i = sch_clipboard.length - 1; i >= 0; --i) {\n\t\tvar c = sch_clipboard[i];\n\t\tleft = left ? Math.min(left,c.x) : c.x;\n\t\ttop = top ? Math.min(top,c.y) : c.y;\n\t    }\n\n\t    this.message('cursor '+this.cursor_x+','+this.cursor_y);\n\n\t    // clear current selections\n\t    this.unselect_all(-1);\n\t    this.redraw_background();  // so we see any components that got unselected\n\n\t    // make clones of components on the clipboard, positioning\n\t    // them relative to the cursor\n\t    for (var i = sch_clipboard.length - 1; i >= 0; --i) {\n\t\tvar c = sch_clipboard[i];\n\t\tvar new_c = c.clone(this.cursor_x + (c.x - left),this.cursor_y + (c.y - top));\n\t\tnew_c.set_select(true);\n\t\tnew_c.add(this);\n\t    }\n\n\t    this.redraw();\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Netlist and Simulation interface\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\t// load diagram from JSON representation\n\tSchematic.prototype.load_schematic = function(value,initial_value) {\n\t    // use default value if no schematic info in value\n\t    if (value == undefined || value.indexOf('[') == -1)\n\t\tvalue = initial_value;\n\t    if (value && value.indexOf('[') != -1) {\n\t\t// convert string value into data structure\n\t\tvar json = JSON.parse(value);\n\n\t\t// top level is a list of components\n\t\tfor (var i = json.length - 1; i >= 0; --i) {\n\t\t    var c = json[i];\n\t\t    if (c[0] == 'view') {\n\t\t\tthis.ac_fstart = c[5];\n\t\t\tthis.ac_fstop = c[6];\n\t\t\tthis.ac_source_name = c[7];\n\t\t\tthis.tran_npts = c[8];\n\t\t\tthis.tran_tstop = c[9];\n\t\t\tthis.dc_max_iters = c[10];\n\t\t    } else if (c[0] == 'w') {\n\t\t\t// wire\n\t\t\tthis.add_wire(c[1][0],c[1][1],c[1][2],c[1][3]);\n\t\t    } else if (c[0] == 'dc') {\n\t\t\tthis.dc_results = c[1];\n\t\t    } else if (c[0] == 'transient') {\n\t\t\tthis.transient_results = c[1];\n\t\t    } else if (c[0] == 'ac') {\n\t\t\tthis.ac_results = c[1];\n\t\t    } else {\n\t\t\t// ordinary component\n\t\t\t//  c := [type, coords, properties, connections]\n\t\t\tvar type = c[0];\n\t\t\tvar coords = c[1];\n\t\t\tvar properties = c[2];\n\n\t\t\tvar part = new parts_map[type][0](coords[0],coords[1],coords[2]);\n\t\t\tfor (var name in properties)\n\t\t\t    part.properties[name] = properties[name];\n\n\t\t\tpart.add(this);\n\t\t    }\n\t\t}\n\t    }\n\n\t    this.redraw_background();\n\t}\n\n\t// label all the nodes in the circuit\n\tSchematic.prototype.label_connection_points = function() {\n\t    // start by clearing all the connection point labels\n\t    for (var i = this.components.length - 1; i >=0; --i)\n\t\tthis.components[i].clear_labels();\n\n\t    // components are in charge of labeling their unlabeled connections.\n\t    // labels given to connection points will propagate to coincident connection\n\t    // points and across Wires.\n\n\t    // let special components like GND label their connection(s)\n\t    for (var i = this.components.length - 1; i >=0; --i)\n\t\tthis.components[i].add_default_labels();\n\n\t    // now have components generate labels for unlabeled connections\n\t    this.next_label = 0;\n\t    for (var i = this.components.length - 1; i >=0; --i)\n\t\tthis.components[i].label_connections();\n\t}\n\n\tSchematic.prototype.get_next_label = function() {\n\t    // generate next label in sequence\n\t    this.next_label += 1;\n\t    return this.next_label.toString();\n\t}\n\n\t// propagate label to coincident connection points\n\tSchematic.prototype.propagate_label = function(label,location) {\n\t    var cplist = this.connection_points[location];\n\t    for (var i = cplist.length - 1; i >= 0; --i)\n\t\tcplist[i].propagate_label(label);\n\t}\n\n\t// update the value field of our corresponding input field with JSON\n\t// representation of schematic\n\tSchematic.prototype.update_value = function() {\n\t    // label connection points\n\t    this.label_connection_points();\n\n\t    // build JSON data structure, convert to string value for\n\t    // input field\n\t    this.input.value = JSON.stringify(this.json_with_analyses());\n\t}\n\n\tSchematic.prototype.json = function() {\n\t    var json = [];\n\n\t    // output all the components/wires in the diagram\n\t    var n = this.components.length;\n\t    for (var i = 0; i < n; i++)\n\t\tjson.push(this.components[i].json(i));\n\n\t    // capture the current view parameters\n\t    json.push(['view',this.origin_x,this.origin_y,this.scale,\n\t\t       this.ac_npts,this.ac_fstart,this.ac_fstop,\n\t\t       this.ac_source_name,this.tran_npts,this.tran_tstop,\n\t\t       this.dc_max_iters]);\n\n\t    return json;\n\t}\n\n\tSchematic.prototype.json_with_analyses = function() {\n\t    var json = this.json();\n\n\t    if (this.dc_results != undefined) json.push(['dc',this.dc_results]);\n\t    if (this.ac_results != undefined) json.push(['ac',this.ac_results]);\n\t    if (this.transient_results != undefined) json.push(['transient',this.transient_results]);\n\n\t    return json;\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Simulation interface\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tSchematic.prototype.extract_circuit = function() {\n\t    // give all the circuit nodes a name, extract netlist\n\t    this.label_connection_points();\n\t    var netlist = this.json();\n\n\t    // since we've done the heavy lifting, update input field value\n\t    // so user can grab diagram if they want\n\t    this.input.value = JSON.stringify(netlist);\n\n\t    // create a circuit from the netlist\n\t    var ckt = new cktsim.Circuit();\n\t    if (ckt.load_netlist(netlist))\n\t\treturn ckt;\n\t    else\n\t\treturn null;\n\t}\n\n\tSchematic.prototype.dc_analysis = function() {\n\t    // remove any previous annotations\n\t    this.unselect_all(-1);\n\t    this.redraw_background();\n\n\t    var ckt = this.extract_circuit();\n\t    if (ckt === null) return;\n\n\t    // run the analysis\n\t    this.operating_point = ckt.dc();\n\n\t    if (this.operating_point != undefined) {\n\t\t// save a copy of the results for submission\n\t\tthis.dc_results = {};\n\t\tfor (var i in this.operating_point) this.dc_results[i] = this.operating_point[i];\n\n\t\t// display results on diagram\n\t\tthis.redraw();\n\t    }\n\t}\n\n\t// return a list of [color,node_label,offset,type] for each probe in the diagram\n\t// type == 'voltage' or 'current'\n\tSchematic.prototype.find_probes = function() {\n\t    var result = [];\n\t    var result = [];\n\t    for (var i = this.components.length - 1; i >= 0; --i) {\n\t\tvar c = this.components[i];\n\t\tvar info = c.probe_info();\n\t\tif (info != undefined) result.push(c.probe_info());\n\t    }\n\t    return result;\n\t}\n\n\t// use a dialog to get AC analysis parameters\n\tSchematic.prototype.setup_ac_analysis = function() {\n\t    this.unselect_all(-1);\n\t    this.redraw_background();\n\n\t    var npts_lbl = 'Number of points/decade';\n\t    var fstart_lbl = 'Starting frequency (Hz)';\n\t    var fstop_lbl = 'Ending frequency (Hz)';\n\t    var source_name_lbl = 'Name of V or I source for ac'\n\n\t    if (this.find_probes().length == 0) {\n\t\talert(\"AC Analysis: there are no voltage probes in the diagram!\");\n\t\treturn;\n\t    }\n\n        var fields = [];\n\t    fields[fstart_lbl] = build_input('text',10,this.ac_fstart);\n\t    fields[fstop_lbl] = build_input('text',10,this.ac_fstop);\n\t    fields[source_name_lbl] = build_input('text',10,this.ac_source_name);\n\n\t    var content = build_table(fields);\n\t    content.fields = fields;\n\t    content.sch = this;\n\n\t    this.dialog('AC Analysis',content,function(content) {\n\t\t    var sch = content.sch;\n\n\t\t    // retrieve parameters, remember for next time\n\t\t    sch.ac_fstart = content.fields[fstart_lbl].value;\n\t\t    sch.ac_fstop = content.fields[fstop_lbl].value;\n\t\t    sch.ac_source_name = content.fields[source_name_lbl].value;\n\n\t\t    sch.ac_analysis(cktsim.parse_number(sch.ac_npts),\n\t\t\t\t    cktsim.parse_number(sch.ac_fstart),\n\t\t\t\t    cktsim.parse_number(sch.ac_fstop),\n\t\t\t\t    sch.ac_source_name);\n\t\t});\n\t}\n\n\tSchematic.prototype.ac_analysis = function(npts,fstart,fstop,ac_source_name) {\n\t    var ckt = this.extract_circuit();\n\t    if (ckt === null) return;\n\t    var results = ckt.ac(npts,fstart,fstop,ac_source_name);\n\n\t    if (typeof results == 'string')\n\t\tthis.message(results);\n\t    else {\n\t\tvar x_values = results['_frequencies_'];\n\n\t\t// x axis will be a log scale\n\t\tfor (var i = x_values.length - 1; i >= 0; --i)\n\t\t    x_values[i] = Math.log(x_values[i])/Math.LN10;\n\n\t\tif (this.submit_analyses != undefined) {\n\t\t    var submit = this.submit_analyses['ac'];\n\t\t    if (submit != undefined) {\n\t\t\t// save a copy of the results for submission\n\t\t\tthis.ac_results = {};\n\n\t\t\t// save requested values for each requested node\n\t\t\tfor (var j = 0; j < submit.length; j++) {\n\t\t\t    var flist = submit[j];    // [node_name,f1,f2,...]\n\t\t\t    var node = flist[0];\n\t\t\t    var values = results[node];\n\t\t\t    var fvlist = [];\n\t\t\t    // for each requested freq, interpolate response value\n\t\t\t    for (var k = 1; k < flist.length; k++) {\n\t\t\t\tvar f = flist[k];\n\t\t\t\tvar v = interpolate(f,x_values,values);\n\t\t\t\t// convert to dB\n\t\t\t\tfvlist.push([f,v == undefined ? 'undefined' : 20.0 * Math.log(v)/Math.LN10]);\n\t\t\t    }\n\t\t\t    // save results as list of [f,response] paris\n\t\t\t    this.ac_results[node] = fvlist;\n\t\t\t}\n\t\t    }\n\t\t}\n\n\t\t// set up plot values for each node with a probe\n\t\tvar y_values = [];  // list of [color, result_array]\n\t\tvar z_values = [];  // list of [color, result_array]\n\t\tvar probes = this.find_probes();\n\t\tvar probe_maxv = [];\n\t\tvar probe_color = [];\n\n\t\t// Check for probe with near zero transfer function and warn\n\t\tfor (var i = probes.length - 1; i >= 0; --i) {\n\t\t    if (probes[i][3] != 'voltage') continue;\n\t\t    probe_color[i] = probes[i][0];\n\t\t    var label = probes[i][1];\n\t\t    var v = results[label];\n\t\t    probe_maxv[i] = array_max(v); // magnitudes always > 0\n\t\t}\n\n        var all_max = array_max(probe_maxv);\n\t\tif (all_max < 1.0e-16) {\n\t\t    alert('Zero ac response, -infinity on DB scale.');\n\t\t} else {\n\t\t    for (var i = probes.length - 1; i >= 0; --i) {\n\t\t\tif (probes[i][3] != 'voltage') continue;\n\t\t\tif ((probe_maxv[i] / all_max) < 1.0e-10) {\n\t\t\t    alert('Near zero ac response, remove ' + probe_color[i] + ' probe');\n\t\t\t    return;\n\t\t\t}\n\t\t    }\n\t\t}\n\n\t\tfor (var i = probes.length - 1; i >= 0; --i) {\n\t\t    if (probes[i][3] != 'voltage') continue;\n\t\t    var color = probes[i][0];\n\t\t    var label = probes[i][1];\n\t\t    var offset = cktsim.parse_number(probes[i][2]);\n\t\t    var v = results[label];\n\t\t    // convert values into dB relative to source amplitude\n\t\t    var v_max = 1;\n\t\t    for (var j = v.length - 1; j >= 0; --j)\n\t\t\t// convert each value to dB relative to max\n\t\t\tv[j] = 20.0 * Math.log(v[j]/v_max)/Math.LN10;\n\t\t    y_values.push([color,offset,v]);\n\n\t\t    var v = results[label+'_phase'];\n\t\t    z_values.push([color,0,v]);\n\t\t}\n\n\t\t// graph the result and display in a window\n\t\tvar graph2 = this.graph(x_values,'log(Frequency in Hz)',z_values,'degrees');\n\t\tthis.window('AC Analysis - Phase',graph2);\n\t\tvar graph1 = this.graph(x_values,'log(Frequency in Hz)',y_values,'dB');\n\t\tthis.window('AC Analysis - Magnitude',graph1,50);\n\t    }\n\t}\n\n\tSchematic.prototype.transient_analysis = function() {\n\t    this.unselect_all(-1);\n\t    this.redraw_background();\n\n\t    var npts_lbl = 'Minimum number of timepoints';\n\t    var tstop_lbl = 'Stop Time (seconds)';\n\t    var probes = this.find_probes();\n\t    if (probes.length == 0) {\n\t\talert(\"Transient Analysis: there are no probes in the diagram!\");\n\t\treturn;\n\t    }\n\n        var fields = [];\n\t    fields[tstop_lbl] = build_input('text',10,this.tran_tstop);\n\n\t    var content = build_table(fields);\n\t    content.fields = fields;\n\t    content.sch = this;\n\n\t    this.dialog('Transient Analysis',content,function(content) {\n\t\t    var sch = content.sch;\n\t\t    var ckt = sch.extract_circuit();\n\t\t    if (ckt === null) return;\n\n\t\t    // retrieve parameters, remember for next time\n\t\t    sch.tran_tstop = content.fields[tstop_lbl].value;\n\n\t\t    // gather a list of nodes that are being probed.  These\n\t\t    // will be added to the list of nodes checked during the\n\t\t    // LTE calculations in transient analysis\n\t\t    var probe_list = sch.find_probes();\n\t\t    var probe_names = new Array(probe_list.length);\n\t\t    for (var i = probe_list.length - 1; i >= 0; --i)\n\t\t\tprobe_names[i] = probe_list[i][1];\n\n\t\t    // run the analysis\n\t\t    var results = ckt.tran(ckt.parse_number(sch.tran_npts), 0,\n\t\t\t\t\t   ckt.parse_number(sch.tran_tstop), probe_names, false);\n\n\t\t    if (typeof results == 'string')\n\t\t\tsch.message(results);\n\t\t    else {\n\t\t\tif (sch.submit_analyses != undefined) {\n\t\t\t    var submit = sch.submit_analyses['tran'];\n\t\t\t    if (submit != undefined) {\n\t\t\t\t// save a copy of the results for submission\n\t\t\t\tsch.transient_results = {};\n\t\t\t\tvar times = results['_time_'];\n\n\t\t\t\t// save requested values for each requested node\n\t\t\t\tfor (var j = 0; j < submit.length; j++) {\n\t\t\t\t    var tlist = submit[j];    // [node_name,t1,t2,...]\n\t\t\t\t    var node = tlist[0];\n\t\t\t\t    var values = results[node];\n\t\t\t\t    var tvlist = [];\n\t\t\t\t    // for each requested time, interpolate waveform value\n\t\t\t\t    for (var k = 1; k < tlist.length; k++) {\n\t\t\t\t\tvar t = tlist[k];\n\t\t\t\t\tvar v = interpolate(t,times,values);\n\t\t\t\t\ttvlist.push([t,v == undefined ? 'undefined' : v]);\n\t\t\t\t    }\n\t\t\t\t    // save results as list of [t,value] pairs\n\t\t\t\t    sch.transient_results[node] = tvlist;\n\t\t\t\t}\n\t\t\t    }\n\t\t\t}\n\n\t\t\tvar x_values = results['_time_'];\n\t\t\tvar x_legend = 'Time';\n\n\t\t\t// set up plot values for each node with a probe\n\t\t\tvar v_values = [];  // voltage values: list of [color, result_array]\n\t\t\tvar i_values = [];  // current values: list of [color, result_array]\n\t\t\tvar probes = sch.find_probes();\n\n\t\t\tfor (var i = probes.length - 1; i >= 0; --i) {\n\t\t\t    var color = probes[i][0];\n\t\t\t    var label = probes[i][1];\n\t\t\t    var offset = cktsim.parse_number(probes[i][2]);\n\t\t\t    var v = results[label];\n\t\t\t    if (v == undefined) {\n\t\t\t\talert('The ' + color + ' probe is connected to node ' + '\"' + label + '\"' + ' which is not an actual circuit node');\n\t\t\t    } else if (probes[i][3] == 'voltage') {\n\t\t\t\tif (color == 'x-axis') {\n\t\t\t\t    x_values = v;\n\t\t\t\t    x_legend = 'Voltage';\n\t\t\t\t} else v_values.push([color,offset,v]);\n\t\t\t    } else {\n\t\t\t\tif (color == 'x-axis') {\n\t\t\t\t    x_values = v;\n\t\t\t\t    x_legend = 'Current';\n\t\t\t\t} else i_values.push([color,offset,v]);\n\t\t\t    }\n\t\t\t}\n\n\t\t\t// graph the result and display in a window\n\t\t\tvar graph = sch.graph(x_values,x_legend,v_values,'Voltage',i_values,'Current');\n\t\t\tsch.window('Results of Transient Analysis',graph);\n\t\t    }\n\t    })\n\t}\n\n\t// t is the time at which we want a value\n\t// times is a list of timepoints from the simulation\n\tfunction interpolate(t,times,values) {\n\t    if (values == undefined) return undefined;\n\n\t    for (var i = 0; i < times.length; i++)\n\t\tif (t < times[i]) {\n\t\t    // t falls between times[i-1] and times[i]\n\t\t    var t1 = (i == 0) ? times[0] : times[i-1];\n\t\t    var t2 = times[i];\n\n\t\t    if (t2 == undefined) return undefined;\n\n\t\t    var v1 = (i == 0) ? values[0] : values[i-1];\n\t\t    var v2 = values[i];\n\t\t    var v = v1;\n\t\t    if (t != t1) v += (t - t1)*(v2 - v1)/(t2 - t1);\n\t\t    return v;\n\t\t}\n\t}\n\n\t// external interface for setting the property value of a named component\n\tSchematic.prototype.set_property = function(component_name,property,value) {\n\t    this.unselect_all(-1);\n\n\t    for (var i = this.components.length - 1; i >= 0; --i) {\n\t\tvar component = this.components[i];\n\t\tif (component.properties['name'] == component_name) {\n\t\t    component.properties[property] = value.toString();\n\t\t    break;\n\t\t}\n\t    }\n\n\t    this.redraw_background();\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Drawing support -- deals with scaling and scrolling of diagrama\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\t// here to redraw background image containing static portions of the schematic.\n\t// Also redraws dynamic portion.\n\tSchematic.prototype.redraw_background = function() {\n\t    var c = this.bg_image.getContext('2d');\n\n\t    c.lineCap = 'round';\n\n\t    // paint background color\n\t    c.fillStyle = element_style;\n\t    c.fillRect(0,0,this.width,this.height);\n\n\t    if (!this.diagram_only && this.show_grid) {\n\t\t// grid\n\t\tc.strokeStyle = grid_style;\n\t\tvar first_x = this.origin_x;\n\t\tvar last_x = first_x + this.width/this.scale;\n\t\tvar first_y = this.origin_y;\n\t\tvar last_y = first_y + this.height/this.scale;\n\n\t\tfor (var i = this.grid*Math.ceil(first_x/this.grid); i < last_x; i += this.grid)\n\t\t    this.draw_line(c,i,first_y,i,last_y,0.1);\n\n\t\tfor (var i = this.grid*Math.ceil(first_y/this.grid); i < last_y; i += this.grid)\n\t\t    this.draw_line(c,first_x,i,last_x,i,0.1);\n\t    }\n\n\t    // unselected components\n\t    var min_x = Infinity;  // compute bounding box for diagram\n\t    var max_x = -Infinity;\n\t    var min_y = Infinity;\n\t    var max_y = -Infinity;\n\t    for (var i = this.components.length - 1; i >= 0; --i) {\n\t\tvar component = this.components[i];\n\t\tif (!component.selected) {\n\t\t    component.draw(c);\n\t\t    min_x = Math.min(component.bbox[0],min_x);\n\t\t    max_x = Math.max(component.bbox[2],max_x);\n\t\t    min_y = Math.min(component.bbox[1],min_y);\n\t\t    max_y = Math.max(component.bbox[3],max_y);\n\t\t}\n\t    }\n\t    this.unsel_bbox = [min_x,min_y,max_x,max_y];\n\t    this.redraw();   // background changed, redraw on screen\n\t}\n\n\t// redraw what user sees = static image + dynamic parts\n\tSchematic.prototype.redraw = function() {\n\t    var c = this.canvas.getContext('2d');\n\n\t    // put static image in the background\n\t    c.drawImage(this.bg_image, 0, 0);\n\n\t    // selected components\n\t    var min_x = this.unsel_bbox[0];   // compute bounding box for diagram\n\t    var max_x = this.unsel_bbox[2];\n\t    var min_y = this.unsel_bbox[1];\n\t    var max_y = this.unsel_bbox[3];\n\t    var selections = false;\n\t    for (var i = this.components.length - 1; i >= 0; --i) {\n\t\tvar component = this.components[i];\n\t\tif (component.selected) {\n\t\t    component.draw(c);\n\t\t    selections = true;\n\t\t    min_x = Math.min(component.bbox[0],min_x);\n\t\t    max_x = Math.max(component.bbox[2],max_x);\n\t\t    min_y = Math.min(component.bbox[1],min_y);\n\t\t    max_y = Math.max(component.bbox[3],max_y);\n\t\t}\n\t    }\n\t    if (min_x == Infinity) this.bbox = [0,0,0,0];\n\t    else this.bbox = [min_x,min_y,max_x,max_y];\n\t    this.enable_tool('cut',selections);\n\t    this.enable_tool('copy',selections);\n\t    this.enable_tool('paste',sch_clipboard.length > 0);\n\n\t    // connection points: draw one at each location\n\t    for (var location in this.connection_points) {\n\t\tvar cplist = this.connection_points[location];\n\t\tcplist[0].draw(c,cplist.length);\n\t    }\n\n\t    // draw new wire\n\t    if (this.wire) {\n\t\tvar r = this.wire;\n\t\tc.strokeStyle = selected_style;\n\t\tthis.draw_line(c,r[0],r[1],r[2],r[3],1);\n\t    }\n\n\t    // draw selection rectangle\n\t    if (this.select_rect) {\n\t\tvar r = this.select_rect;\n\t\tc.lineWidth = 1;\n\t\tc.strokeStyle = selected_style;\n\t\tc.beginPath();\n\t\tc.moveTo(r[0],r[1]);\n\t\tc.lineTo(r[0],r[3]);\n\t\tc.lineTo(r[2],r[3]);\n\t\tc.lineTo(r[2],r[1]);\n\t\tc.lineTo(r[0],r[1]);\n\t\tc.stroke();\n\t    }\n\n\t    // display operating point results\n\t    if (this.operating_point) {\n\t\tif (typeof this.operating_point == 'string')\n\t\t    this.message(this.operating_point);\n\t\telse {\n\t\t    // make a copy of the operating_point info so we can mess with it\n            var temp = [];\n\t\t    for (var i in this.operating_point) temp[i] = this.operating_point[i];\n\n\t\t    // run through connection points displaying (once) the voltage\n\t\t    // for each electrical node\n\t\t    for (var location in this.connection_points)\n\t\t\t(this.connection_points[location])[0].display_voltage(c,temp);\n\n\t\t    // let components display branch current info if available\n\t\t    for (var i = this.components.length - 1; i >= 0; --i)\n\t\t\tthis.components[i].display_current(c,temp)\n\t\t}\n\t    }\n\n\t    // add scrolling/zooming control\n\t    if (!this.diagram_only) {\n\t\tvar r = this.sctl_r;\n\t\tvar x = this.sctl_x;\n\t\tvar y = this.sctl_y;\n\n\t\t// circle with border\n\t\tc.fillStyle = element_style;\n\t\tc.beginPath();\n\t\tc.arc(x,y,r,0,2*Math.PI);\n\t\tc.fill();\n\n\t\tc.strokeStyle = grid_style;\n\t\tc.lineWidth = 0.5;\n\t\tc.beginPath();\n\t\tc.arc(x,y,r,0,2*Math.PI);\n\t\tc.stroke();\n\n\t\t// direction markers for scroll\n\t\tc.lineWidth = 3;\n\t\tc.beginPath();\n\n\t\tc.moveTo(x + 4,y - r + 8);   // north\n\t\tc.lineTo(x,y - r + 4);\n\t\tc.lineTo(x - 4,y - r + 8);\n\n\t\tc.moveTo(x + r - 8,y + 4);   // east\n\t\tc.lineTo(x + r - 4,y);\n\t\tc.lineTo(x + r - 8,y - 4);\n\n\t\tc.moveTo(x + 4,y + r - 8);   // south\n\t\tc.lineTo(x,y + r - 4);\n\t\tc.lineTo(x - 4,y + r - 8);\n\n\t\tc.moveTo(x - r + 8,y + 4);   // west\n\t\tc.lineTo(x - r + 4,y);\n\t\tc.lineTo(x - r + 8,y - 4);\n\n\t\tc.stroke();\n\n\t\t// zoom control\n\t\tx = this.zctl_left;\n\t\ty = this.zctl_top;\n\t\tc.lineWidth = 0.5;\n\t\tc.fillStyle = element_style;    // background\n\t\tc.fillRect(x,y,16,48);\n\t\tc.strokeStyle = grid_style;     // border\n\t\tc.strokeRect(x,y,16,48);\n\t\tc.lineWidth = 1.0;\n\t\tc.beginPath();\n\t\t// zoom in label\n\t\tc.moveTo(x+4,y+8); c.lineTo(x+12,y+8); c.moveTo(x+8,y+4); c.lineTo(x+8,y+12);\n\t\t// zoom out label\n\t\tc.moveTo(x+4,y+24); c.lineTo(x+12,y+24);\n\t\t// surround label\n\t\tc.strokeRect(x+4,y+36,8,8);\n\t\tc.stroke();\n\t    }\n\t}\n\n\t// draws a cross cursor\n\tSchematic.prototype.cross_cursor = function(c,x,y) {\n\t    this.draw_line(c,x-this.grid,y,x+this.grid,y,1);\n\t    this.draw_line(c,x,y-this.grid,x,y+this.grid,1);\n\t}\n\n\tSchematic.prototype.moveTo = function(c,x,y) {\n\t    c.moveTo((x - this.origin_x) * this.scale,(y - this.origin_y) * this.scale);\n\t}\n\n\tSchematic.prototype.lineTo = function(c,x,y) {\n\t    c.lineTo((x - this.origin_x) * this.scale,(y - this.origin_y) * this.scale);\n\t}\n\n\tSchematic.prototype.draw_line = function(c,x1,y1,x2,y2,width) {\n\t    c.lineWidth = width*this.scale;\n\t    c.beginPath();\n\t    c.moveTo((x1 - this.origin_x) * this.scale,(y1 - this.origin_y) * this.scale);\n\t    c.lineTo((x2 - this.origin_x) * this.scale,(y2 - this.origin_y) * this.scale);\n\t    c.stroke();\n\t}\n\n\tSchematic.prototype.draw_arc = function(c,x,y,radius,start_radians,end_radians,anticlockwise,width,filled) {\n\t    c.lineWidth = width*this.scale;\n\t    c.beginPath();\n\t    c.arc((x - this.origin_x)*this.scale,(y - this.origin_y)*this.scale,radius*this.scale,\n\t\t  start_radians,end_radians,anticlockwise);\n\t    if (filled) c.fill();\n\t    else c.stroke();\n\t}\n\n\tSchematic.prototype.draw_text = function(c,text,x,y,size) {\n\t    c.font = size*this.scale+'pt sans-serif'\n\t    c.fillText(text,(x - this.origin_x) * this.scale,(y - this.origin_y) * this.scale);\n\t}\n\n\t// add method to canvas to compute relative coords for event\n\ttry {\n\t\tif (HTMLCanvasElement)\n\t\t HTMLCanvasElement.prototype.relMouseCoords = function(event){\n\t\t    // run up the DOM tree to figure out coords for top,left of canvas\n\t\t    var totalOffsetX = 0;\n\t\t    var totalOffsetY = 0;\n\t\t    var currentElement = this;\n\t\t    do {\n\t\t\ttotalOffsetX += currentElement.offsetLeft;\n\t\t\ttotalOffsetY += currentElement.offsetTop;\n\t\t    }\n\t\t    while (currentElement = currentElement.offsetParent);\n\n\t\t    // now compute relative position of click within the canvas\n\t\t    this.mouse_x = event.pageX - totalOffsetX;\n\t\t    this.mouse_y = event.pageY - totalOffsetY;\n\t\t    this.page_x = event.pageX;\n\t\t    this.page_y = event.pageY;\n\t\t }\n\t}\n\tcatch (err) { // ignore\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Event handling\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\t// process keystrokes, consuming those that are meaningful to us\n\tfunction schematic_key_down(event) {\n\t    if (!event) event = window.event;\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\t    var code = event.keyCode;\n\n\t    // keep track of modifier key state\n\t    if (code == 16) sch.shiftKey = true;\n\t    else if (code == 17) sch.ctrlKey = true;\n\t    else if (code == 18) sch.altKey = true;\n\t    else if (code == 91) sch.cmdKey = true;\n\n\t    // backspace or delete: delete selected components\n\t    else if (code == 8 || code == 46) {\n\t\t// delete selected components\n\t\tfor (var i = sch.components.length - 1; i >= 0; --i) {\n\t\t    var component = sch.components[i];\n\t\t    if (component.selected) component.remove();\n\t\t}\n\t\tsch.clean_up_wires();\n\t\tsch.redraw_background();\n\t\tevent.preventDefault();\n\t\treturn false;\n\t    }\n\n\t    // cmd/ctrl x: cut\n\t    else if ((sch.ctrlKey || sch.cmdKey) && code == 88) {\n\t\tsch.cut();\n\t\tevent.preventDefault();\n\t\treturn false;\n\t    }\n\n\t    // cmd/ctrl c: copy\n\t    else if ((sch.ctrlKey || sch.cmdKey) && code == 67) {\n\t\tsch.copy();\n\t\tevent.preventDefault();\n\t\treturn false;\n\t    }\n\n\t    // cmd/ctrl v: paste\n\t    else if ((sch.ctrlKey || sch.cmdKey) && code == 86) {\n\t\tsch.paste();\n\t\tevent.preventDefault();\n\t\treturn false;\n\t    }\n\n\t    // 'r': rotate component\n\t    else if (!sch.ctrlKey && !sch.altKey && !sch.cmdKey && code == 82) {\n\t\t// rotate\n\t\tfor (var i = sch.components.length - 1; i >= 0; --i) {\n\t\t    var component = sch.components[i];\n\t\t    if (component.selected) {\n\t\t\tcomponent.rotate(1);\n\t\t\tsch.check_wires(component);\n\t\t    }\n\t\t}\n\t\tsch.clean_up_wires();\n\t\tsch.redraw_background();\n\t\tevent.preventDefault();\n\t\treturn false;\n\t    }\n\n\t    else return true;\n\n\t    // consume keystroke\n\t    sch.redraw();\n\t    event.preventDefault();\n\t    return false;\n\t}\n\n\tfunction schematic_key_up(event) {\n\t    if (!event) event = window.event;\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\t    var code = event.keyCode;\n\n\t    if (code == 16) sch.shiftKey = false;\n\t    else if (code == 17) sch.ctrlKey = false;\n\t    else if (code == 18) sch.altKey = false;\n\t    else if (code == 91) sch.cmdKey = false;\n\t}\n\n\tfunction schematic_mouse_enter(event) {\n\t    if (!event) event = window.event;\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\n\t    // see if user has selected a new part\n\t    if (sch.new_part) {\n\t\t// grab incoming part, turn off selection of parts bin\n\t\tvar part = sch.new_part;\n\t\tsch.new_part = undefined;\n\t\tpart.select(false);\n\n\t\t// unselect everything else in the schematic, add part and select it\n\t\tsch.unselect_all(-1);\n\t\tsch.redraw_background();  // so we see any components that got unselected\n\n\t\t// make a clone of the component in the parts bin\n\t\tpart = part.component.clone(sch.cursor_x,sch.cursor_y);\n\t\tpart.add(sch);  // add it to schematic\n\t\tpart.set_select(true);\n\n\t\t// and start dragging it\n\t\tsch.drag_begin();\n\t    }\n\n\t    sch.drawCursor = true;\n\t    sch.redraw();\n\t    sch.canvas.focus();  // capture key strokes\n\t    return false;\n\t}\n\n\tfunction schematic_mouse_leave(event) {\n\t    if (!event) event = window.event;\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\t    sch.drawCursor = false;\n\t    sch.redraw();\n\t    return false;\n\t}\n\n\tfunction schematic_mouse_down(event) {\n\t    if (!event) event = window.event;\n\t    else event.preventDefault();\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\n\t    // determine where event happened in schematic coordinates\n\t    sch.canvas.relMouseCoords(event);\n\n\t    var mx = sch.canvas.mouse_x;\n\t    var my = sch.canvas.mouse_y;\n\t    var sx = mx - sch.sctl_x;\n\t    var sy = my - sch.sctl_y;\n\t    var zx = mx - sch.zctl_left;\n\t    var zy = my - sch.zctl_top;\n\t    if (sx*sx + sy*sy <= sch.sctl_r*sch.sctl_r) {   // click in scrolling control\n\t\t// click on scrolling control, check which quadrant\n\t\tif (Math.abs(sy) > Math.abs(sx)) {   // N or S\n\t\t    var delta = this.height / 8;\n\t\t    if (sy > 0) delta = -delta;\n\t\t    var temp = sch.origin_y - delta;\n\t\t    if (temp > origin_min*sch.grid && temp < origin_max*sch.grid) sch.origin_y = temp;\n\t\t} else {\t\t\t    // E or W\n\t\t    var delta = this.width / 8;\n\t\t    if (sx < 0) delta = -delta;\n\t\t    var temp = sch.origin_x + delta;\n\t\t    if (temp > origin_min*sch.grid && temp < origin_max*sch.grid) sch.origin_x = temp;\n\t\t}\n\t    } else if (zx >= 0 && zx < 16 && zy >= 0 && zy < 48) {   // click in zoom control\n\t\tif (zy < 16) sch.zoomin();\n\t\telse if (zy < 32) sch.zoomout();\n\t\telse sch.zoomall();\n\t    } else {\n\t\tvar x = mx/sch.scale + sch.origin_x;\n\t\tvar y = my/sch.scale + sch.origin_y;\n\t\tsch.cursor_x = Math.round(x/sch.grid) * sch.grid;\n\t\tsch.cursor_y = Math.round(y/sch.grid) * sch.grid;\n\n\t\t// is mouse over a connection point?  If so, start dragging a wire\n\t\tvar cplist = sch.connection_points[sch.cursor_x + ',' + sch.cursor_y];\n\t\tif (cplist && !event.shiftKey) {\n\t\t    sch.unselect_all(-1);\n\t\t    sch.wire = [sch.cursor_x,sch.cursor_y,sch.cursor_x,sch.cursor_y];\n\t\t} else {\n\t\t    // give all components a shot at processing the selection event\n\t\t    var which = -1;\n\t\t    for (var i = sch.components.length - 1; i >= 0; --i)\n\t\t\tif (sch.components[i].select(x,y,event.shiftKey)) {\n\t\t\t    if (sch.components[i].selected) {\n\t\t\t\tsch.drag_begin();\n\t\t\t\twhich = i;  // keep track of component we found\n\t\t\t    }\n\t\t\t    break;\n\t\t\t}\n\t\t    // did we just click on a previously selected component?\n\t\t    var reselect = which!=-1 && sch.components[which].was_previously_selected;\n\n\t\t    if (!event.shiftKey) {\n\t\t\t// if shift key isn't pressed and we didn't click on component\n\t\t\t// that was already selected, unselect everyone except component\n\t\t\t// we just clicked on\n\t\t\tif (!reselect) sch.unselect_all(which);\n\n\t\t\t// if there's nothing to drag, set up a selection rectangle\n\t\t\tif (!sch.dragging) sch.select_rect = [sch.canvas.mouse_x,sch.canvas.mouse_y,\n\t\t\t\t\t\t\t      sch.canvas.mouse_x,sch.canvas.mouse_y];\n\t\t    }\n\t\t}\n\t    }\n\n\t    sch.redraw_background();\n\t    return false;\n\t}\n\n\tfunction schematic_mouse_move(event) {\n\t    if (!event) event = window.event;\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\n\t    sch.canvas.relMouseCoords(event);\n\t    var x = sch.canvas.mouse_x/sch.scale + sch.origin_x;\n\t    var y = sch.canvas.mouse_y/sch.scale + sch.origin_y;\n\t    sch.cursor_x = Math.round(x/sch.grid) * sch.grid;\n\t    sch.cursor_y = Math.round(y/sch.grid) * sch.grid;\n\n\t    if (sch.wire) {\n\t\t// update new wire end point\n\t\tsch.wire[2] = sch.cursor_x;\n\t\tsch.wire[3] = sch.cursor_y;\n\t    } else if (sch.dragging) {\n\t\t// see how far we moved\n\t\tvar dx = sch.cursor_x - sch.drag_x;\n\t\tvar dy = sch.cursor_y - sch.drag_y;\n\t\tif (dx != 0 || dy != 0) {\n\t\t    // update position for next time\n\t\t    sch.drag_x = sch.cursor_x;\n\t\t    sch.drag_y = sch.cursor_y;\n\n\t\t    // give all components a shot at processing the event\n\t\t    for (var i = sch.components.length - 1; i >= 0; --i) {\n\t\t\tvar component = sch.components[i];\n\t\t\tif (component.selected) component.move(dx,dy);\n\t\t    }\n\t\t}\n\t    } else if (sch.select_rect) {\n\t\t// update moving corner of selection rectangle\n\t\tsch.select_rect[2] = sch.canvas.mouse_x;\n\t\tsch.select_rect[3] = sch.canvas.mouse_y;\n\t    }\n\n\t    // just redraw dynamic components\n\t    sch.redraw();\n\n\t    return false;\n\t}\n\n\tfunction schematic_mouse_up(event) {\n\t    if (!event) event = window.event;\n\t    else event.preventDefault();\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\n\t    // drawing a new wire\n\t    if (sch.wire) {\n\t\tvar r = sch.wire;\n\t\tsch.wire = undefined;\n\n\t\tif (r[0]!=r[2] || r[1]!=r[3]) {\n\t\t    // insert wire component\n\t\t    sch.add_wire(r[0],r[1],r[2],r[3]);\n\t\t    sch.clean_up_wires();\n\t\t    sch.redraw_background();\n\t\t} else sch.redraw();\n\t    }\n\n\t    // dragging\n\t    if (sch.dragging) sch.drag_end();\n\n\t    // selection rectangle\n\t    if (sch.select_rect) {\n\t\tvar r = sch.select_rect;\n\n\t\t// if select_rect is a point, we've already dealt with selection\n\t\t// in mouse_down handler\n\t\tif (r[0]!=r[2] || r[1]!=r[3]) {\n\t\t    // convert to schematic coordinates\n\t\t    var s = [r[0]/sch.scale + sch.origin_x, r[1]/sch.scale + sch.origin_y,\n\t\t\t     r[2]/sch.scale + sch.origin_x, r[3]/sch.scale + sch.origin_y];\n\t\t    canonicalize(s);\n\n\t\t    if (!event.shiftKey) sch.unselect_all();\n\n\t\t    // select components that intersect selection rectangle\n\t\t    for (var i = sch.components.length - 1; i >= 0; --i)\n\t\t\tsch.components[i].select_rect(s,event.shiftKey);\n\t\t}\n\n\t\tsch.select_rect = undefined;\n\t\tsch.redraw_background();\n\t    }\n\t    return false;\n\t}\n\n\tfunction schematic_mouse_wheel(event) {\n\t    if (!event) event = window.event;\n\t    else event.preventDefault();\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\n\t    var delta = 0;\n\t    if (event.wheelDelta) delta = event.wheelDelta;\n\t    else if (event.detail) delta = -event.detail;\n\n\t    if (delta) {\n\t\tvar nscale = (delta > 0) ? sch.scale*zoom_factor : sch.scale/zoom_factor;\n\n\t\tif (nscale > zoom_min && nscale < zoom_max) {\n\t\t    // zoom around current mouse position\n\t\t    sch.canvas.relMouseCoords(event);\n\t\t    var s = 1.0/sch.scale - 1.0/nscale;\n\t\t    sch.origin_x += sch.canvas.mouse_x*s;\n\t\t    sch.origin_y += sch.canvas.mouse_y*s;\n\t\t    sch.scale = nscale;\n\t\t    sch.redraw_background();\n\t\t}\n\t    }\n\t}\n\n\tfunction schematic_double_click(event) {\n\t    if (!event) event = window.event;\n\t    else event.preventDefault();\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\n\t    // determine where event happened in schematic coordinates\n\t    sch.canvas.relMouseCoords(event);\n\t    var x = sch.canvas.mouse_x/sch.scale + sch.origin_x;\n\t    var y = sch.canvas.mouse_y/sch.scale + sch.origin_y;\n\t    sch.cursor_x = Math.round(x/sch.grid) * sch.grid;\n\t    sch.cursor_y = Math.round(y/sch.grid) * sch.grid;\n\n\t    // see if we double-clicked a component.  If so, edit it's properties\n\t    for (var i = sch.components.length - 1; i >= 0; --i)\n\t\tif (sch.components[i].edit_properties(x,y))\n\t\t    break;\n\n\t    return false;\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Status message and dialogs\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tSchematic.prototype.message = function(message) {\n\t    this.status.nodeValue = message;\n\t}\n\n\tSchematic.prototype.append_message = function(message) {\n\t    this.status.nodeValue += ' / '+message;\n\t}\n\n\t// set up a dialog with specified title, content and two buttons at\n\t// the bottom: OK and Cancel.  If Cancel is clicked, dialog goes away\n\t// and we're done.  If OK is clicked, dialog goes away and the\n\t// callback function is called with the content as an argument (so\n\t// that the values of any fields can be captured).\n\tSchematic.prototype.dialog = function(title,content,callback) {\n\t    // create the div for the top level of the dialog, add to DOM\n\t    var dialog = document.createElement('div');\n\t    dialog.sch = this;\n\t    dialog.content = content;\n\t    dialog.callback = callback;\n\n\t    // look for property input fields in the content and give\n\t    // them a keypress listener that interprets ENTER as\n\t    // clicking OK.\n\t    var plist = content.getElementsByClassName('property');\n\t    for (var i = plist.length - 1; i >= 0; --i) {\n\t\tvar field = plist[i];\n\t\tfield.dialog = dialog;  // help event handler find us...\n\t\tfield.addEventListener('keypress',dialog_check_for_ENTER,false);\n\t    }\n\n\t    // div to hold the content\n\t    var body = document.createElement('div');\n\t    content.style.marginBotton = '5px';\n\t    body.appendChild(content);\n\t    body.style.padding = '5px';\n\t    dialog.appendChild(body);\n\n\t    var ok_button = document.createElement('span');\n\t    ok_button.appendChild(document.createTextNode('OK'));\n\t    ok_button.dialog = dialog;   // for the handler to use\n\t    ok_button.addEventListener('click',dialog_okay,false);\n\t    ok_button.style.display = 'inline';\n\t    ok_button.style.border = '1px solid';\n\t    ok_button.style.padding = '5px';\n\t    ok_button.style.margin = '10px';\n\n\t    var cancel_button = document.createElement('span');\n\t    cancel_button.appendChild(document.createTextNode('Cancel'));\n\t    cancel_button.dialog = dialog;   // for the handler to use\n\t    cancel_button.addEventListener('click',dialog_cancel,false);\n\t    cancel_button.style.display = 'inline';\n\t    cancel_button.style.border = '1px solid';\n\t    cancel_button.style.padding = '5px';\n\t    cancel_button.style.margin = '10px';\n\n\t    // div to hold the two buttons\n\t    var buttons = document.createElement('div');\n\t    buttons.style.textAlign = 'center';\n\t    buttons.appendChild(ok_button);\n\t    buttons.appendChild(cancel_button);\n\t    buttons.style.padding = '5px';\n\t    buttons.style.margin = '10px';\n\t    dialog.appendChild(buttons);\n\n\t    // put into an overlay window\n\t    this.window(title,dialog);\n\t}\n\n\tfunction dialog_cancel(event) {\n\t    if (!event) event = window.event;\n\t    var dialog = (window.event) ? event.srcElement.dialog : event.target.dialog;\n\n\t    window_close(dialog.win);\n\t}\n\n\tfunction dialog_okay(event) {\n\t    if (!event) event = window.event;\n\t    var dialog = (window.event) ? event.srcElement.dialog : event.target.dialog;\n\n\t    window_close(dialog.win);\n\n\t    if (dialog.callback) dialog.callback(dialog.content);\n\t}\n\n\t// callback for keypress in input fields: if user typed ENTER, act\n\t// like they clicked OK button.\n\tfunction dialog_check_for_ENTER(event) {\n\t    var key = (window.event) ? window.event.keyCode : event.keyCode;\n\t    if (key == 13) dialog_okay(event);\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Draggable, resizeable, closeable window\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\t// build a 2-column HTML table from an associative array (keys as text in\n\t// column 1, values in column 2).\n\tfunction build_table(a) {\n\t    var tbl = document.createElement('table');\n\n\t    // build a row for each element in associative array\n\t    for (var i in a) {\n\t\tvar label = document.createTextNode(i + ': ');\n\t\tvar col1 = document.createElement('td');\n\t\tcol1.appendChild(label);\n\t\tvar col2 = document.createElement('td');\n\t\tcol2.appendChild(a[i]);\n\t\tvar row = document.createElement('tr');\n\t\trow.appendChild(col1);\n\t\trow.appendChild(col2);\n\t\trow.style.verticalAlign = 'center';\n\t\ttbl.appendChild(row);\n\t    }\n\n\t    return tbl;\n\t}\n\n\tfunction build_input(type,size,value) {\n\t    var input = document.createElement('input');\n\t    input.type = type;\n\t    input.size = size;\n\t    input.className = 'property';  // make this easier to find later\n\t    if (value == undefined) input.value = '';\n\t    else input.value = value.toString();\n\t    return input;\n\t}\n\n\t// build a select widget using the strings found in the options array\n\tfunction build_select(options,selected) {\n\t    var select = document.createElement('select');\n\t    for (var i = 0; i < options.length; i++) {\n\t\tvar option = document.createElement('option');\n\t\toption.text = options[i];\n\t\tselect.add(option);\n\t\tif (options[i] == selected) select.selectedIndex = i;\n\t    }\n\t    return select;\n\t}\n\n\tSchematic.prototype.window = function(title,content,offset) {\n\t    // create the div for the top level of the window\n\t    var win = document.createElement('div');\n\t    win.sch = this;\n\t    win.content = content;\n\t    win.drag_x = undefined;\n\t    win.draw_y = undefined;\n\n\t    // div to hold the title\n\t    var head = document.createElement('div');\n\t    head.style.backgroundColor = 'black';\n\t    head.style.color = 'white';\n\t    head.style.textAlign = 'center';\n\t    head.style.padding = '5px';\n\t    head.appendChild(document.createTextNode(title));\n\t    head.win = win;\n\t    win.head = head;\n\n\t    var close_button = new Image();\n\t    close_button.src = close_icon;\n\t    close_button.style.cssFloat = 'right';\n\t    close_button.addEventListener('click',window_close_button,false);\n\t    close_button.win = win;\n\t    head.appendChild(close_button);\n\n\t    win.appendChild(head);\n\n\t    // capture mouse events in title bar\n\t    head.addEventListener('mousedown',window_mouse_down,false);\n\n\t    // div to hold the content\n\t    //var body = document.createElement('div');\n\t    //body.appendChild(content);\n\t    win.appendChild(content);\n\t    content.win = win;   // so content can contact us\n\n\t    // compute location relative to canvas\n\t    if (offset == undefined) offset = 0;\n\t    win.left = this.canvas.mouse_x + offset;\n\t    win.top = this.canvas.mouse_y + offset;\n\n\t    // add to DOM\n\t    win.style.background = 'white';\n\t    win.style.position = 'absolute';\n\t    win.style.left = win.left + 'px';\n\t    win.style.top = win.top + 'px';\n\t    win.style.border = '2px solid';\n\n\t    this.canvas.parentNode.insertBefore(win,this.canvas);\n\t    bring_to_front(win,true);\n\t}\n\n\t// adjust zIndex of pop-up window so that it is in front\n\tfunction bring_to_front(win,insert) {\n\t    var wlist = win.sch.window_list;\n\t    var i = wlist.indexOf(win);\n\n\t    // remove from current position (if any) in window list\n\t    if (i != -1) wlist.splice(i,1);\n\n\t    // if requested, add to end of window list\n\t    if (insert) wlist.push(win);\n\n\t    // adjust all zIndex values\n\t    for (i = 0; i < wlist.length; i += 1)\n\t\twlist[i].style.zIndex = 1000 + i;\n\t}\n\n\t// close the window\n\tfunction window_close(win) {\n\t    // remove the window from the top-level div of the schematic\n\t    win.parentNode.removeChild(win);\n\n\t    // remove from list of pop-up windows\n\t    bring_to_front(win,false);\n\t}\n\n\tfunction window_close_button(event) {\n\t    if (!event) event = window.event;\n\t    var src = (window.event) ? event.srcElement : event.target;\n\t    window_close(src.win);\n\t}\n\n\t// capture mouse events in title bar of window\n\tfunction window_mouse_down(event) {\n\t    if (!event) event = window.event;\n\t    var src = (window.event) ? event.srcElement : event.target;\n\t    var win = src.win;\n\n\t    bring_to_front(win,true);\n\n\t    // add handlers to document so we capture them no matter what\n\t    document.addEventListener('mousemove',window_mouse_move,false);\n\t    document.addEventListener('mouseup',window_mouse_up,false);\n\t    document.tracking_window = win;\n\n\t    // remember where mouse is so we can compute dx,dy during drag\n\t    win.drag_x = event.pageX;\n\t    win.drag_y = event.pageY;\n\n\t    return false;\n\t}\n\n\tfunction window_mouse_up(event) {\n\t    var win = document.tracking_window;\n\n\t    // show's over folks...\n\t    document.removeEventListener('mousemove',window_mouse_move,false);\n\t    document.removeEventListener('mouseup',window_mouse_up,false);\n\t    document.tracking_window = undefined;\n\t    win.drag_x = undefined;\n\t    win.drag_y = undefined;\n\t    return true;  // consume event\n\t}\n\n\tfunction window_mouse_move(event) {\n\t    var win = document.tracking_window;\n\n\t    if (win.drag_x) {\n\t\tvar dx = event.pageX - win.drag_x;\n\t\tvar dy = event.pageY - win.drag_y;\n\n\t\t// move the window\n\t\twin.left += dx;\n\t\twin.top += dy;\n\t\twin.style.left = win.left + 'px';\n\t\twin.style.top = win.top + 'px';\n\n\t\t// update reference point\n\t\twin.drag_x += dx;\n\t\twin.drag_y += dy;\n\n\t\treturn true;  // consume event\n\t    }\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Toolbar\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tSchematic.prototype.add_tool = function(icon,tip,callback) {\n\t    var tool, child, label, hidden;\n\n        tool = document.createElement('button');\n        child = document.createElement('img');\n        label = document.createElement('span');\n        hidden = document.createElement('span');\n\n        tool.style.backgroundImage = 'none';\n        tool.setAttribute('title', tip);\n        label.innerHTML = tip;\n        label.classList.add('sr');\n        hidden.setAttribute('aria-hidden', 'true');\n\n\t    if (icon.search('data:image') != -1) {\n            child.setAttribute('src', icon);\n            child.setAttribute('alt', '');\n            tool.appendChild(child);\n\t    } else {\n            tool.style.font = 'small-caps small sans-serif';\n            hidden.innerHTML = icon;\n            tool.appendChild(hidden);\n            tool.appendChild(label);\n\t    }\n\n\t    // decorate tool\n        tool.style.height = '32px';\n        tool.style.width = 'auto';\n        tool.style.verticalAlign = 'top';\n\n\t    // set up event processing\n\t    tool.addEventListener('mouseover',tool_enter,false);\n\t    tool.addEventListener('mouseout',tool_leave,false);\n\t    tool.addEventListener('click',tool_click,false);\n\n\t    // add to toolbar\n\t    tool.sch = this;\n\t    tool.tip = tip;\n\t    tool.callback = callback;\n\t    this.toolbar.push(tool);\n\n\t    tool.enabled = false;\n\n\t    return tool;\n\t}\n\n\tSchematic.prototype.enable_tool = function(tname,which) {\n\t    var tool = this.tools[tname];\n\n\t    if (tool != undefined) {\n        tool.removeAttribute('disabled');\n\t\ttool.enabled = which;\n\n\t\t// if disabling tool, remove border and tip\n\t\tif (!which) {\n\t\t    tool.sch.message('');\n            tool.setAttribute('disabled', 'true');\n\t\t}\n\t    }\n\t}\n\n\t// highlight tool button by turning on border, changing background\n\tfunction tool_enter(event) {\n\t    if (!event) event = window.event;\n        var tool = event.target;\n        if (event.target.tagName.toLowerCase() == 'img' || event.target.tagName.toLowerCase() == 'span') {\n            tool = event.target.parentNode;\n        }\n        if (tool.enabled) {\n\t\ttool.sch.message(tool.tip);\n\t    }\n        event.stopPropagation();\n\t}\n\n\t// unhighlight tool button by turning off border, reverting to normal background\n\tfunction tool_leave(event) {\n\t    if (!event) event = window.event;\n        var tool = event.target;\n        if (event.target.tagName.toLowerCase() == 'img' || event.target.tagName.toLowerCase() == 'span') {\n            tool = event.target.parentNode;\n        }\n\t    if (tool.enabled) {\n\t\ttool.sch.message('');\n\t    }\n        event.stopPropagation();\n\t}\n\n\t// handle click on a tool\n\tfunction tool_click(event) {\n\t    if (!event) event = window.event;\n        var tool = event.target;\n        if (event.target.tagName.toLowerCase() == 'img' || event.target.tagName.toLowerCase() == 'span') {\n            tool = event.target.parentNode;\n        }\n\t    if (tool.enabled) {\n\t\ttool.sch.canvas.relMouseCoords(event);  // so we can position pop-up window correctly\n\t\ttool.callback.call(tool.sch);\n\t    }\n        event.stopPropagation();\n\t}\n\n\tvar help_icon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABgFBMVEUARMwAZsz///8AM5kGqP+s1/8AeuARp/8AZ803qPsAXNYAdNwAZcxZuv9auf99xv8AdNoEd9uTzP8AYsgAivQTl/cAj/V9xf8Ad90AeN5PtP8AUMoAj/oRiOgprf84qfwAb9UAifAAdtwAf+UAgOYActgAk/oAie8cqP8AbtQAXtkXof8AatBNuP8AbdMAgukXcOEAXdcAlP0AhuwJmv0prv8YceGCyP8AbtUAZd8elvMAZcsAW9Ucpv8AjfM3sP8AiO4AWdNOuP8AddsPgeIAhOoAbdT///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABH5RCxAAAASHRSTlP//////////////////////////////////////////////////////////////////////////////////////////////wCc7PJgAAAAAWJLR0R/SL9x5QAAAAlwSFlzAAAASAAAAEgARslrPgAAAAl2cEFnAAAAEAAAABAAXMatwwAAAK5JREFUGNM1zwcOwjAMBVAHQ9PFbIG27L333pve/0bEBr5kyf9JkWIIKYLDK3CNcZgUiE0QFIuuu89kBIHIDy5TUOmXSknBsFxDRAXMJ4FIZOeqA41lxQVB+w/1L9RyO+B+fLwJ7q/OOUfd9FvDkQJDmyyuoLqWGtsVBq3RnAHcUlXbNgSEWPY8n570dH2F6h94Sqe3BAdd7xKEKKVTACg4UuL3OMQoB/F3LRGF1w/Arhm2Q9w2ZQAAACV0RVh0Y3JlYXRlLWRhdGUAMjAwOC0xMC0yM1QxMTo1ODozNiswODowMKkTWd4AAAAldEVYdG1vZGlmeS1kYXRlADIwMDgtMTAtMjNUMTE6NTk6NTArMDg6MDC833hpAAAAAElFTkSuQmCC';\n\n\tvar cut_icon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH1QocFh0xaEFkXgAAArRJREFUOMuFk11Ik1EYx59z3nevr9vUfaXbbPgVaHjRVRB0YZRJV0XeZCIRaGmWWKhpgZAElaV9gYgQlBjoEPRKkCS6DAK1MG0zNvJj7zZ1m+51X+92zttNzmFa5+78/w8//s/znIMg5TzrfXIOAN7zPO9tunm7dI/Xz7LspTvNrbpUHadeGIYZu9XYrI1Go8t9/a87Uz0Fq7hw5nS55sWrnk8HAggh/E+HHdfV1lcQQo7t6E97HpeZc82m7ZCIKKUnDgRgjENLS7+AT0tDsVisdCcFy7JThYWF4HF7KKXU8a8EFTabDVZdK6iutr44kUic6nnePVBSUqJAgMHhdAAAWA8E3G299xljvLy4aAc+jUeSJB3X6/TXZAqwvrFGAWCiraXj4YEAAABKaeXCjwV5bc0DjTeaVPFEHIliEObm5iQA6Npb/xegraVjGmM8ZF+00WBwC2s0GhDcgizL8ru2lo7p/wL+pJianZnGTqcD0jkeMt8ORhBCb/arRXuFMaOxl1B6Pb65qSblZTIz+REVGHNAIHQLITRQ6fG07wsYM5k6437/g6MmEyQoRd6tTdkX3h5mZVRVkJ3D8BxHJVkG5/o6KLKyrla63UPJFsbN5hrJ5+sqNhrpwsrKVDASlgJBEdfEaU2UIzqWwTQQEhOO1dUPR/R6EvP5BsfN5t2XOmowCPNFRWSEYe4DAMxYLCGrUpnY8UcYhnzJNQcBAIYxbv+Wn09GDQZhd4ixmF6SJFJFyKMJleqlgmV5hLE9OWmOm1Hz6arJjIy+y5R2gyxTIMSwC+A4Qa1UMl/z8mImna5pXhC8iszMK8mPpNU2fHe5Ng4fOtQwa7HECKUYMA4AADAAANVarc/l95/0SxIbAJA5tfrsRUFI7twqiu7q7GyPNxDI8YfDGl8k4lOoVOetouj+DaDzOgfcNME8AAAAAElFTkSuQmCC';\n\n\tvar copy_icon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsSAAALEgHS3X78AAAAd0lEQVQ4y9WTsQ7AIAhE7wj//69dHKWLJqSlFOtUFpXA8SAIbBrHaR9yAAA6L2bvGiRvPtltQa+OqMrFPCo1jFhoRytBmXgqUCH5GUEkWCbova8TeBORfBNJVpYIrbVJdwDjY5hjJfk4vFnAzMDxiEqmo/fJAHACspMyA7UYnWgAAAAASUVORK5CYII=';\n\n\tvar paste_icon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsSAAALEgHS3X78AAABZElEQVQ4y6WSMUsDMRiGn6RteoJSENS5oCdFR3+D0MHBciA4uujiVrq0o1NBcBEEFycXRzcnf4GDINTiL7BTr9LeJdfGoaX0ei21+MFHAsn7fG9eAjOqXCwoz/NKgAWs53mlcrGgZt0VE3s7fdhsfgHguttztTHA5+0ZjUaDzdM7HEeRy60C0G7/EASa78cLXNelcPkw1qYnkVprfN/n+6aEUgqlFFJKjDForclms2itYzZigH6/Tz6fp9PpAFC8fp3h/J2rw42P2ksLADkNMMbgOA6O4wzfZW2sAWovrb3janUn4cAYgzGGRWWtRQjRPKpUdmOAKIrGgCiK5gKEGGb/XK9/JhwEQUC32yUMw7nTJ0ExQK/Xw/d9BoPBeMqiigHCMEQIQSqV+pM4AbCAXEKcAGAtKSn/AYCE/UVZpIEVYA1ASkkmkxl/mqfzg5ExG1tP7t8AtoAOwDqwP4pgmd4H1n8B+QWeF/d+HLAAAAAASUVORK5CYII=';\n\n\tvar close_icon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACOUlEQVR42m2TzWtTQRTF30ysxE9E0VZKaapBa1OJxtRAW7XVGOrCKijFIEqXbgQFwf/BTReia7GUuBEUF5Y2YiMKKn6iKEqRom1DtAsjStGaGX9v3iQ+Y4Z35t6ZOfe8uXdmhFPVDqRSktYvpBzAxphaBQpKqSdalTLYO7fHxnWZL/zBfclkWAbksBBip7cmHEGvDd3raFlVUoOj2Wz+H4H9vT0RGQhMMLHGkxaienduuJV6p0ql5PjdiRlD2rurO0jwM9zWWnG1dPhyWql9ht3T1XmKwEtAaLNVMUT3AFyBsAz7g9lBbBc4+zcb54joTnQIKeRDZjrcvyNQxG9A5Bd2NwIZ+Gn8e2AxmHNFbTbXRWc8FoRcJLjObtDtbjB3DLtALZbws3l8d/0aOOzLZlYktkfX4eS9epuiehlqZ+TRi5cny8zEtuhVVo/7eabW8a2RFdivwlbPbu079uDT129yZYEd7W17oNzCXe4rdFHE2lrd0SRosbX5TXAK5EAd5NPYi9gF0AtGwSIrcN9IRTeFLxB8zp7RPAExMAUxAw7h3wRpdh+SQjzHBm0KZ4xA+8aWRgivzLU16TvuLZsB8UqyjvMYNDOu98rgfEQ8UklmS6hpQCs9ghuwdShfSKF9Ezb/n5x939upT7mKwOamRogqjchlhit9R+XbhGlfeGgn3k/Pjv33mNwWXl8f4sWdJ+Yow9W+JTetYSkDQ5P5wuear7HcNjSs5Upqd60ZLAXfwPSHwpyu5v4BhpTicEl0i9QAAAAASUVORK5CYII=';\n\n\tvar grid_icon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsSAAALEgHS3X78AAAAMklEQVQ4y2NkYGD4z0ABYGFgYGD4/x/VDEZGRqLFmCixnYGBYRAYwMgwGoijgTgsAhEAq84fH/l+ELYAAAAASUVORK5CYII=';\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Graphing\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\t// add dashed lines!\n\t// from http://davidowens.wordpress.com/2010/09/07/html-5-canvas-and-dashed-lines/\n\ttry {\n\t\tif (CanvasRenderingContext2D)\n\t\t\tCanvasRenderingContext2D.prototype.dashedLineTo = function(fromX, fromY, toX, toY, pattern) {\n\t\t\t    // Our growth rate for our line can be one of the following:\n\t\t\t    //   (+,+), (+,-), (-,+), (-,-)\n\t\t\t    // Because of this, our algorithm needs to understand if the x-coord and\n\t\t\t    // y-coord should be getting smaller or larger and properly cap the values\n\t\t\t    // based on (x,y).\n\t\t\t    var lt = function (a, b) { return a <= b; };\n\t\t\t    var gt = function (a, b) { return a >= b; };\n\t\t\t    var capmin = function (a, b) { return Math.min(a, b); };\n\t\t\t    var capmax = function (a, b) { return Math.max(a, b); };\n\t\t\t    var checkX = { thereYet: gt, cap: capmin };\n\t\t\t    var checkY = { thereYet: gt, cap: capmin };\n\n\t\t\t    if (fromY - toY > 0) {\n\t\t\t\tcheckY.thereYet = lt;\n\t\t\t\tcheckY.cap = capmax;\n\t\t\t    }\n\t\t\t    if (fromX - toX > 0) {\n\t\t\t\tcheckX.thereYet = lt;\n\t\t\t\tcheckX.cap = capmax;\n\t\t\t    }\n\n\t\t\t    this.moveTo(fromX, fromY);\n\t\t\t    var offsetX = fromX;\n\t\t\t    var offsetY = fromY;\n\t\t\t    var idx = 0, dash = true;\n\t\t\t    while (!(checkX.thereYet(offsetX, toX) && checkY.thereYet(offsetY, toY))) {\n\t\t\t\tvar ang = Math.atan2(toY - fromY, toX - fromX);\n\t\t\t\tvar len = pattern[idx];\n\n\t\t\t\toffsetX = checkX.cap(toX, offsetX + (Math.cos(ang) * len));\n\t\t\t\toffsetY = checkY.cap(toY, offsetY + (Math.sin(ang) * len));\n\n\t\t\t\tif (dash) this.lineTo(offsetX, offsetY);\n\t\t\t\telse this.moveTo(offsetX, offsetY);\n\n\t\t\t\tidx = (idx + 1) % pattern.length;\n\t\t\t\tdash = !dash;\n\t\t\t    }\n\t\t\t};\n\t}\n\tcatch (err) { //noop\n\t}\n\t// given a range of values, return a new range [vmin',vmax'] where the limits\n\t// have been chosen \"nicely\".  Taken from matplotlib.ticker.LinearLocator\n\tfunction view_limits(vmin,vmax) {\n\t    // deal with degenerate case...\n\t    if (vmin == vmax) {\n\t\tif (vmin == 0) { vmin = -0.5; vmax = 0.5; }\n\t\telse {\n\t\t    vmin = vmin > 0 ? 0.9*vmin : 1.1*vmin;\n\t\t    vmax = vmax > 0 ? 1.1*vmax : 0.9*vmax;\n\t\t}\n\t    }\n\n\t    var log_range = Math.log(vmax - vmin)/Math.LN10;\n\t    var exponent = Math.floor(log_range);\n\t    //if (log_range - exponent < 0.5) exponent -= 1;\n\t    var scale = Math.pow(10,-exponent);\n\t    vmin = Math.floor(scale*vmin)/scale;\n\t    vmax = Math.ceil(scale*vmax)/scale;\n\n\t    return [vmin,vmax,1.0/scale];\n\t}\n\n\tfunction engineering_notation(n,nplaces,trim) {\n\t    if (n == 0) return '0';\n\t    if (n == undefined) return 'undefined';\n\t    if (trim == undefined) trim = true;\n\n\t    var sign = n < 0 ? -1 : 1;\n\t    var log10 = Math.log(sign*n)/Math.LN10;\n\t    var exp = Math.floor(log10/3);   // powers of 1000\n\t    var mantissa = sign*Math.pow(10,log10 - 3*exp);\n\n\t    // keep specified number of places following decimal point\n\t    var mstring = (mantissa + sign*0.5*Math.pow(10,-nplaces)).toString();\n\t    var mlen = mstring.length;\n\t    var endindex = mstring.indexOf('.');\n\t    if (endindex != -1) {\n\t\tif (nplaces > 0) {\n\t\t    endindex += nplaces + 1;\n\t\t    if (endindex > mlen) endindex = mlen;\n\t\t    if (trim) {\n\t\t\twhile (mstring.charAt(endindex-1) == '0') endindex -= 1;\n\t\t\tif (mstring.charAt(endindex-1) == '.') endindex -= 1;\n\t\t    }\n\t\t}\n\t\tif (endindex < mlen)\n\t\t    mstring = mstring.substring(0,endindex);\n\t    }\n\n\t    switch(exp) {\n\t    case -5:\treturn mstring+\"f\";\n\t    case -4:\treturn mstring+\"p\";\n\t    case -3:\treturn mstring+\"n\";\n\t    case -2:\treturn mstring+\"u\";\n\t    case -1:\treturn mstring+\"m\";\n\t    case 0:\treturn mstring;\n\t    case 1:\treturn mstring+\"K\";\n\t    case 2:\treturn mstring+\"M\";\n\t    case 3:\treturn mstring+\"G\";\n\t    }\n\n\t    // don't have a good suffix, so just print the number\n\t    return n.toString();\n\t}\n\n\tvar grid_pattern = [1,2];\n\tvar cursor_pattern = [5,5];\n\n\t// x_values is an array of x coordinates for each of the plots\n\t// y_values is an array of [color, value_array], one entry for each plot on left vertical axis\n\t// z_values is an array of [color, value_array], one entry for each plot on right vertical axis\n\tSchematic.prototype.graph = function(x_values,x_legend,y_values,y_legend,z_values,z_legend) {\n\t    var pwidth = 400;\t// dimensions of actual plot\n\t    var pheight = 300;\t// dimensions of actual plot\n\t    var left_margin = (y_values != undefined && y_values.length > 0) ? 55 : 25;\n\t    var top_margin = 25;\n\t    var right_margin = (z_values != undefined && z_values.length > 0) ? 55 : 25;\n\t    var bottom_margin = 45;\n\t    var tick_length = 5;\n\n\t    var w = pwidth + left_margin + right_margin;\n\t    var h = pheight + top_margin + bottom_margin;\n\n\t    var canvas = document.createElement('canvas');\n\t    canvas.width = w;\n\t    canvas.height = h;\n\n\t    // the graph itself will be drawn here and this image will be copied\n\t    // onto canvas, where it can be overlayed with mouse cursors, etc.\n\t    var bg_image = document.createElement('canvas');\n\t    bg_image.width = w;\n\t    bg_image.height = h;\n\t    canvas.bg_image = bg_image;\t// so we can find it during event handling\n\n\t    // start by painting an opaque background\n\t    var c = bg_image.getContext('2d');\n\t    c.fillStyle = background_style;\n\t    c.fillRect(0,0,w,h);\n\t    c.fillStyle = element_style;\n\t    c.fillRect(left_margin,top_margin,pwidth,pheight);\n\n\t    // figure out scaling for plots\n\t    var x_min = array_min(x_values);\n\t    var x_max = array_max(x_values);\n\t    var x_limits = view_limits(x_min,x_max);\n\t    x_min = x_limits[0];\n\t    x_max = x_limits[1];\n\t    var x_scale = pwidth/(x_max - x_min);\n\n\t    function plot_x(x) {\n\t\treturn (x - x_min)*x_scale + left_margin;\n\t    }\n\n\t    // draw x grid\n\t    c.strokeStyle = grid_style;\n\t    c.lineWidth = 1;\n\t    c.fillStyle = normal_style;\n\t    c.font = '10pt sans-serif';\n\t    c.textAlign = 'center';\n\t    c.textBaseline = 'top';\n\t    var end = top_margin + pheight;\n\t    for (var x = x_min; x <= x_max; x += x_limits[2]) {\n\t\tvar temp = plot_x(x) + 0.5;  // keep lines crisp!\n\n\t\t// grid line\n\t\tc.beginPath();\n\t\tif (x == x_min) {\n\t\t    c.moveTo(temp,top_margin);\n\t\t    c.lineTo(temp,end);\n\t\t} else\n\t\t    c.dashedLineTo(temp,top_margin,temp,end,grid_pattern);\n\t\tc.stroke();\n\n\t\t// tick mark\n\t\tc.beginPath();\n\t\tc.moveTo(temp,end);\n\t\tc.lineTo(temp,end + tick_length);\n\t\tc.stroke();\n\t\tc.fillText(engineering_notation(x,2),temp,end + tick_length);\n\t    }\n\n\t    if (y_values != undefined && y_values.length > 0) {\n\t\tvar y_min = Infinity;\n\t\tvar y_max = -Infinity;\n\t\tvar plot;\n\t\tfor (plot = y_values.length - 1; plot >= 0; --plot) {\n\t\t    var values = y_values[plot][2];\n\t\t    if (values == undefined) continue;  // no data points\n\t\t    var offset = y_values[plot][1];\n\t\t    var temp = array_min(values) + offset;\n\t\t    if (temp < y_min) y_min = temp;\n\t\t    temp = array_max(values) + offset;\n\t\t    if (temp > y_max) y_max = temp;\n\t\t}\n\t\tvar y_limits = view_limits(y_min,y_max);\n\t\ty_min = y_limits[0];\n\t\ty_max = y_limits[1];\n\t\tvar y_scale = pheight/(y_max - y_min);\n\n\t\tfunction plot_y(y) {\n\t\t    return (y_max - y)*y_scale + top_margin;\n\t\t}\n\n\t\t// draw y grid\n\t\tc.textAlign = 'right';\n\t\tc.textBaseline = 'middle';\n\t\tfor (var y = y_min; y <= y_max; y += y_limits[2]) {\n\t\t    if (Math.abs(y/y_max) < 0.001) y = 0.0; // Just 3 digits\n\t\t    var temp = plot_y(y) + 0.5;  // keep lines crisp!\n\n\t\t    // grid line\n\t\t    c.beginPath();\n\t\t    if (y == y_min) {\n\t\t\tc.moveTo(left_margin,temp);\n\t\t\tc.lineTo(left_margin + pwidth,temp);\n\t\t    } else\n\t\t\tc.dashedLineTo(left_margin,temp,left_margin + pwidth,temp,grid_pattern);\n\t\t    c.stroke();\n\n\t\t    // tick mark\n\t\t    c.beginPath();\n\t\t    c.moveTo(left_margin - tick_length,temp);\n\t\t    c.lineTo(left_margin,temp);\n\t\t    c.stroke();\n\t\t    c.fillText(engineering_notation(y,2),left_margin - tick_length -2,temp);\n\t\t}\n\n\t\t// now draw each plot\n\t\tvar x,y;\n\t\tvar nx,ny;\n\t\tc.lineWidth = 3;\n\t\tc.lineCap = 'round';\n\t\tfor (plot = y_values.length - 1; plot >= 0; --plot) {\n\t\t    var color = probe_colors_rgb[y_values[plot][0]];\n\t\t    if (color == undefined) continue;  // no plot color (== x-axis)\n\t\t    c.strokeStyle = color;\n\t\t    var values = y_values[plot][2];\n\t\t    if (values == undefined) continue;  // no data points\n\t\t    var offset = y_values[plot][1];\n\n\t\t    x = plot_x(x_values[0]);\n\t\t    y = plot_y(values[0] + offset);\n\t\t    c.beginPath();\n\t\t    c.moveTo(x,y);\n\t\t    for (var i = 1; i < x_values.length; i++) {\n\t\t\tnx = plot_x(x_values[i]);\n\t\t\tny = plot_y(values[i] + offset);\n\t\t\tc.lineTo(nx,ny);\n\t\t\tx = nx;\n\t\t\ty = ny;\n\t\t\tif (i % 100 == 99) {\n\t\t\t    // too many lineTo's cause canvas to break\n\t\t\t    c.stroke();\n\t\t\t    c.beginPath();\n\t\t\t    c.moveTo(x,y);\n\t\t\t}\n\t\t    }\n\t\t    c.stroke();\n\t\t}\n\t    }\n\n\t    if (z_values != undefined && z_values.length > 0) {\n\t\tvar z_min = Infinity;\n\t\tvar z_max = -Infinity;\n\t\tfor (plot = z_values.length - 1; plot >= 0; --plot) {\n\t\t    var values = z_values[plot][2];\n\t\t    if (values == undefined) continue;  // no data points\n\t\t    var offset = z_values[plot][1];\n\t\t    var temp = array_min(values) + offset;\n\t\t    if (temp < z_min) z_min = temp;\n\t\t    temp = array_max(values) + offset;\n\t\t    if (temp > z_max) z_max = temp;\n\t\t}\n\t\tvar z_limits = view_limits(z_min,z_max);\n\t\tz_min = z_limits[0];\n\t\tz_max = z_limits[1];\n\t\tvar z_scale = pheight/(z_max - z_min);\n\n\t\tfunction plot_z(z) {\n\t\t    return (z_max - z)*z_scale + top_margin;\n\t\t}\n\n\t\t// draw z ticks\n\t\tc.textAlign = 'left';\n\t\tc.textBaseline = 'middle';\n\t\tc.lineWidth = 1;\n\t\tc.strokeStyle = normal_style;\n\t\tvar tick_length_half = Math.floor(tick_length/2);\n\t\tvar tick_delta = tick_length - tick_length_half;\n\t\tfor (var z = z_min; z <= z_max; z += z_limits[2]) {\n\t\t    if (Math.abs(z/z_max) < 0.001) z = 0.0; // Just 3 digits\n\t\t    var temp = plot_z(z) + 0.5;  // keep lines crisp!\n\n\t\t    // tick mark\n\t\t    c.beginPath();\n\t\t    c.moveTo(left_margin + pwidth - tick_length_half,temp);\n\t\t    c.lineTo(left_margin + pwidth + tick_delta,temp);\n\t\t    c.stroke();\n\t\t    c.fillText(engineering_notation(z,2),left_margin + pwidth + tick_length + 2,temp);\n\t\t}\n\n\t\tvar z;\n\t\tvar nz;\n\t\tc.lineWidth = 3;\n\t\tfor (plot = z_values.length - 1; plot >= 0; --plot) {\n\t\t    var color = probe_colors_rgb[z_values[plot][0]];\n\t\t    if (color == undefined) continue;  // no plot color (== x-axis)\n\t\t    c.strokeStyle = color;\n\t\t    var values = z_values[plot][2];\n\t\t    if (values == undefined) continue;  // no data points\n\t\t    var offset = z_values[plot][1];\n\n\t\t    x = plot_x(x_values[0]);\n\t\t    z = plot_z(values[0] + offset);\n\t\t    c.beginPath();\n\t\t    c.moveTo(x,z);\n\t\t    for (var i = 1; i < x_values.length; i++) {\n\t\t\tnx = plot_x(x_values[i]);\n\t\t\tnz = plot_z(values[i] + offset);\n\t\t\tc.lineTo(nx,nz);\n\t\t\tx = nx;\n\t\t\tz = nz;\n\t\t\tif (i % 100 == 99) {\n\t\t\t    // too many lineTo's cause canvas to break\n\t\t\t    c.stroke();\n\t\t\t    c.beginPath();\n\t\t\t    c.moveTo(x,z);\n\t\t\t}\n\t\t    }\n\t\t    c.stroke();\n\t\t}\n\t    }\n\n\t    // draw legends\n\t    c.font = '12pt sans-serif';\n\t    c.textAlign = 'center';\n\t    c.textBaseline = 'bottom';\n\t    c.fillText(x_legend,left_margin + pwidth/2,h - 5);\n\n\t    if (y_values != undefined && y_values.length > 0) {\n\t\tc.textBaseline = 'top';\n\t\tc.save();\n\t\tc.translate(5 ,top_margin + pheight/2);\n\t\tc.rotate(-Math.PI/2);\n\t\tc.fillText(y_legend,0,0);\n\t\tc.restore();\n\t    }\n\n\t    if (z_values != undefined && z_values.length > 0) {\n\t\tc.textBaseline = 'bottom';\n\t\tc.save();\n\t\tc.translate(w-5 ,top_margin + pheight/2);\n\t\tc.rotate(-Math.PI/2);\n\t\tc.fillText(z_legend,0,0);\n\t\tc.restore();\n\t    }\n\n\t    // save info need for interactions with the graph\n\t    canvas.x_values = x_values;\n\t    canvas.y_values = y_values;\n\t    canvas.z_values = z_values;\n\t    canvas.x_legend = x_legend;\n\t    canvas.y_legend = y_legend;\n\t    canvas.z_legend = y_legend;\n\t    canvas.x_min = x_min;\n\t    canvas.x_scale = x_scale;\n\t    canvas.y_min = y_min;\n\t    canvas.y_scale = y_scale;\n\t    canvas.z_min = z_min;\n\t    canvas.z_scale = z_scale;\n\t    canvas.left_margin = left_margin;\n\t    canvas.top_margin = top_margin;\n\t    canvas.pwidth = pwidth;\n\t    canvas.pheight = pheight;\n\t    canvas.tick_length = tick_length;\n\n\t    canvas.cursor1_x = undefined;\n\t    canvas.cursor2_x = undefined;\n\t    canvas.sch = this;\n\n\t    // do something useful when user mouses over graph\n\t    canvas.addEventListener('mousemove',graph_mouse_move,false);\n\n\t    // return our masterpiece\n\t    redraw_plot(canvas);\n\t    return canvas;\n\t}\n\n\tfunction array_max(a) {\n        var max = -Infinity;\n\t    for (var i = a.length - 1; i >= 0; --i)\n\t\tif (a[i] > max) max = a[i];\n\t    return max;\n\t}\n\n\tfunction array_min(a) {\n        var min = Infinity;\n\t    for (var i = a.length - 1; i >= 0; --i)\n\t\tif (a[i] < min) min = a[i];\n\t    return min;\n\t}\n\n\tfunction plot_cursor(c,graph,cursor_x,left_margin) {\n\t    // draw dashed vertical marker that follows mouse\n\t    var x = graph.left_margin + cursor_x;\n\t    var end_y = graph.top_margin + graph.pheight + graph.tick_length;\n\t    c.strokeStyle = grid_style;\n\t    c.lineWidth = 1;\n\t    c.beginPath();\n\t    c.dashedLineTo(x,graph.top_margin,x,end_y,cursor_pattern);\n\t    c.stroke();\n\n\t    // add x label at bottom of marker\n\t    var graph_x = cursor_x/graph.x_scale + graph.x_min;\n\t    c.font = '10pt sans-serif';\n\t    c.textAlign = 'center';\n\t    c.textBaseline = 'top';\n\t    c.fillStyle = background_style;\n\t    c.fillText('\\u2588\\u2588\\u2588\\u2588\\u2588',x,end_y);\n\t    c.fillStyle = normal_style;\n\t    c.fillText(engineering_notation(graph_x,3,false),x,end_y);\n\n\t    // compute which points marker is between\n\t    var x_values = graph.x_values;\n\t    var len = x_values.length;\n\t    var index = 0;\n\t    while (index < len && graph_x >= x_values[index]) index += 1;\n\t    var x1 = (index == 0) ? x_values[0] : x_values[index-1];\n\t    var x2 = x_values[index];\n\n\t    if (x2 != undefined) {\n\t\t// for each plot, interpolate and output value at intersection with marker\n\t\tc.textAlign = 'left';\n\t\tvar tx = graph.left_margin + left_margin;\n\t\tvar ty = graph.top_margin;\n\t\tif (graph.y_values != undefined) {\n\t\t    for (var plot = 0; plot < graph.y_values.length; plot++) {\n\t\t\tvar values = graph.y_values[plot][2];\n\t\t\tvar color = probe_colors_rgb[graph.y_values[plot][0]];\n\t\t\tif (values == undefined || color == undefined) continue;  // no data points or x-axis\n\n\t\t\t// interpolate signal value at graph_x using values[index-1] and values[index]\n\t\t\tvar y1 = (index == 0) ? values[0] : values[index-1];\n\t\t\tvar y2 = values[index];\n\t\t\tvar y = y1;\n\t\t\tif (graph_x != x1) y += (graph_x - x1)*(y2 - y1)/(x2 - x1);\n\n\t\t\t// annotate plot with value of signal at marker\n\t\t\tc.fillStyle = element_style;\n\t\t\tc.fillText('\\u2588\\u2588\\u2588\\u2588\\u2588',tx-3,ty);\n\t\t\tc.fillStyle = color;\n\t\t\tc.fillText(engineering_notation(y,3,false),tx,ty);\n\t\t\tty += 14;\n\t\t    }\n\t\t}\n\n\t\tc.textAlign = 'right';\n\t\tif (graph.z_values != undefined) {\n\t\t    var tx = graph.left_margin + graph.pwidth - left_margin;\n\t\t    var ty = graph.top_margin;\n\t\t    for (var plot = 0; plot < graph.z_values.length; plot++) {\n\t\t\tvar values = graph.z_values[plot][2];\n\t\t\tvar color = probe_colors_rgb[graph.z_values[plot][0]];\n\t\t\tif (values == undefined || color == undefined) continue;  // no data points or x-axis\n\n\t\t\t// interpolate signal value at graph_x using values[index-1] and values[index]\n\t\t\tvar z1 = (index == 0) ? values[0]: values[index-1];\n\t\t\tvar z2 = values[index];\n\t\t\tvar z = z1;\n\t\t\tif (graph_x != x1) z += (graph_x - x1)*(z2 - z1)/(x2 - x1);\n\n\t\t\t// annotate plot with value of signal at marker\n\t\t\tc.fillStyle = element_style;\n\t\t\tc.fillText('\\u2588\\u2588\\u2588\\u2588\\u2588',tx+3,ty);\n\t\t\tc.fillStyle = color;\n\t\t\tc.fillText(engineering_notation(z,3,false),tx,ty);\n\t\t\tty += 14;\n\t\t    }\n\t\t}\n\t    }\n\t}\n\n\tfunction redraw_plot(graph) {\n\t    var c = graph.getContext('2d');\n\t    c.drawImage(graph.bg_image,0,0);\n\n\t    if (graph.cursor1_x != undefined) plot_cursor(c,graph,graph.cursor1_x,4);\n\t    if (graph.cursor2_x != undefined) plot_cursor(c,graph,graph.cursor2_x,30);\n\n\t    /*\n\t    if (graph.cursor1_x != undefined) {\n\t\t// draw dashed vertical marker that follows mouse\n\t\tvar x = graph.left_margin + graph.cursor1_x;\n\t\tvar end_y = graph.top_margin + graph.pheight + graph.tick_length;\n\t\tc.strokeStyle = grid_style;\n\t\tc.lineWidth = 1;\n\t\tc.beginPath();\n\t\tc.dashedLineTo(x,graph.top_margin,x,end_y,cursor_pattern);\n\t\tc.stroke();\n\n\t\t// add x label at bottom of marker\n\t\tvar graph_x = graph.cursor1_x/graph.x_scale + graph.x_min;\n\t\tc.font = '10pt sans-serif';\n\t\tc.textAlign = 'center';\n\t\tc.textBaseline = 'top';\n\t\tc.fillStyle = background_style;\n\t\tc.fillText('\\u2588\\u2588\\u2588\\u2588\\u2588',x,end_y);\n\t\tc.fillStyle = normal_style;\n\t\tc.fillText(engineering_notation(graph_x,3,false),x,end_y);\n\n\t\t// compute which points marker is between\n\t\tvar x_values = graph.x_values;\n\t\tvar len = x_values.length;\n\t\tvar index = 0;\n\t\twhile (index < len && graph_x >= x_values[index]) index += 1;\n\t\tvar x1 = (index == 0) ? x_values[0] : x_values[index-1];\n\t\tvar x2 = x_values[index];\n\n\t\tif (x2 != undefined) {\n\t\t    // for each plot, interpolate and output value at intersection with marker\n\t\t    c.textAlign = 'left';\n\t\t    var tx = graph.left_margin + 4;\n\t\t    var ty = graph.top_margin;\n\t\t    for (var plot = 0; plot < graph.y_values.length; plot++) {\n\t\t\tvar values = graph.y_values[plot][1];\n\n\t\t\t// interpolate signal value at graph_x using values[index-1] and values[index]\n\t\t\tvar y1 = (index == 0) ? values[0] : values[index-1];\n\t\t\tvar y2 = values[index];\n\t\t\tvar y = y1;\n\t\t\tif (graph_x != x1) y += (graph_x - x1)*(y2 - y1)/(x2 - x1);\n\n\t\t\t// annotate plot with value of signal at marker\n\t\t\tc.fillStyle = element_style;\n\t\t\tc.fillText('\\u2588\\u2588\\u2588\\u2588\\u2588',tx-3,ty);\n\t\t\tc.fillStyle = probe_colors_rgb[graph.y_values[plot][0]];\n\t\t\tc.fillText(engineering_notation(y,3,false),tx,ty);\n\t\t\tty += 14;\n\t\t    }\n\t\t}\n\t    }\n\t    */\n\t}\n\n\tfunction graph_mouse_move(event) {\n\t    if (!event) event = window.event;\n\t    var g = (window.event) ? event.srcElement : event.target;\n\n\t    g.relMouseCoords(event);\n\t    // not sure yet where the 3,-3 offset correction comes from (borders? padding?)\n\t    var gx = g.mouse_x - g.left_margin - 3;\n\t    var gy = g.pheight - (g.mouse_y - g.top_margin) + 3;\n\t    if (gx >= 0 && gx <= g.pwidth && gy >=0 && gy <= g.pheight) {\n\t\t//g.sch.message('button: '+event.button+', which: '+event.which);\n\t\tg.cursor1_x = gx;\n\t    } else {\n\t\tg.cursor1_x = undefined;\n\t\tg.cursor2_x = undefined;\n\t    }\n\n\t    redraw_plot(g);\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Parts bin\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\t// one instance will be created for each part in the parts bin\n\tfunction Part(sch) {\n\t    this.sch = sch;\n\t    this.component = undefined;\n\t    this.selected = false;\n\n\t    // set up canvas\n\t    this.canvas = document.createElement('canvas');\n\t    this.canvas.style.borderStyle = 'solid';\n\t    this.canvas.style.borderWidth = '1px';\n\t    this.canvas.style.borderColor = background_style;\n\t    //this.canvas.style.position = 'absolute';\n\t    this.canvas.style.cursor = 'default';\n\t    this.canvas.height = part_w;\n\t    this.canvas.width = part_h;\n\t    this.canvas.xpart = this;\n\n\t    this.canvas.addEventListener('mouseover',part_enter,false);\n\t    this.canvas.addEventListener('mouseout',part_leave,false);\n\t    this.canvas.addEventListener('mousedown',part_mouse_down,false);\n\t    this.canvas.addEventListener('mouseup',part_mouse_up,false);\n\n\t    // make the part \"clickable\" by registering a dummy click handler\n\t    // this should make things work on the iPad\n\t    this.canvas.addEventListener('click',function(){},false);\n\t}\n\n\tPart.prototype.set_location = function(left,top) {\n\t    this.canvas.style.left = left + 'px';\n\t    this.canvas.style.top = top + 'px';\n\t}\n\n\tPart.prototype.right = function() {\n\t    return this.canvas.offsetLeft + this.canvas.offsetWidth;\n\t}\n\n\tPart.prototype.bottom = function() {\n\t    return this.canvas.offsetTop + this.canvas.offsetHeight;\n\t}\n\n\tPart.prototype.set_component = function(component,tip) {\n\t    component.sch = this;\n\t    this.component = component;\n\t    this.tip = tip;\n\n\t    // figure out scaling and centering of parts icon\n\t    var b = component.bounding_box;\n\t    var dx = b[2] - b[0];\n\t    var dy = b[3] - b[1];\n\t    this.scale = 0.8; //Math.min(part_w/(1.2*dx),part_h/(1.2*dy));\n\t    this.origin_x = b[0] + dx/2.0 - part_w/(2.0*this.scale);\n\t    this.origin_y = b[1] + dy/2.0 - part_h/(2.0*this.scale);\n\n\t    this.redraw();\n\t}\n\n\tPart.prototype.redraw = function(part) {\n\t    var c = this.canvas.getContext('2d');\n\n\t    // paint background color\n\t    c.fillStyle = this.selected ? selected_style : background_style;\n\t    c.fillRect(0,0,part_w,part_h);\n\n\t    if (this.component) this.component.draw(c);\n\t}\n\n\tPart.prototype.select = function(which) {\n\t    this.selected = which;\n\t    this.redraw();\n\t}\n\n\tPart.prototype.update_connection_point = function(cp,old_location) {\n\t    // no connection points in the parts bin\n\t}\n\n\tPart.prototype.moveTo = function(c,x,y) {\n\t    c.moveTo((x - this.origin_x) * this.scale,(y - this.origin_y) * this.scale);\n\t}\n\n\tPart.prototype.lineTo = function(c,x,y) {\n\t    c.lineTo((x - this.origin_x) * this.scale,(y - this.origin_y) * this.scale);\n\t}\n\n\tPart.prototype.draw_line = function(c,x1,y1,x2,y2,width) {\n\t    c.lineWidth = width*this.scale;\n\t    c.beginPath();\n\t    c.moveTo((x1 - this.origin_x) * this.scale,(y1 - this.origin_y) * this.scale);\n\t    c.lineTo((x2 - this.origin_x) * this.scale,(y2 - this.origin_y) * this.scale);\n\t    c.stroke();\n\t}\n\n\tPart.prototype.draw_arc = function(c,x,y,radius,start_radians,end_radians,anticlockwise,width,filled) {\n\t    c.lineWidth = width*this.scale;\n\t    c.beginPath();\n\t    c.arc((x - this.origin_x)*this.scale,(y - this.origin_y)*this.scale,radius*this.scale,\n\t\t  start_radians,end_radians,anticlockwise);\n\t    if (filled) c.fill();\n\t    else c.stroke();\n\t}\n\n\tPart.prototype.draw_text = function(c,text,x,y,size) {\n\t    // no text displayed for the parts icon\n\t}\n\n\tfunction part_enter(event) {\n\t    if (!event) event = window.event;\n\t    var canvas = (window.event) ? event.srcElement : event.target;\n\t    var part = canvas.xpart;\n\n\t    // avoid Chrome bug that changes to text cursor whenever\n\t    // drag starts.  We'll restore the default handler at\n\t    // the appropriate point so behavior in other parts of\n\t    // the document are unaffected.\n\t    //part.sch.saved_onselectstart = document.onselectstart;\n\t    //document.onselectstart = function () { return false; };\n\n\t    canvas.style.borderColor = normal_style;\n\t    part.sch.message(part.tip+': drag onto diagram to insert');\n\t    return false;\n\t}\n\n\tfunction part_leave(event) {\n\t    if (!event) event = window.event;\n\t    var canvas = (window.event) ? event.srcElement : event.target;\n\t    var part = canvas.xpart;\n\n\t    if (typeof part.sch.new_part == 'undefined') {\n\t\t// leaving with no part selected?  revert handler\n\t\t//document.onselectstart = part.sch.saved_onselectstart;\n\t    }\n\n\t    canvas.style.borderColor = background_style;\n\t    part.sch.message('');\n\t    return false;\n\t}\n\n\tfunction part_mouse_down(event) {\n\t    if (!event) event = window.event;\n\t    var part = (window.event) ? event.srcElement.xpart : event.target.xpart;\n\n\t    part.select(true);\n\t    part.sch.new_part = part;\n\t    return false;\n\t}\n\n\tfunction part_mouse_up(event) {\n\t    if (!event) event = window.event;\n\t    var part = (window.event) ? event.srcElement.xpart : event.target.xpart;\n\n\t    part.select(false);\n\t    part.sch.new_part = undefined;\n\t    return false;\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Rectangle helper functions\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\t// rect is an array of the form [left,top,right,bottom]\n\n\t// ensure left < right, top < bottom\n\tfunction canonicalize(r) {\n\t    var temp;\n\n\t    // canonicalize bounding box\n\t    if (r[0] > r[2]) {\n\t\ttemp = r[0];\n\t\tr[0] = r[2];\n\t\tr[2] = temp;\n\t    }\n\t    if (r[1] > r[3]) {\n\t\ttemp = r[1];\n\t\tr[1] = r[3];\n\t\tr[3] = temp;\n\t    }\n\t}\n\n\tfunction between(x,x1,x2) {\n\t    return x1 <= x && x <= x2;\n\t}\n\n\tfunction inside(rect,x,y) {\n\t    return between(x,rect[0],rect[2]) && between(y,rect[1],rect[3]);\n\t}\n\n\t// only works for manhattan rectangles\n\tfunction intersect(r1,r2) {\n\t    // look for non-intersection, negate result\n\t    var result = !(r2[0] > r1[2] ||\n\t\t\t   r2[2] < r1[0] ||\n\t\t\t   r2[1] > r1[3] ||\n\t\t\t   r2[3] < r1[1]);\n\n\t    // if I try to return the above expression, javascript returns undefined!!!\n\t    return result;\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Component base class\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Component(type,x,y,rotation) {\n\t    this.sch = undefined;\n\t    this.type = type;\n\t    this.x = x;\n\t    this.y = y;\n\t    this.rotation = rotation;\n\t    this.selected = false;\n        this.properties = [];\n\t    this.bounding_box = [0,0,0,0];   // in device coords [left,top,right,bottom]\n\t    this.bbox = this.bounding_box;   // in absolute coords\n\t    this.connections = [];\n\t}\n\n\tComponent.prototype.json = function(index) {\n\t    this.properties['_json_'] = index; // remember where we are in the JSON list\n\n\t    var props = {};\n\t    for (var p in this.properties) props[p] = this.properties[p];\n\n\t    var conns = [];\n\t    for (var i = 0; i < this.connections.length; i++)\n\t\tconns.push(this.connections[i].json());\n\n\t    var json = [this.type,[this.x, this.y, this.rotation],props,conns];\n\t    return json;\n\t}\n\n\tComponent.prototype.add_connection = function(offset_x,offset_y) {\n\t    this.connections.push(new ConnectionPoint(this,offset_x,offset_y));\n\t}\n\n\tComponent.prototype.update_coords = function() {\n\t    var x = this.x;\n\t    var y = this.y;\n\n\t    // update bbox\n\t    var b = this.bounding_box;\n\t    this.bbox[0] = this.transform_x(b[0],b[1]) + x;\n\t    this.bbox[1] = this.transform_y(b[0],b[1]) + y;\n\t    this.bbox[2] = this.transform_x(b[2],b[3]) + x;\n\t    this.bbox[3] = this.transform_y(b[2],b[3]) + y;\n\t    canonicalize(this.bbox);\n\n\t    // update connections\n\t    for (var i = this.connections.length - 1; i >= 0; --i)\n\t\tthis.connections[i].update_location();\n\t}\n\n\tComponent.prototype.rotate = function(amount) {\n\t    var old_rotation = this.rotation;\n\t    this.rotation = (this.rotation + amount) % 8;\n\t    this.update_coords();\n\n\t    // create an undoable edit record here\n\t    // using old_rotation\n\t}\n\n\tComponent.prototype.move_begin = function() {\n\t    // remember where we started this move\n\t    this.move_x = this.x;\n\t    this.move_y = this.y;\n\t}\n\n\tComponent.prototype.move = function(dx,dy) {\n\t    // update coordinates\n\t    this.x += dx;\n\t    this.y += dy;\n\t    this.update_coords();\n\t}\n\n\tComponent.prototype.move_end = function() {\n\t    var dx = this.x - this.move_x;\n\t    var dy = this.y - this.move_y;\n\n\t    if (dx != 0 || dy != 0) {\n\t\t// create an undoable edit record here\n\n\t\tthis.sch.check_wires(this);\n\t    }\n\t}\n\n\tComponent.prototype.add = function(sch) {\n\t    this.sch = sch;   // we now belong to a schematic!\n\t    sch.add_component(this);\n\t    this.update_coords();\n\t}\n\n\tComponent.prototype.remove = function() {\n\t    // remove connection points from schematic\n\t    for (var i = this.connections.length - 1; i >= 0; --i) {\n\t\tvar cp = this.connections[i];\n\t\tthis.sch.remove_connection_point(cp,cp.location);\n\t    }\n\n\t    // remove component from schematic\n\t    this.sch.remove_component(this);\n\t    this.sch = undefined;\n\n\t    // create an undoable edit record here\n\t}\n\n\tComponent.prototype.transform_x = function(x,y) {\n\t    var rot = this.rotation;\n\t    if (rot == 0 || rot == 6) return x;\n\t    else if (rot == 1 || rot == 5) return -y;\n\t    else if (rot == 2 || rot == 4) return -x;\n\t    else return y;\n\t}\n\n\tComponent.prototype.transform_y = function(x,y) {\n\t    var rot = this.rotation;\n\t    if (rot == 1 || rot == 7) return x;\n\t    else if (rot == 2 || rot == 6) return -y;\n\t    else if (rot == 3 || rot == 5) return -x;\n\t    else return y;\n\t}\n\n\tComponent.prototype.moveTo = function(c,x,y) {\n\t    var nx = this.transform_x(x,y) + this.x;\n\t    var ny = this.transform_y(x,y) + this.y;\n\t    this.sch.moveTo(c,nx,ny);\n\t}\n\n\tComponent.prototype.lineTo = function(c,x,y) {\n\t    var nx = this.transform_x(x,y) + this.x;\n\t    var ny = this.transform_y(x,y) + this.y;\n\t    this.sch.lineTo(c,nx,ny);\n\t}\n\n\tComponent.prototype.draw_line = function(c,x1,y1,x2,y2) {\n\t    c.strokeStyle = this.selected ? selected_style :\n                            this.type == 'w' ? normal_style : component_style;\n\t    var nx1 = this.transform_x(x1,y1) + this.x;\n\t    var ny1 = this.transform_y(x1,y1) + this.y;\n\t    var nx2 = this.transform_x(x2,y2) + this.x;\n\t    var ny2 = this.transform_y(x2,y2) + this.y;\n\t    this.sch.draw_line(c,nx1,ny1,nx2,ny2,1);\n\t}\n\n\tComponent.prototype.draw_circle = function(c,x,y,radius,filled) {\n\t    if (filled) c.fillStyle = this.selected ? selected_style : normal_style;\n\t    else c.strokeStyle = this.selected ? selected_style :\n\t\t     this.type == 'w' ? normal_style : component_style;\n\t    var nx = this.transform_x(x,y) + this.x;\n\t    var ny = this.transform_y(x,y) + this.y;\n\n\t    this.sch.draw_arc(c,nx,ny,radius,0,2*Math.PI,false,1,filled);\n\t}\n\n    var rot_angle = [\n\t\t     0.0,\t\t// NORTH (identity)\n\t\t     Math.PI/2,\t// EAST (rot270)\n\t\t     Math.PI,\t// SOUTH (rot180)\n\t\t     3*Math.PI/2,  // WEST (rot90)\n\t\t     0.0,\t\t// RNORTH (negy)\n\t\t     Math.PI/2,\t// REAST (int-neg)\n\t\t     Math.PI,\t// RSOUTH (negx)\n\t\t     3*Math.PI/2,\t// RWEST (int-pos)\n     ];\n\n\tComponent.prototype.draw_arc = function(c,x,y,radius,start_radians,end_radians) {\n\t    c.strokeStyle = this.selected ? selected_style :\n                            this.type == 'w' ? normal_style : component_style;\n\t    var nx = this.transform_x(x,y) + this.x;\n\t    var ny = this.transform_y(x,y) + this.y;\n\t    this.sch.draw_arc(c,nx,ny,radius,\n\t\t\t      start_radians+rot_angle[this.rotation],end_radians+rot_angle[this.rotation],\n\t\t\t      false,1,false);\n\t}\n\n\tComponent.prototype.draw = function(c) {\n\t    /*\n\t    for (var i = this.connections.length - 1; i >= 0; --i) {\n\t\tvar cp = this.connections[i];\n\t\tcp.draw_x(c);\n\t    }\n\t    */\n\t}\n\n\t// result of rotating an alignment [rot*9 + align]\n    var aOrient = [\n\t\t   0, 1, 2, 3, 4, 5, 6, 7, 8,\t\t// NORTH (identity)\n\t\t   2, 5, 8, 1, 4, 7, 0, 3, 6, \t\t// EAST (rot270)\n\t\t   8, 7, 6, 5, 4, 3, 2, 1, 0,\t\t// SOUTH (rot180)\n\t\t   6, 3, 0, 7, 4, 1, 8, 5, 3,\t\t// WEST (rot90)\n\t\t   2, 1, 0, 5, 4, 3, 8, 7, 6,\t\t// RNORTH (negy)\n\t\t   8, 5, 2, 7, 4, 1, 6, 3, 0, \t\t// REAST (int-neg)\n\t\t   6, 7, 8, 3, 4, 5, 0, 1, 2,\t\t// RSOUTH (negx)\n\t\t   0, 3, 6, 1, 4, 7, 2, 5, 8\t\t// RWEST (int-pos)\n\t\t   ];\n\n    var textAlign = [\n\t\t     'left', 'center', 'right',\n\t\t     'left', 'center', 'right',\n\t\t     'left', 'center', 'right'\n\t\t     ];\n\n    var textBaseline = [\n\t\t\t'top', 'top', 'top',\n\t\t\t'middle', 'middle', 'middle',\n\t\t\t'bottom', 'bottom', 'bottom'\n\t\t\t];\n\n\tComponent.prototype.draw_text = function(c,text,x,y,alignment,size,fill) {\n\t    var a = aOrient[this.rotation*9 + alignment];\n\t    c.textAlign = textAlign[a];\n\t    c.textBaseline = textBaseline[a];\n\t    if (fill == undefined)\n\t\tc.fillStyle = this.selected ? selected_style : normal_style;\n\t    else\n\t\tc.fillStyle = fill;\n\t    this.sch.draw_text(c,text,\n\t\t\t       this.transform_x(x,y) + this.x,\n\t\t\t       this.transform_y(x,y) + this.y,\n\t\t\t       size);\n\t}\n\n\tComponent.prototype.set_select = function(which) {\n\t    if (which != this.selected) {\n\t\tthis.selected = which;\n\t\t// create an undoable edit record here\n\t    }\n\t}\n\n\tComponent.prototype.select = function(x,y,shiftKey) {\n\t    this.was_previously_selected = this.selected;\n\t    if (this.near(x,y)) {\n\t\tthis.set_select(shiftKey ? !this.selected : true);\n\t\treturn true;\n\t    } else return false;\n\t}\n\n\tComponent.prototype.select_rect = function(s) {\n\t    this.was_previously_selected = this.selected;\n\t    if (intersect(this.bbox,s))\n\t\tthis.set_select(true);\n\t}\n\n\t// if connection point of component c bisects the\n\t// wire represented by this compononent, return that\n\t// connection point.  Otherwise return null.\n\tComponent.prototype.bisect = function(c) {\n\t    return null;\n\t}\n\n\t// does mouse click fall on this component?\n\tComponent.prototype.near = function(x,y) {\n\t    return inside(this.bbox,x,y);\n\t}\n\n\tComponent.prototype.edit_properties = function(x,y) {\n\t    if (this.near(x,y)) {\n\t\t// make an <input> widget for each property\n        var fields = [];\n\t\tfor (var i in this.properties)\n\t\t    // underscore at beginning of property name => system property\n\t\t    if (i.charAt(0) != '_')\n\t\t\tfields[i] = build_input('text',10,this.properties[i]);\n\n\t\tvar content = build_table(fields);\n\t\tcontent.fields = fields;\n\t\tcontent.component = this;\n\n\t\tthis.sch.dialog('Edit Properties',content,function(content) {\n\t\t\tfor (var i in content.fields)\n\t\t\t    content.component.properties[i] = content.fields[i].value;\n\t\t\tcontent.component.sch.redraw_background();\n\t\t    });\n\t\treturn true;\n\t    } else return false;\n\t}\n\n\tComponent.prototype.clear_labels = function() {\n\t    for (var i = this.connections.length - 1; i >=0; --i) {\n\t\tthis.connections[i].clear_label();\n\t    }\n\t}\n\n\t// default action: don't propagate label\n\tComponent.prototype.propagate_label = function(label) {\n\t}\n\n\t// give components a chance to generate default labels for their connection(s)\n\t// default action: do nothing\n\tComponent.prototype.add_default_labels = function() {\n\t}\n\n\t// component should generate labels for all unlabeled connections\n\tComponent.prototype.label_connections = function() {\n\t    for (var i = this.connections.length - 1; i >=0; --i) {\n\t\tvar cp = this.connections[i];\n\t\tif (!cp.label)\n\t\t    cp.propagate_label(this.sch.get_next_label());\n\t    }\n\t}\n\n\t// default behavior: no probe info\n\tComponent.prototype.probe_info = function() { return undefined; }\n\n\t// default behavior: nothing to display for DC analysis\n\tComponent.prototype.display_current = function(c,vmap) {\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Connection point\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n    var connection_point_radius = 2;\n\n\tfunction ConnectionPoint(parent,x,y) {\n\t    this.parent = parent;\n\t    this.offset_x = x;\n\t    this.offset_y = y;\n\t    this.location = '';\n\t    this.update_location();\n\t    this.label = undefined;\n\t}\n\n\tConnectionPoint.prototype.toString = function() {\n\t    return edx.StringUtils.interpolate('<ConnectionPoint ({offset_x},{offset_y}) {parent}>',\n\t    {\n\t\toffset_x: this.offset_x,\n\t\toffset_y: this.offset_y,\n\t\tparent: edx.HtmlUtils.ensureHTML(this.parent.toString())\n\t    });\n\t}\n\n\n\tConnectionPoint.prototype.json = function() {\n\t    return this.label;\n\t}\n\n\tConnectionPoint.prototype.clear_label = function() {\n\t    this.label = undefined;\n\t}\n\n\tConnectionPoint.prototype.propagate_label = function(label) {\n\t    // should we check if existing label is the same?  it should be...\n\n\t    if (this.label === undefined) {\n\t\t// label this connection point\n\t\tthis.label = label;\n\n\t\t// propagate label to coincident connection points\n\t\tthis.parent.sch.propagate_label(label,this.location);\n\n\t\t// possibly label other cp's for this device?\n\t\tthis.parent.propagate_label(label);\n\t    } else if (this.label != '0' && label != '0' && this.label != label)\n\t\talert(\"Node has two conflicting labels: \"+this.label+\", \"+label);\n\t}\n\n\tConnectionPoint.prototype.update_location = function() {\n\t    // update location string which we use as a key to find coincident connection points\n\t    var old_location = this.location;\n\t    var parent = this.parent;\n\t    var nx = parent.transform_x(this.offset_x,this.offset_y) + parent.x;\n\t    var ny = parent.transform_y(this.offset_x,this.offset_y) + parent.y;\n\t    this.x = nx;\n\t    this.y = ny;\n\t    this.location = nx + ',' + ny;\n\n\t    // add ourselves to the connection list for the new location\n\t    if (parent.sch)\n\t\tparent.sch.update_connection_point(this,old_location);\n\t}\n\n\tConnectionPoint.prototype.coincident = function(x,y) {\n\t    return this.x==x && this.y==y;\n\t}\n\n\tConnectionPoint.prototype.draw = function(c,n) {\n\t    if (n != 2)\n\t\tthis.parent.draw_circle(c,this.offset_x,this.offset_y,connection_point_radius,n > 2);\n\t}\n\n\tConnectionPoint.prototype.draw_x = function(c) {\n\t    this.parent.draw_line(c,this.offset_x-2,this.offset_y-2,this.offset_x+2,this.offset_y+2,grid_style);\n\t    this.parent.draw_line(c,this.offset_x+2,this.offset_y-2,this.offset_x-2,this.offset_y+2,grid_style);\n\t}\n\n\tConnectionPoint.prototype.display_voltage = function(c,vmap) {\n\t    var v = vmap[this.label];\n\t    if (v != undefined) {\n\t\tvar label = v.toFixed(2) + 'V';\n\n\t\t// first draw some solid blocks in the background\n\t\tc.globalAlpha = 0.85;\n\t\tthis.parent.draw_text(c,'\\u2588\\u2588\\u2588',this.offset_x,this.offset_y,\n\t\t\t\t      4,annotation_size,element_style);\n\t\tc.globalAlpha = 1.0;\n\n\t\t// display the node voltage at this connection point\n\t\tthis.parent.draw_text(c,label,this.offset_x,this.offset_y,\n\t\t\t\t      4,annotation_size,annotation_style);\n\n\t\t// only display each node voltage once\n\t\tdelete vmap[this.label];\n\t    }\n\t}\n\n\t// see if three connection points are collinear\n\tfunction collinear(p1,p2,p3) {\n\t    // from http://mathworld.wolfram.com/Collinear.html\n\t    var area = p1.x*(p2.y - p3.y) + p2.x*(p3.y - p1.y) + p3.x*(p1.y - p2.y);\n\t    return area == 0;\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Wire\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tvar near_distance = 2;   // how close to wire counts as \"near by\"\n\n\tfunction Wire(x1,y1,x2,y2) {\n\t    // arbitrarily call x1,y1 the origin\n\t    Component.call(this,'w',x1,y1,0);\n\t    this.dx = x2 - x1;\n\t    this.dy = y2 - y1;\n\t    this.add_connection(0,0);\n\t    this.add_connection(this.dx,this.dy);\n\n\t    // compute bounding box (expanded slightly)\n\t    var r = [0,0,this.dx,this.dy];\n\t    canonicalize(r);\n\t    r[0] -= near_distance;\n\t    r[1] -= near_distance;\n\t    r[2] += near_distance;\n\t    r[3] += near_distance;\n\t    this.bounding_box = r;\n\t    this.update_coords();    // update bbox\n\n\t    // used in selection calculations\n\t    this.len = Math.sqrt(this.dx*this.dx + this.dy*this.dy);\n\t}\n\tWire.prototype = new Component();\n\tWire.prototype.constructor = Wire;\n\n        Wire.prototype.toString = function() {\n\t    return edx.StringUtils.interpolate(\n\t\t'<Wire ({x},{y}) ({x_plus_dx},{y_plus_dy})>',\n\t\t{\n\t\t    x: this.x,\n\t\t    y: this.y,\n\t\t    x_plus_dx: this.x + this.dx,\n\t\t    y_plus_dy: this.y + this.dy\n\t\t});\n\t}\n\n\t// return connection point at other end of wire from specified cp\n\tWire.prototype.other_end = function(cp) {\n\t    if (cp == this.connections[0]) return this.connections[1];\n\t    else if (cp == this.connections[1]) return this.connections[0];\n\t    else return undefined;\n\t}\n\n\tWire.prototype.json = function(index) {\n\t    var json = ['w',[this.x, this.y, this.x+this.dx, this.y+this.dy]];\n\t    return json;\n\t}\n\n\tWire.prototype.draw = function(c) {\n\t    this.draw_line(c,0,0,this.dx,this.dy);\n\t}\n\n\tWire.prototype.clone = function(x,y) {\n\t    return new Wire(x,y,x+this.dx,y+this.dy);\n\t}\n\n\tWire.prototype.near = function(x,y) {\n\t    // crude check: (x,y) within expanded bounding box of wire\n\t    if (inside(this.bbox,x,y)) {\n\t\t// compute distance between x,y and nearst point on line\n\t\t// http://www.allegro.cc/forums/thread/589720\n\t\tvar D = Math.abs((x - this.x)*this.dy - (y - this.y)*this.dx)/this.len;\n\t\tif (D <= near_distance) return true;\n\t    }\n\t    return false;\n\t}\n\n\t// selection rectangle selects wire only if it includes\n\t// one of the end points\n\tWire.prototype.select_rect = function(s) {\n\t    this.was_previously_selected = this.selected;\n\t    if (inside(s,this.x,this.y) || inside(s,this.x+this.dx,this.y+this.dy))\n\t\tthis.set_select(true);\n\t}\n\n\t// if connection point cp bisects the\n\t// wire represented by this compononent, return true\n\tWire.prototype.bisect_cp = function(cp) {\n\t    var x = cp.x;\n\t    var y = cp.y;\n\n\t    // crude check: (x,y) within expanded bounding box of wire\n\t    if (inside(this.bbox,x,y)) {\n\t\t// compute distance between x,y and nearst point on line\n\t\t// http://www.allegro.cc/forums/thread/589720\n\t\tvar D = Math.abs((x - this.x)*this.dy - (y - this.y)*this.dx)/this.len;\n\t\t// final check: ensure point isn't an end point of the wire\n\t\tif (D < 1 && !this.connections[0].coincident(x,y) && !this.connections[1].coincident(x,y))\n\t\t    return true;\n\t    }\n\t    return false;\n\t}\n\n\t// if some connection point of component c bisects the\n\t// wire represented by this compononent, return that\n\t// connection point.  Otherwise return null.\n\tWire.prototype.bisect = function(c) {\n\t    if (c == undefined) return;\n\t    for (var i = c.connections.length - 1; i >= 0; --i) {\n\t\tvar cp = c.connections[i];\n\t\tif (this.bisect_cp(cp)) return cp;\n\t    }\n\t    return null;\n\t}\n\n\tWire.prototype.move_end = function() {\n\t    // look for wires bisected by this wire\n\t    this.sch.check_wires(this);\n\n\t    // look for connection points that might bisect us\n\t    this.sch.check_connection_points(this);\n\t}\n\n\t// wires \"conduct\" their label to the other end\n\tWire.prototype.propagate_label = function(label) {\n\t    // don't worry about relabeling a cp, it won't recurse!\n\t    this.connections[0].propagate_label(label);\n\t    this.connections[1].propagate_label(label);\n\t}\n\n\t// Wires have no properties to edit\n\tWire.prototype.edit_properties = function(x,y) {\n\t    return false;\n\t}\n\n\t// some actual component will start the labeling of electrical nodes,\n\t// so do nothing here\n\tWire.prototype.label_connections = function() {\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Ground\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Ground(x,y,rotation) {\n\t    Component.call(this,'g',x,y,rotation);\n\t    this.add_connection(0,0);\n\t    this.bounding_box = [-6,0,6,8];\n\t    this.update_coords();\n\t}\n\tGround.prototype = new Component();\n\tGround.prototype.constructor = Ground;\n\n\tGround.prototype.toString = function() {\n\t    return edx.StringUtils.interpolate(\n\t\t'<Ground ({x},{y})>',\n\t\t{\n\t\t    x: this.x,\n\t\t    y: this.y\n\t\t});\n\t}\n\n\tGround.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,8);\n\t    this.draw_line(c,-6,8,6,8);\n\t}\n\n\tGround.prototype.clone = function(x,y) {\n\t    return new Ground(x,y,this.rotation);\n\t}\n\n\t// Grounds no properties to edit\n\tGround.prototype.edit_properties = function(x,y) {\n\t    return false;\n\t}\n\n\t// give components a chance to generate a label for their connection(s)\n\t// default action: do nothing\n\tGround.prototype.add_default_labels = function() {\n\t    this.connections[0].propagate_label('0');   // canonical label for GND node\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Label\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Label(x,y,rotation,label) {\n\t    Component.call(this,'L',x,y,rotation);\n\t    this.properties['label'] = label ? label : '???';\n\t    this.add_connection(0,0);\n\t    this.bounding_box = [-2,0,2,8];\n\t    this.update_coords();\n\t}\n\tLabel.prototype = new Component();\n\tLabel.prototype.constructor = Label;\n\n\tLabel.prototype.toString = function() {\n\t    return edx.StringUtils.interpolate(\n\t\t'<Label ({x},{y})>',\n\t\t{\n\t\t    x: this.x,\n\t\t    y: this.y\n\t\t});\n\t}\n\n\tLabel.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,8);\n\t    this.draw_text(c,this.properties['label'],0,9,1,property_size);\n\t}\n\n\tLabel.prototype.clone = function(x,y) {\n\t    return new Label(x,y,this.rotation,this.properties['label']);\n\t}\n\n\t// give components a chance to generate a label for their connection(s)\n\t// default action: do nothing\n\tLabel.prototype.add_default_labels = function() {\n\t    this.connections[0].propagate_label(this.properties['label']);\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Voltage Probe\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n    var probe_colors = ['red','green','blue','cyan','magenta','yellow','black','x-axis'];\n    var probe_colors_rgb = {\n\t    'red': 'rgb(255,64,64)',\n\t    'green': 'rgb(64,255,64)',\n\t    'blue': 'rgb(64,64,255)',\n\t    'cyan': 'rgb(64,255,255)',\n\t    'magenta' : 'rgb(255,64,255)',\n\t    'yellow': 'rgb(255,255,64)',\n\t    'black': 'rgb(0,0,0)',\n\t    'x-axis': undefined\n\t};\n\n\tfunction Probe(x,y,rotation,color,offset) {\n\t    Component.call(this,'s',x,y,rotation);\n\t    this.add_connection(0,0);\n\t    this.properties['color'] = color ? color : 'cyan';\n\t    this.properties['offset'] = (offset==undefined || offset=='') ? '0' : offset;\n\t    this.bounding_box = [0,0,27,-21];\n\t    this.update_coords();\n\t}\n\tProbe.prototype = new Component();\n\tProbe.prototype.constructor = Probe;\n\n\tProbe.prototype.toString = function() {\n\t    return edx.StringUtils.interpolate(\n\t\t'<Probe ({x},{y})>',\n\t\t{\n\t\t    x: this.x,\n\t\t    y: this.y\n\t\t});\n\t}\n\n\tProbe.prototype.draw = function(c) {\n\t    // draw outline\n\t    this.draw_line(c,0,0,4,-4);\n\t    this.draw_line(c,2,-6,6,-2);\n\t    this.draw_line(c,2,-6,17,-21);\n\t    this.draw_line(c,6,-2,21,-17);\n\t    this.draw_line(c,17,-21,21,-17);\n\t    this.draw_arc(c,19,-11,8,3*Math.PI/2,0);\n\n\t    // fill body with plot color\n\t    var color = probe_colors_rgb[this.properties['color']];\n\t    if (color != undefined) {\n\t\tc.fillStyle = color;\n\t\tc.beginPath();\n\t\tthis.moveTo(c,2,-6);\n\t\tthis.lineTo(c,6,-2);\n\t\tthis.lineTo(c,21,-17);\n\t\tthis.lineTo(c,17,-21);\n\t\tthis.lineTo(c,2,-6);\n\t\tc.fill();\n\t    } else {\n\t\tthis.draw_text(c,this.properties['color'],27,-11,1,property_size);\n\t    }\n\t}\n\n\tProbe.prototype.clone = function(x,y) {\n\t    return new Probe(x,y,this.rotation,this.properties['color'],this.properties['offset']);\n\t}\n\n\tProbe.prototype.edit_properties = function(x,y) {\n\t    if (inside(this.bbox,x,y)) {\n        var fields = [];\n\t\tfields['Plot color'] = build_select(probe_colors,this.properties['color']);\n\t\tfields['Plot offset'] = build_input('text',10,this.properties['offset']);\n\n\t\tvar content = build_table(fields);\n\t\tcontent.fields = fields;\n\t\tcontent.component = this;\n\n\t\tthis.sch.dialog('Edit Properties',content,function(content) {\n\t\t\tvar color_choice = content.fields['Plot color'];\n\t\t\tcontent.component.properties['color'] = probe_colors[color_choice.selectedIndex];\n\t\t\tcontent.component.properties['offset'] = content.fields['Plot offset'].value;\n\t\t\tcontent.component.sch.redraw_background();\n\t\t    });\n\t\treturn true;\n\t    } else return false;\n\t}\n\n\t// return [color, node_label, offset, type] for this probe\n\tProbe.prototype.probe_info = function() {\n\t    var color = this.properties['color'];\n\t    var offset = this.properties['offset'];\n\t    if (offset==undefined || offset==\"\") offset = '0';\n\t    return [color,this.connections[0].label,offset,'voltage'];\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Ammeter Probe\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Ammeter(x,y,rotation,color,offset) {\n\t    Component.call(this,'a',x,y,rotation);\n\t    this.add_connection(0,0);   // pos\n\t    this.add_connection(16,0);   // neg\n\t    this.properties['color'] = color ? color : 'magenta';\n\t    this.properties['offset'] = (offset==undefined || offset=='') ? '0' : offset;\n\t    this.bounding_box = [-3,0,16,3];\n\t    this.update_coords();\n\t}\n\tAmmeter.prototype = new Component();\n\tAmmeter.prototype.constructor = Ammeter;\n\n\tAmmeter.prototype.toString = function() {\n\t    return edx.StringUtils.interpolate(\n\t\t'<Ammeter ({x},{y})>',\n\t\t{\n\t\t    x: this.x,\n\t\t    y: this.y\n\t\t});\n\t}\n\n\tAmmeter.prototype.move_end = function() {\n\t    Component.prototype.move_end.call(this);   // do the normal processing\n\n\t    // special for current probes: see if probe has been placed\n\t    // in the middle of wire, creating three wire segments one\n\t    // of which is shorting the two terminals of the probe.  If\n\t    // so, auto remove the shorting segment.\n\t    var e1 = this.connections[0].location;\n\t    var e2 = this.connections[1].location;\n\t    var cplist = this.sch.find_connections(this.connections[0]);\n\t    for (var i = cplist.length - 1; i >= 0; --i) {\n\t\tvar c = cplist[i].parent;  // a component connected to ammeter terminal\n\t\t// look for a wire whose end points match those of the ammeter\n\t\tif (c.type == 'w') {\n\t\t    var c_e1 = c.connections[0].location;\n\t\t    var c_e2 = c.connections[1].location;\n\t\t    if ((e1 == c_e1 && c2 == c_e2) || (e1 == c_e2 && e2 == c_e1)) {\n\t\t\tc.remove();\n\t\t\tbreak;\n\t\t    }\n\t\t}\n\t    }\n\t}\n\n\tAmmeter.prototype.draw = function(c) {\n\t    this.draw_line(c,0,0,16,0);\n\n\t    // draw chevron in probe color\n\t    c.strokeStyle = probe_colors_rgb[this.properties['color']];\n\t    if (c.strokeStyle != undefined) {\n\t\tc.beginPath();\n\t\tthis.moveTo(c,6,-3);\n\t\tthis.lineTo(c,10,0);\n\t\tthis.lineTo(c,6,3);\n\t\tc.stroke();\n\t    }\n\t}\n\n\tAmmeter.prototype.clone = function(x,y) {\n\t    return new Ammeter(x,y,this.rotation,this.properties['color'],this.properties['offset']);\n\t}\n\n\t// share code with voltage probe\n\tAmmeter.prototype.edit_properties = Probe.prototype.edit_properties;\n\n\tAmmeter.prototype.label = function() {\n\t    var name = this.properties['name'];\n\t    var label = 'I(' + (name ? name : '_' + this.properties['_json_']) + ')';\n\t    return label;\n\t}\n\n\t// display current for DC analysis\n\tAmmeter.prototype.display_current = function(c,vmap) {\n\t    var label = this.label();\n\t    var v = vmap[label];\n\t    if (v != undefined) {\n\t\tvar i = engineering_notation(v,2) + 'A';\n\t\tthis.draw_text(c,i,8,-5,7,annotation_size,annotation_style);\n\n\t\t// only display each current once\n\t\tdelete vmap[label];\n\t    }\n\t}\n\n\t// return [color, current_label, offset, type] for this probe\n\tAmmeter.prototype.probe_info = function() {\n\t    var color = this.properties['color'];\n\t    var offset = this.properties['offset'];\n\t    if (offset==undefined || offset==\"\") offset = '0';\n\t    return [color,this.label(),offset,'current'];\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Resistor\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Resistor(x,y,rotation,name,r) {\n\t    Component.call(this,'r',x,y,rotation);\n\t    this.properties['name'] = name;\n\t    this.properties['r'] = r ? r : '1';\n\t    this.add_connection(0,0);\n\t    this.add_connection(0,48);\n\t    this.bounding_box = [-5,0,5,48];\n\t    this.update_coords();\n\t}\n\tResistor.prototype = new Component();\n\tResistor.prototype.constructor = Resistor;\n\n\tResistor.prototype.toString = function() {\n\t    return edx.StringUtils.interpolate(\n\t\t'<Resistor {r} ({x},{y})>',\n\t\t{\n\t\t    r: this.properties['r'],\n\t\t    x: this.x,\n\t\t    y: this.y\n\t\t});\n\t}\n\n\tResistor.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,12);\n\t    this.draw_line(c,0,12,4,14);\n\t    this.draw_line(c,4,14,-4,18);\n\t    this.draw_line(c,-4,18,4,22);\n\t    this.draw_line(c,4,22,-4,26);\n\t    this.draw_line(c,-4,26,4,30);\n\t    this.draw_line(c,4,30,-4,34);\n\t    this.draw_line(c,-4,34,0,36);\n\t    this.draw_line(c,0,36,0,48);\n\t    if (this.properties['r'])\n\t\tthis.draw_text(c,this.properties['r']+'\\u03A9',5,24,3,property_size);\n\t    if (this.properties['name'])\n\t\tthis.draw_text(c,this.properties['name'],-5,24,5,property_size);\n\t}\n\n\tResistor.prototype.clone = function(x,y) {\n\t    return new Resistor(x,y,this.rotation,this.properties['name'],this.properties['r']);\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Capacitor\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Capacitor(x,y,rotation,name,c) {\n\t    Component.call(this,'c',x,y,rotation);\n\t    this.properties['name'] = name;\n\t    this.properties['c'] = c ? c : '1p';\n\t    this.add_connection(0,0);\n\t    this.add_connection(0,48);\n\t    this.bounding_box = [-8,0,8,48];\n\t    this.update_coords();\n\t}\n\tCapacitor.prototype = new Component();\n\tCapacitor.prototype.constructor = Capacitor;\n\n\tCapacitor.prototype.toString = function() {\n\t    return edx.StringUtils.interpolate(\n\t\t'<Capacitor {r} ({x},{y})>',\n\t\t{\n\t\t    r: this.properties['r'],\n\t\t    x: this.x,\n\t\t    y: this.y\n\t\t});\n\t}\n\n\tCapacitor.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,22);\n\t    this.draw_line(c,-8,22,8,22);\n\t    this.draw_line(c,-8,26,8,26);\n\t    this.draw_line(c,0,26,0,48);\n\t    if (this.properties['c'])\n\t\tthis.draw_text(c,this.properties['c']+'F',9,24,3,property_size);\n\t    if (this.properties['name'])\n\t\tthis.draw_text(c,this.properties['name'],-9,24,5,property_size);\n\t}\n\n\tCapacitor.prototype.clone = function(x,y) {\n\t    return new Capacitor(x,y,this.rotation,this.properties['name'],this.properties['c']);\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Inductor\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Inductor(x,y,rotation,name,l) {\n\t    Component.call(this,'l',x,y,rotation);\n\t    this.properties['name'] = name;\n\t    this.properties['l'] = l ? l : '1n';\n\t    this.add_connection(0,0);\n\t    this.add_connection(0,48);\n\t    this.bounding_box = [-4,0,5,48];\n\t    this.update_coords();\n\t}\n\tInductor.prototype = new Component();\n\tInductor.prototype.constructor = Inductor;\n\n\tInductor.prototype.toString = function() {\n\t    return edx.StringUtils.interpolate(\n\t\t'<Inductor {l}, ({x},{y})>',\n\t\t{\n\t\t    l: this.properties['l'],\n\t\t    x: this.x,\n\t\t    y: this.y\n\t\t});\n\t}\n\n\tInductor.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,14);\n\t    this.draw_arc(c,0,18,4,6*Math.PI/4,3*Math.PI/4);\n\t    this.draw_arc(c,0,24,4,5*Math.PI/4,3*Math.PI/4);\n\t    this.draw_arc(c,0,30,4,5*Math.PI/4,2*Math.PI/4);\n\t    this.draw_line(c,0,34,0,48);\n\n\t    if (this.properties['l'])\n\t\tthis.draw_text(c,this.properties['l']+'H',6,24,3,property_size);\n\t    if (this.properties['name'])\n\t\tthis.draw_text(c,this.properties['name'],-3,24,5,property_size);\n\t}\n\n\tInductor.prototype.clone = function(x,y) {\n\t    return new Inductor(x,y,this.rotation,this.properties['name'],this.properties['l']);\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Diode\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tvar diode_types = ['normal','ideal'];\n\n\tfunction Diode(x,y,rotation,name,area,type) {\n\t    Component.call(this,'d',x,y,rotation);\n\t    this.properties['name'] = name;\n\t    this.properties['area'] = area ? area : '1';\n\t    this.properties['type'] = type ? type : 'normal';\n\t    this.add_connection(0,0);   // anode\n\t    this.add_connection(0,48);  // cathode\n\t    this.bounding_box = (type == 'ideal') ? [-12,0,12,48] : [-8,0,8,48];\n\t    this.update_coords();\n\t}\n\tDiode.prototype = new Component();\n\tDiode.prototype.constructor = Diode;\n\n\tDiode.prototype.toString = function() {\n\t    return edx.StringUtils.interpolate(\n\t\t'<Diode {area} ({x},{y})>',\n\t\t{\n\t\t    area: this.properties['area'],\n\t\t    x: this.x,\n\t\t    y: this.y\n\t\t});\n\t}\n\n\tDiode.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,16);\n\t    this.draw_line(c,-8,16,8,16);\n\t    this.draw_line(c,-8,16,0,32);\n\t    this.draw_line(c,8,16,0,32);\n\t    this.draw_line(c,-8,32,8,32);\n\t    this.draw_line(c,0,32,0,48);\n\n\t    if (this.properties['type'] == 'ideal') {\n\t\t// put a box around an ideal diode\n\t\tthis.draw_line(c,-10,12,10,12);\n\t\tthis.draw_line(c,-10,12,-10,36);\n\t\tthis.draw_line(c,10,12,10,36);\n\t\tthis.draw_line(c,-10,36,10,36);\n\t    }\n\n\t    if (this.properties['area'])\n\t\tthis.draw_text(c,this.properties['area'],10,24,3,property_size);\n\t    if (this.properties['name'])\n\t\tthis.draw_text(c,this.properties['name'],-10,24,5,property_size);\n\t}\n\n\tDiode.prototype.clone = function(x,y) {\n\t    return new Diode(x,y,this.rotation,this.properties['name'],this.properties['area'],this.properties['type']);\n\t}\n\n\tDiode.prototype.edit_properties = function(x,y) {\n\t    if (inside(this.bbox,x,y)) {\n            var fields = [];\n\t\tfields['name'] = build_input('text',10,this.properties['name']);\n\t\tfields['area'] = build_input('text',10,this.properties['area']);\n\t\tfields['type'] = build_select(diode_types,this.properties['type']);\n\n\t\tvar content = build_table(fields);\n\t\tcontent.fields = fields;\n\t\tcontent.component = this;\n\n\t\tthis.sch.dialog('Edit Properties',content,function(content) {\n\t\t\tcontent.component.properties['name'] = content.fields['name'].value;\n\t\t\tcontent.component.properties['area'] = content.fields['area'].value;\n\t\t\tcontent.component.properties['type'] = diode_types[content.fields['type'].selectedIndex];\n\t\t\tcontent.component.sch.redraw_background();\n\t\t    });\n\t\treturn true;\n\t    } else return false;\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  N-channel Mosfet\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction NFet(x,y,rotation,name,w_over_l) {\n\t    Component.call(this,'n',x,y,rotation);\n\t    this.properties['name'] = name;\n\t    this.properties['W/L'] = w_over_l ? w_over_l : '2';\n\t    this.add_connection(0,0);   // drain\n\t    this.add_connection(-24,24);  // gate\n\t    this.add_connection(0,48);  // source\n\t    this.bounding_box = [-24,0,8,48];\n\t    this.update_coords();\n\t}\n\tNFet.prototype = new Component();\n\tNFet.prototype.constructor = NFet;\n\n\tNFet.prototype.toString = function() {\n\t    return edx.StringUtils.interpolate(\n\t\t'<NFet {W_L} ({x},{y})>',\n\t\t{\n\t\t    W_L: this.properties['W/L'],\n\t\t    x: this.x,\n\t\t    y: this.y\n\t\t});\n\t}\n\n\tNFet.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,16);\n\t    this.draw_line(c,-8,16,0,16);\n\t    this.draw_line(c,-8,16,-8,32);\n\t    this.draw_line(c,-8,32,0,32);\n\t    this.draw_line(c,0,32,0,48);\n\t    this.draw_line(c,-24,24,-12,24);\n\t    this.draw_line(c,-12,16,-12,32);\n\n\t    var dim = this.properties['W/L'];\n\t    if (this.properties['name']) {\n\t\tthis.draw_text(c,this.properties['name'],2,22,6,property_size);\n\t\tthis.draw_text(c,dim,2,26,0,property_size);\n\t    } else\n\t\tthis.draw_text(c,dim,2,24,3,property_size);\n\t}\n\n\tNFet.prototype.clone = function(x,y) {\n\t    return new NFet(x,y,this.rotation,this.properties['name'],this.properties['W/L']);\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  P-channel Mosfet\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction PFet(x,y,rotation,name,w_over_l) {\n\t    Component.call(this,'p',x,y,rotation);\n\t    this.properties['name'] = name;\n\t    this.properties['W/L'] = w_over_l ? w_over_l : '2';\n\t    this.add_connection(0,0);   // drain\n\t    this.add_connection(-24,24);  // gate\n\t    this.add_connection(0,48);  // source\n\t    this.bounding_box = [-24,0,8,48];\n\t    this.update_coords();\n\t}\n\tPFet.prototype = new Component();\n\tPFet.prototype.constructor = PFet;\n\n\tPFet.prototype.toString = function() {\n\t    return edx.StringUtils.interpolate('<PFet {W_L} ({x},{y})>',\n\t    {\n\t\tW_L: this.properties['W/L'],\n\t\tx: this.x,\n\t\ty: this.y\n\t    });\n\t}\n\n\tPFet.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,16);\n\t    this.draw_line(c,-8,16,0,16);\n\t    this.draw_line(c,-8,16,-8,32);\n\t    this.draw_line(c,-8,32,0,32);\n\t    this.draw_line(c,0,32,0,48);\n\t    this.draw_line(c,-24,24,-16,24);\n\t    this.draw_circle(c,-14,24,2,false);\n\t    this.draw_line(c,-12,16,-12,32);\n\n\t    var dim = this.properties['W/L'];\n\t    if (this.properties['name']) {\n\t\tthis.draw_text(c,this.properties['name'],2,22,6,property_size);\n\t\tthis.draw_text(c,dim,2,26,0,property_size);\n\t    } else\n\t\tthis.draw_text(c,dim,2,24,3,property_size);\n\t}\n\n\tPFet.prototype.clone = function(x,y) {\n\t    return new PFet(x,y,this.rotation,this.properties['name'],this.properties['W/L']);\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Op Amp\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction OpAmp(x,y,rotation,name,A) {\n\t    Component.call(this,'o',x,y,rotation);\n\t    this.properties['name'] = name;\n\t    this.properties['A'] = A ? A : '30000';\n\t    this.add_connection(0,0);   // +\n\t    this.add_connection(0,16);  // -\n\t    this.add_connection(48,8);  // output\n\t    this.add_connection(24,32);  // ground\n\t    this.bounding_box = [0,-8,48,32];\n\t    this.update_coords();\n\t}\n\tOpAmp.prototype = new Component();\n\tOpAmp.prototype.constructor = OpAmp;\n\n\tOpAmp.prototype.toString = function() {\n\t    return edx.StringUtils.interpolate(\n\t\t'<OpAmp{A} ({x},{y})>',\n\t\t{\n\t\t    A: this.properties['A'],\n\t\t    x: this.x,\n\t\t    y: this.y\n\t\t});\n\t}\n\n\tOpAmp.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    // triangle\n\t    this.draw_line(c,8,-8,8,24);\n\t    this.draw_line(c,8,-8,40,8);\n\t    this.draw_line(c,8,24,40,8);\n\t    // inputs and output\n\t    this.draw_line(c,0,0,8,0);\n\t    this.draw_line(c,0,16,8,16);\n\t    this.draw_text(c,'gnd',37,18,property_size);\n\t    this.draw_line(c,40,8,48,8);\n\t    this.draw_line(c,24,16,24,32);\n\t    // + and -\n\t    this.draw_line(c,10,0,16,0);\n\t    this.draw_line(c,13,-3,13,3);\n\t    this.draw_line(c,10,16,16,16);\n\n\t    if (this.properties['name'])\n\t\tthis.draw_text(c,this.properties['name'],32,16,0,property_size);\n\t}\n\n\tOpAmp.prototype.clone = function(x,y) {\n\t    return new OpAmp(x,y,this.rotation,this.properties['name'],this.properties['A']);\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Source\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Source(x,y,rotation,name,type,value) {\n\t    Component.call(this,type,x,y,rotation);\n\t    this.properties['name'] = name;\n\t    if (value == undefined) value = 'dc(1)';\n\t    this.properties['value'] = value;\n\t    this.add_connection(0,0);\n\t    this.add_connection(0,48);\n\t    this.bounding_box = [-12,0,12,48];\n\t    this.update_coords();\n\t    this.content = document.createElement('div');  // used by edit_properties\n\t}\n\tSource.prototype = new Component();\n\tSource.prototype.constructor = Source;\n\n\tSource.prototype.toString = function() {\n\t    return edx.StringUtils.interpolate(\n\t\t'<{type}source {params} ({x},{y})>',\n\t\t{\n\t\t    type: this.type,\n\t\t    params: this.properties['params'],\n\t\t    x: this.x,\n\t\t    y: this.y\n\t\t});\n\t}\n\n\tSource.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,12);\n\t    this.draw_circle(c,0,24,12,false);\n\t    this.draw_line(c,0,36,0,48);\n\n\t    if (this.type == 'v') {  // voltage source\n\t\t// draw + and -\n\t\tthis.draw_line(c,0,15,0,21);\n\t\tthis.draw_line(c,-3,18,3,18);\n\t\tthis.draw_line(c,-3,30,3,30);\n\t    } else if (this.type == 'i') {  // current source\n\t\t// draw arrow: pos to neg\n\t\tthis.draw_line(c,0,15,0,32);\n\t\tthis.draw_line(c,-3,26,0,32);\n\t\tthis.draw_line(c,3,26,0,32);\n\t    }\n\n\t    if (this.properties['name'])\n\t\tthis.draw_text(c,this.properties['name'],-13,24,5,property_size);\n\t    if (this.properties['value'])\n\t\tthis.draw_text(c,this.properties['value'],13,24,3,property_size);\n\t}\n\n\t// map source function name to labels for each source parameter\n\tvar source_functions = {\n\t    'dc': ['DC value'],\n\n\t    'impulse': ['Height',\n\t\t\t'Width (secs)'],\n\n\t    'step': ['Initial value',\n\t\t     'Plateau value',\n\t\t     'Delay until step (secs)',\n\t\t     'Rise time (secs)'],\n\n\t    'square': ['Initial value',\n\t\t       'Plateau value',\n\t\t       'Frequency (Hz)',\n\t\t       'Duty cycle (%)'],\n\n\t    'triangle': ['Initial value',\n\t\t\t 'Plateau value',\n\t\t\t 'Frequency (Hz)'],\n\n\t    'pwl': ['Comma-separated list of alternating times and values'],\n\n\t    'pwl_repeating': ['Comma-separated list of alternating times and values'],\n\n\t    'pulse': ['Initial value',\n\t\t      'Plateau value',\n\t\t      'Delay until pulse (secs)',\n\t\t      'Time for first transition (secs)',\n\t\t      'Time for second transition (secs)',\n\t\t      'Pulse width (secs)',\n\t\t      'Period (secs)'],\n\n\t    'sin': ['Offset value',\n\t\t    'Amplitude',\n\t\t    'Frequency (Hz)',\n\t\t    'Delay until sin starts (secs)',\n\t\t    'Phase offset (degrees)']\n\t}\n\n\t// build property editor div\n\tSource.prototype.build_content = function(src) {\n\t    // make an <input> widget for each property\n\t    var fields = []\n\t    fields['name'] = build_input('text',10,this.properties['name']);\n\n\t    if (src == undefined) {\n\t\tfields['value'] = this.properties['value'];\n\t    } else {\n\t\t// fancy version: add select tag for source type\n\t\tvar src_types = [];\n\t\tfor (var t in source_functions) src_types.push(t);\n\t\tvar type_select = build_select(src_types,src.fun);\n\t\ttype_select.component = this;\n\t\ttype_select.addEventListener('change',source_type_changed,false)\n\t\tfields['type'] = type_select;\n\n\t\tif (src.fun == 'pwl' || src.run == 'pwl_repeating') {\n\t\t    var v = '';\n\t\t    var first = true;\n\t\t    for (var i = 0; i < src.args.length; i++) {\n\t\t\tif (first) first = false;\n\t\t\telse v += ',';\n\t\t\tv += engineering_notation(src.args[i],3);\n\t\t\tif (i % 2 == 0) v += 's';\n\t\t    }\n\t\t    fields[source_functions[src.fun][0]] = build_input('text',30,v);\n\t\t} else {\n\t\t    // followed separate input tag for each parameter\n\t\t    var labels = source_functions[src.fun];\n\t\t    for (var i = 0; i < labels.length; i++) {\n\t\t\tvar v = engineering_notation(src.args[i],3);\n\t\t\tfields[labels[i]] = build_input('text',10,v);\n\t\t    }\n\t\t}\n\t    }\n\n\t    var div = this.content;\n\t    if (div.hasChildNodes())\n\t\tdiv.removeChild(div.firstChild);  // remove table of input fields\n\t    div.appendChild(build_table(fields));\n\t    div.fields = fields;\n\t    div.component = this;\n\t    return div;\n\t}\n\n\tfunction source_type_changed(event) {\n\t    if (!event) event = window.event;\n\t    var select = (window.event) ? event.srcElement : event.target;\n\n\t    // see where to get source parameters from\n\t    var type = select.options[select.selectedIndex].value;\n\t    var src = undefined;\n\t    if (this.src != undefined && type == this.src.fun)\n\t\tsrc = this.src;\n\t    else if (typeof cktsim != 'undefined')\n\t\tsrc = cktsim.parse_source(type+'()');\n\n\t    select.component.build_content(src);\n\t}\n\n\tSource.prototype.edit_properties = function(x,y) {\n\t    if (this.near(x,y)) {\n\t\tthis.src = undefined;\n\t\tif (typeof cktsim != 'undefined')\n\t\t    this.src = cktsim.parse_source(this.properties['value']);\n\t\tvar content = this.build_content(this.src);\n\n\t\tthis.sch.dialog('Edit Properties',content,function(content) {\n\t\t\tvar c = content.component;\n\t\t\tvar fields = content.fields;\n\n\t\t\tvar first = true;\n\t\t\tvar value = '';\n\t\t\tfor (var label in fields) {\n\t\t\t    if (label == 'name')\n\t\t\t\tc.properties['name'] = fields['name'].value;\n\t\t\t    else if (label == 'value')  {\n\t\t\t\t// if unknown source type\n\t\t\t\tvalue = fields['value'].value;\n\t\t\t\tc.sch.redraw_background();\n\t\t\t\treturn;\n\t\t\t    } else if (label == 'type') {\n\t\t\t\tvar select = fields['type'];\n\t\t\t\tvalue = select.options[select.selectedIndex].value + '(';\n\t\t\t    } else {\n\t\t\t\tif (first) first = false;\n\t\t\t\telse value += ',';\n\t\t\t\tvalue += fields[label].value;\n\t\t\t    }\n\t\t\t}\n\t\t\tc.properties['value'] = value + ')';\n\t\t\tc.sch.redraw_background();\n\t\t    });\n\t\treturn true;\n\t    } else return false;\n\t}\n\n\tfunction VSource(x,y,rotation,name,value) {\n\t    Source.call(this,x,y,rotation,name,'v',value);\n\t    this.type = 'v';\n\t}\n\tVSource.prototype = new Component();\n\tVSource.prototype.constructor = VSource;\n\tVSource.prototype.toString = Source.prototype.toString;\n\tVSource.prototype.draw = Source.prototype.draw;\n\tVSource.prototype.clone = Source.prototype.clone;\n\tVSource.prototype.build_content = Source.prototype.build_content;\n\tVSource.prototype.edit_properties = Source.prototype.edit_properties;\n\n\t// display current for DC analysis\n\tVSource.prototype.display_current = function(c,vmap) {\n\t    var name = this.properties['name'];\n\t    var label = 'I(' + (name ? name : '_' + this.properties['_json_']) + ')';\n\t    var v = vmap[label];\n\t    if (v != undefined) {\n\t\t// first draw some solid blocks in the background\n\t\tc.globalAlpha = 0.5;\n\t\tthis.draw_text(c,'\\u2588\\u2588\\u2588',-8,8,4,annotation_size,element_style);\n\t\tc.globalAlpha = 1.0;\n\n\t\t// display the element current\n\t\tvar i = engineering_notation(v,2) + 'A';\n\t\tthis.draw_text(c,i,-3,5,5,annotation_size,annotation_style);\n\t\t// draw arrow for current\n\t\tthis.draw_line(c,-3,4,0,8);\n\t\tthis.draw_line(c,3,4,0,8);\n\t\t// only display each current once\n\t\tdelete vmap[label];\n\t    }\n\t}\n\n\tVSource.prototype.clone = function(x,y) {\n\t    return new VSource(x,y,this.rotation,this.properties['name'],this.properties['value']);\n\t}\n\n\tfunction ISource(x,y,rotation,name,value) {\n\t    Source.call(this,x,y,rotation,name,'i',value);\n\t    this.type = 'i';\n\t}\n\tISource.prototype = new Component();\n\tISource.prototype.constructor = ISource;\n\tISource.prototype.toString = Source.prototype.toString;\n\tISource.prototype.draw = Source.prototype.draw;\n\tISource.prototype.clone = Source.prototype.clone;\n\tISource.prototype.build_content = Source.prototype.build_content;\n\tISource.prototype.edit_properties = Source.prototype.edit_properties;\n\n\tISource.prototype.clone = function(x,y) {\n\t    return new ISource(x,y,this.rotation,this.properties['name'],this.properties['value']);\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  JQuery slider support for setting a component value\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\tfunction component_slider(event,ui) {\n\t    var sname = $(this).slider(\"option\",\"schematic\");\n\n\t    // set value of specified component\n\t    var cname = $(this).slider(\"option\",\"component\");\n\t    var pname = $(this).slider(\"option\",\"property\");\n\t    var suffix = $(this).slider(\"option\",\"suffix\");\n\t    if (typeof suffix != \"string\") suffix = \"\";\n\n\t    var v = ui.value;\n\t    $(this).slider(\"value\",v);  // move slider's indicator\n\n\t    var choices = $(this).slider(\"option\",\"choices\");\n\t    if (choices instanceof Array) v = choices[v];\n\n\t    // selector may match several schematics\n\t    $(\".\" + sname).each(function(index,element) {\n\t\t    element.schematic.set_property(cname,pname,v.toString() + suffix);\n\t\t})\n\n\t    // perform requested analysis\n\t    var analysis = $(this).slider(\"option\",\"analysis\");\n\t    if (analysis == \"dc\")\n\t\t$(\".\" + sname).each(function(index,element) {\n\t\t\telement.schematic.dc_analysis();\n\t\t    })\n\n\t    return false;\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Module definition\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\tvar module = {\n\t    'Schematic': Schematic,\n\t    'component_slider': component_slider\n\t}\n\treturn module;\n}());\n\n}.call(window));\n\n\n// WEBPACK FOOTER //\n// ./common/static/xmodule/modules/js/005-fc8bd2dc5b96b86d1abefdd417dd8ba5.js"],"sourceRoot":""}