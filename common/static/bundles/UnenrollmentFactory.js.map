{"version":3,"sources":["webpack:///./lms/static/js/learner_dashboard/unenrollment_factory.js","webpack:///./lms/static/js/learner_dashboard/views/unenroll_view.js"],"names":["UnenrollmentFactory","options","UnenrollView","defaults","el","triggerElement","$previouslyFocusedElement","survey","document","querySelector","i","children","length","appendChild","Math","trunc","random","$","hide","removeClass","window","trapFocusForAccessibleModal","focusableElementsString","closeButtonSelector","modalId","mainPageSelector","reason","attr","courserunKey","val","analytics","track","category","label","displayName","course_id","addClass","text","urls","dashboard","browseCourses","event","xhr","status","isEdx","location","href","switchToSlideOne","click","switchToSlideTwo","bind","signInUser","encodeURIComponent","gettext","stop","css","prop","view","$closeButton","$el","triggerSelector","each","index","element","on","handleTrigger","startSubmit","unenrollComplete","Backbone","View"],"mappings":"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","file":"UnenrollmentFactory.js","sourcesContent":["import UnenrollView from './views/unenroll_view';\n\nfunction UnenrollmentFactory(options) {\n  return new UnenrollView(options);\n}\n\nexport { UnenrollmentFactory }; // eslint-disable-line import/prefer-default-export\n\n\n\n// WEBPACK FOOTER //\n// ./lms/static/js/learner_dashboard/unenrollment_factory.js","/* globals gettext */\n\nimport Backbone from 'backbone';\n\nclass UnenrollView extends Backbone.View {\n\n  constructor(options) {\n    const defaults = {\n      el: '.unenroll-modal',\n    };\n    super(Object.assign({}, defaults, options));\n  }\n\n  handleTrigger(triggerElement) {\n    this.$previouslyFocusedElement = triggerElement;\n  }\n\n  switchToSlideOne() {\n    // Randomize survey option order\n    const survey = document.querySelector('.options');\n    for (let i = survey.children.length - 1; i >= 0; i -= 1) {\n      survey.appendChild(survey.children[Math.trunc(Math.random() * i)]);\n    }\n    this.$('.inner-wrapper header').hide();\n    this.$('#unenroll_form').hide();\n    this.$('.slide1').removeClass('hidden');\n\n    if (window.trapFocusForAccessibleModal) {\n      window.trapFocusForAccessibleModal(\n        this.$previouslyFocusedElement,\n        window.focusableElementsString,\n        this.closeButtonSelector,\n        this.modalId,\n        this.mainPageSelector,\n      );\n    }\n  }\n\n  switchToSlideTwo() {\n    let reason = this.$(\".reasons_survey input[name='reason']:checked\").attr('val');\n    const courserunKey = $('#unenroll_course_id').val() + $('#unenroll_course_number').val();\n    if (reason === 'Other') {\n      reason = this.$('.other_text').val();\n    }\n    if (reason) {\n      window.analytics.track('unenrollment_reason.selected', {\n        category: 'user-engagement',\n        label: reason,\n        displayName: 'v1',\n        course_id: courserunKey,\n      });\n    }\n    this.$('.slide1').addClass('hidden');\n    this.$('.survey_course_name').text(this.$('#unenroll_course_name').text());\n    this.$('.slide2').removeClass('hidden');\n    this.$('.reasons_survey .return_to_dashboard').attr('href', this.urls.dashboard);\n    this.$('.reasons_survey .browse_courses').attr('href', this.urls.browseCourses);\n\n    if (window.trapFocusForAccessibleModal) {\n      window.trapFocusForAccessibleModal(\n        this.$previouslyFocusedElement,\n        window.focusableElementsString,\n        this.closeButtonSelector,\n        this.modalId,\n        this.mainPageSelector,\n      );\n    }\n  }\n\n  unenrollComplete(event, xhr) {\n    if (xhr.status === 200) {\n      if (!this.isEdx) {\n        location.href = this.urls.dashboard;\n      } else {\n        this.switchToSlideOne();\n        this.$('.reasons_survey:first .submit_reasons').click(this.switchToSlideTwo.bind(this));\n      }\n    } else if (xhr.status === 403) {\n      location.href = `${this.urls.signInUser}?course_id=${\n        encodeURIComponent($('#unenroll_course_id').val())}&enrollment_action=unenroll`;\n    } else {\n      $('#unenroll_error').text(\n        gettext('Unable to determine whether we should give you a refund because' +\n                ' of System Error. Please try again later.'),\n      ).stop()\n       .css('display', 'block');\n    }\n  }\n\n  startSubmit() {\n    this.$('.submit').prop('disabled', true);\n  }\n\n  initialize(options) {\n    const view = this;\n    this.urls = options.urls;\n    this.isEdx = options.isEdx;\n\n    this.closeButtonSelector = '.unenroll-modal .close-modal';\n    this.$closeButton = $(this.closeButtonSelector);\n    this.modalId = `#${this.$el.attr('id')}`;\n    this.mainPageSelector = '#dashboard-main';\n\n    this.triggerSelector = '.action-unenroll';\n    $(this.triggerSelector).each((index, element) => {\n      $(element).on('click', view.handleTrigger.bind($(element)));\n    });\n\n    this.$('.submit .submit-button').on('click', this.startSubmit.bind(this));\n    $('#unenroll_form').on('ajax:complete', this.unenrollComplete.bind(this));\n  }\n}\n\nexport default UnenrollView;\n\n\n\n// WEBPACK FOOTER //\n// ./lms/static/js/learner_dashboard/views/unenroll_view.js"],"sourceRoot":""}